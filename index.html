<!DOCTYPE html>
<html lang="zh-CN">

<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>My Game</title>
	<style>
		#app {
			margin: 5px auto;
			max-width: 400px;
			width: 100%;
			height: 100%;
			background-color: #ccc;
			overflow: hidden;
			border-radius: 15px;
		}

		#game {
			display: block;
			font-size: 20px;
			text-align: center;
			height: 30px;
			width: 100px;
			background-color: aliceblue;
			border-radius: 10px;
		}

		#fileLoad {
			display: none;
		}

		.sl {
			display: flex;
			height: 30px;
			width: 100%;
			flex-direction: row;
			justify-content: space-between;
		}

		.sl>div {
			text-align: center;
			background-color: aliceblue;
			font-size: 20px;
			width: 25%;
			height: 30px;
		}

		#save {
			border-radius: 0 0 15px 0;
		}

		#load {
			border-radius: 0 0 0 15px;
		}

		.screen {
			width: 296px;
			height: 280px;
			border-radius: 10px;
			padding: 10px;
			margin: 20px auto 20px;
			background-color: #bbb;
		}

		#nes {
			display: block;
			margin: 20px auto;
		}

		.btn {
			display: flex;
			flex-direction: row;
			justify-content: space-between;
			width: 100%;
			margin: 10px auto 20px;
			text-align: center;
		}

		.btn_left {
			margin: 10px;
			max-width: 180px;
			max-height: 180px;
			width: 39vw;
			height: 39vw;
			position: relative;
		}

		.btn_right {
			margin: 5px;
			max-width: 180px;
			width: 45vw;
			max-height: 180px;
			width: 45vw;
			display: flex;
			flex-direction: column;
		}

		.btn_right>div {
			max-height: 80px;
			height: 20vw;
			width: 100%;
			display: flex;
			flex-direction: row;
			justify-content: space-between;
		}

		.btn_right>div>div {
			display: flex;
			align-items: center;
			justify-content: center;
			box-shadow: -1px -1px 3px #111 inset;
		}


		#start {
			max-width: 80px;
			width: 20vw;
			max-height: 20px;
			margin: 10px 0;
			height: 10vw;
			border-radius: 10px;
			background-color: #fff;
			font-size: 14px;
		}

		#select {
			max-width: 80px;
			width: 20vw;
			max-height: 20px;
			height: 10vw;
			margin: 10px 0;
			border-radius: 10px;
			background-color: #fff;
			font-size: 14px;
		}


		#a {
			max-width: 80px;
			width: 20vw;
			max-height: 80px;
			height: 20vw;
			border-radius: 40px;
			background-color: #fff;
			font-size: 30px;
		}

		#b {
			max-width: 80px;
			width: 20vw;
			max-height: 80px;
			height: 20vw;
			border-radius: 40px;
			background-color: #fff;
			font-size: 30px;
		}
	</style>
</head>

<body>
	<div id="app">
		<input type="file" name="file" id="fileLoad" />
		<div class="sl">
			<div id="save">保存</div>
			<label for="fileLoad" id="game">加载游戏</label>
			<div id="load">读取</div>
		</div>
		<div class="screen">
			<canvas id="nes" width="256" height="240"></canvas>
		</div>
		<div class="btn">
			<div class="btn_left" id="joy">
			</div>
			<div class="btn_right">
				<div>
					<div id="start">start</div>
					<div id="select">select</div>
				</div>
				<div>
					<div id="b">B</div>
					<div id="a">A</div>
				</div>

			</div>
		</div>
	</div>
	<script>
		(()=>{var t={188:t=>{var e=function(){this.state=new Array(8);for(var t=0;t<this.state.length;t++)this.state[t]=64};e.BUTTON_A=0,e.BUTTON_B=1,e.BUTTON_SELECT=2,e.BUTTON_START=3,e.BUTTON_UP=4,e.BUTTON_DOWN=5,e.BUTTON_LEFT=6,e.BUTTON_RIGHT=7,e.prototype={buttonDown:function(t){this.state[t]=65},buttonUp:function(t){this.state[t]=64}},t.exports=e},990:(t,e,i)=>{var s=i(610),r=function(t){this.nes=t,this.mem=null,this.REG_ACC=null,this.REG_X=null,this.REG_Y=null,this.REG_SP=null,this.REG_PC=null,this.REG_PC_NEW=null,this.REG_STATUS=null,this.F_CARRY=null,this.F_DECIMAL=null,this.F_INTERRUPT=null,this.F_INTERRUPT_NEW=null,this.F_OVERFLOW=null,this.F_SIGN=null,this.F_ZERO=null,this.F_NOTUSED=null,this.F_NOTUSED_NEW=null,this.F_BRK=null,this.F_BRK_NEW=null,this.opdata=null,this.cyclesToHalt=null,this.crash=null,this.irqRequested=null,this.irqType=null,this.reset()};r.prototype={IRQ_NORMAL:0,IRQ_NMI:1,IRQ_RESET:2,reset:function(){this.mem=new Array(65536);for(var t=0;t<8192;t++)this.mem[t]=255;for(var e=0;e<4;e++){var i=2048*e;this.mem[i+8]=247,this.mem[i+9]=239,this.mem[i+10]=223,this.mem[i+15]=191}for(var s=8193;s<this.mem.length;s++)this.mem[s]=0;this.REG_ACC=0,this.REG_X=0,this.REG_Y=0,this.REG_SP=511,this.REG_PC=32767,this.REG_PC_NEW=32767,this.REG_STATUS=40,this.setStatus(40),this.F_CARRY=0,this.F_DECIMAL=0,this.F_INTERRUPT=1,this.F_INTERRUPT_NEW=1,this.F_OVERFLOW=0,this.F_SIGN=0,this.F_ZERO=1,this.F_NOTUSED=1,this.F_NOTUSED_NEW=1,this.F_BRK=1,this.F_BRK_NEW=1,this.opdata=(new n).opdata,this.cyclesToHalt=0,this.crash=!1,this.irqRequested=!1,this.irqType=null},emulate:function(){var t,e;if(this.irqRequested){switch(t=this.F_CARRY|(0===this.F_ZERO?1:0)<<1|this.F_INTERRUPT<<2|this.F_DECIMAL<<3|this.F_BRK<<4|this.F_NOTUSED<<5|this.F_OVERFLOW<<6|this.F_SIGN<<7,this.REG_PC_NEW=this.REG_PC,this.F_INTERRUPT_NEW=this.F_INTERRUPT,this.irqType){case 0:if(0!==this.F_INTERRUPT)break;this.doIrq(t);break;case 1:this.doNonMaskableInterrupt(t);break;case 2:this.doResetInterrupt()}this.REG_PC=this.REG_PC_NEW,this.F_INTERRUPT=this.F_INTERRUPT_NEW,this.F_BRK=this.F_BRK_NEW,this.irqRequested=!1}var i=this.opdata[this.nes.mmap.load(this.REG_PC+1)],s=i>>24,r=0,n=i>>8&255,h=this.REG_PC;this.REG_PC+=i>>16&255;var o=0;switch(n){case 0:o=this.load(h+2);break;case 1:o=this.load(h+2),o+=o<128?this.REG_PC:this.REG_PC-256;break;case 2:break;case 3:o=this.load16bit(h+2);break;case 4:o=this.REG_ACC;break;case 5:o=this.REG_PC;break;case 6:o=this.load(h+2)+this.REG_X&255;break;case 7:o=this.load(h+2)+this.REG_Y&255;break;case 8:(65280&(o=this.load16bit(h+2)))!=(o+this.REG_X&65280)&&(r=1),o+=this.REG_X;break;case 9:(65280&(o=this.load16bit(h+2)))!=(o+this.REG_Y&65280)&&(r=1),o+=this.REG_Y;break;case 10:(65280&(o=this.load(h+2)))!=(o+this.REG_X&65280)&&(r=1),o+=this.REG_X,o&=255,o=this.load16bit(o);break;case 11:(65280&(o=this.load16bit(this.load(h+2))))!=(o+this.REG_Y&65280)&&(r=1),o+=this.REG_Y;break;case 12:o=(o=this.load16bit(h+2))<8191?this.mem[o]+(this.mem[65280&o|1+(255&o)&255]<<8):this.nes.mmap.load(o)+(this.nes.mmap.load(65280&o|1+(255&o)&255)<<8)}switch(o&=65535,255&i){case 0:t=this.REG_ACC+this.load(o)+this.F_CARRY,0==(128&(this.REG_ACC^this.load(o)))&&0!=(128&(this.REG_ACC^t))?this.F_OVERFLOW=1:this.F_OVERFLOW=0,this.F_CARRY=t>255?1:0,this.F_SIGN=t>>7&1,this.F_ZERO=255&t,this.REG_ACC=255&t,s+=r;break;case 1:this.REG_ACC=this.REG_ACC&this.load(o),this.F_SIGN=this.REG_ACC>>7&1,this.F_ZERO=this.REG_ACC,11!==n&&(s+=r);break;case 2:4===n?(this.F_CARRY=this.REG_ACC>>7&1,this.REG_ACC=this.REG_ACC<<1&255,this.F_SIGN=this.REG_ACC>>7&1,this.F_ZERO=this.REG_ACC):(t=this.load(o),this.F_CARRY=t>>7&1,t=t<<1&255,this.F_SIGN=t>>7&1,this.F_ZERO=t,this.write(o,t));break;case 3:0===this.F_CARRY&&(s+=(65280&h)!=(65280&o)?2:1,this.REG_PC=o);break;case 4:1===this.F_CARRY&&(s+=(65280&h)!=(65280&o)?2:1,this.REG_PC=o);break;case 5:0===this.F_ZERO&&(s+=(65280&h)!=(65280&o)?2:1,this.REG_PC=o);break;case 6:t=this.load(o),this.F_SIGN=t>>7&1,this.F_OVERFLOW=t>>6&1,t&=this.REG_ACC,this.F_ZERO=t;break;case 7:1===this.F_SIGN&&(s++,this.REG_PC=o);break;case 8:0!==this.F_ZERO&&(s+=(65280&h)!=(65280&o)?2:1,this.REG_PC=o);break;case 9:0===this.F_SIGN&&(s+=(65280&h)!=(65280&o)?2:1,this.REG_PC=o);break;case 10:this.REG_PC+=2,this.push(this.REG_PC>>8&255),this.push(255&this.REG_PC),this.F_BRK=1,this.push(this.F_CARRY|(0===this.F_ZERO?1:0)<<1|this.F_INTERRUPT<<2|this.F_DECIMAL<<3|this.F_BRK<<4|this.F_NOTUSED<<5|this.F_OVERFLOW<<6|this.F_SIGN<<7),this.F_INTERRUPT=1,this.REG_PC=this.load16bit(65534),this.REG_PC--;break;case 11:0===this.F_OVERFLOW&&(s+=(65280&h)!=(65280&o)?2:1,this.REG_PC=o);break;case 12:1===this.F_OVERFLOW&&(s+=(65280&h)!=(65280&o)?2:1,this.REG_PC=o);break;case 13:this.F_CARRY=0;break;case 14:this.F_DECIMAL=0;break;case 15:this.F_INTERRUPT=0;break;case 16:this.F_OVERFLOW=0;break;case 17:t=this.REG_ACC-this.load(o),this.F_CARRY=t>=0?1:0,this.F_SIGN=t>>7&1,this.F_ZERO=255&t,s+=r;break;case 18:t=this.REG_X-this.load(o),this.F_CARRY=t>=0?1:0,this.F_SIGN=t>>7&1,this.F_ZERO=255&t;break;case 19:t=this.REG_Y-this.load(o),this.F_CARRY=t>=0?1:0,this.F_SIGN=t>>7&1,this.F_ZERO=255&t;break;case 20:t=this.load(o)-1&255,this.F_SIGN=t>>7&1,this.F_ZERO=t,this.write(o,t);break;case 21:this.REG_X=this.REG_X-1&255,this.F_SIGN=this.REG_X>>7&1,this.F_ZERO=this.REG_X;break;case 22:this.REG_Y=this.REG_Y-1&255,this.F_SIGN=this.REG_Y>>7&1,this.F_ZERO=this.REG_Y;break;case 23:this.REG_ACC=255&(this.load(o)^this.REG_ACC),this.F_SIGN=this.REG_ACC>>7&1,this.F_ZERO=this.REG_ACC,s+=r;break;case 24:t=this.load(o)+1&255,this.F_SIGN=t>>7&1,this.F_ZERO=t,this.write(o,255&t);break;case 25:this.REG_X=this.REG_X+1&255,this.F_SIGN=this.REG_X>>7&1,this.F_ZERO=this.REG_X;break;case 26:this.REG_Y++,this.REG_Y&=255,this.F_SIGN=this.REG_Y>>7&1,this.F_ZERO=this.REG_Y;break;case 27:this.REG_PC=o-1;break;case 28:this.push(this.REG_PC>>8&255),this.push(255&this.REG_PC),this.REG_PC=o-1;break;case 29:this.REG_ACC=this.load(o),this.F_SIGN=this.REG_ACC>>7&1,this.F_ZERO=this.REG_ACC,s+=r;break;case 30:this.REG_X=this.load(o),this.F_SIGN=this.REG_X>>7&1,this.F_ZERO=this.REG_X,s+=r;break;case 31:this.REG_Y=this.load(o),this.F_SIGN=this.REG_Y>>7&1,this.F_ZERO=this.REG_Y,s+=r;break;case 32:4===n?(t=255&this.REG_ACC,this.F_CARRY=1&t,t>>=1,this.REG_ACC=t):(t=255&this.load(o),this.F_CARRY=1&t,t>>=1,this.write(o,t)),this.F_SIGN=0,this.F_ZERO=t;break;case 33:case 68:break;case 34:t=255&(this.load(o)|this.REG_ACC),this.F_SIGN=t>>7&1,this.F_ZERO=t,this.REG_ACC=t,11!==n&&(s+=r);break;case 35:this.push(this.REG_ACC);break;case 36:this.F_BRK=1,this.push(this.F_CARRY|(0===this.F_ZERO?1:0)<<1|this.F_INTERRUPT<<2|this.F_DECIMAL<<3|this.F_BRK<<4|this.F_NOTUSED<<5|this.F_OVERFLOW<<6|this.F_SIGN<<7);break;case 37:this.REG_ACC=this.pull(),this.F_SIGN=this.REG_ACC>>7&1,this.F_ZERO=this.REG_ACC;break;case 38:t=this.pull(),this.F_CARRY=1&t,this.F_ZERO=1==(t>>1&1)?0:1,this.F_INTERRUPT=t>>2&1,this.F_DECIMAL=t>>3&1,this.F_BRK=t>>4&1,this.F_NOTUSED=t>>5&1,this.F_OVERFLOW=t>>6&1,this.F_SIGN=t>>7&1,this.F_NOTUSED=1;break;case 39:4===n?(t=this.REG_ACC,e=this.F_CARRY,this.F_CARRY=t>>7&1,t=(t<<1&255)+e,this.REG_ACC=t):(t=this.load(o),e=this.F_CARRY,this.F_CARRY=t>>7&1,t=(t<<1&255)+e,this.write(o,t)),this.F_SIGN=t>>7&1,this.F_ZERO=t;break;case 40:4===n?(e=this.F_CARRY<<7,this.F_CARRY=1&this.REG_ACC,t=(this.REG_ACC>>1)+e,this.REG_ACC=t):(t=this.load(o),e=this.F_CARRY<<7,this.F_CARRY=1&t,t=(t>>1)+e,this.write(o,t)),this.F_SIGN=t>>7&1,this.F_ZERO=t;break;case 41:if(t=this.pull(),this.F_CARRY=1&t,this.F_ZERO=0==(t>>1&1)?1:0,this.F_INTERRUPT=t>>2&1,this.F_DECIMAL=t>>3&1,this.F_BRK=t>>4&1,this.F_NOTUSED=t>>5&1,this.F_OVERFLOW=t>>6&1,this.F_SIGN=t>>7&1,this.REG_PC=this.pull(),this.REG_PC+=this.pull()<<8,65535===this.REG_PC)return;this.REG_PC--,this.F_NOTUSED=1;break;case 42:if(this.REG_PC=this.pull(),this.REG_PC+=this.pull()<<8,65535===this.REG_PC)return;break;case 43:t=this.REG_ACC-this.load(o)-(1-this.F_CARRY),this.F_SIGN=t>>7&1,this.F_ZERO=255&t,0!=(128&(this.REG_ACC^t))&&0!=(128&(this.REG_ACC^this.load(o)))?this.F_OVERFLOW=1:this.F_OVERFLOW=0,this.F_CARRY=t<0?0:1,this.REG_ACC=255&t,11!==n&&(s+=r);break;case 44:this.F_CARRY=1;break;case 45:this.F_DECIMAL=1;break;case 46:this.F_INTERRUPT=1;break;case 47:this.write(o,this.REG_ACC);break;case 48:this.write(o,this.REG_X);break;case 49:this.write(o,this.REG_Y);break;case 50:this.REG_X=this.REG_ACC,this.F_SIGN=this.REG_ACC>>7&1,this.F_ZERO=this.REG_ACC;break;case 51:this.REG_Y=this.REG_ACC,this.F_SIGN=this.REG_ACC>>7&1,this.F_ZERO=this.REG_ACC;break;case 52:this.REG_X=this.REG_SP-256,this.F_SIGN=this.REG_SP>>7&1,this.F_ZERO=this.REG_X;break;case 53:this.REG_ACC=this.REG_X,this.F_SIGN=this.REG_X>>7&1,this.F_ZERO=this.REG_X;break;case 54:this.REG_SP=this.REG_X+256,this.stackWrap();break;case 55:this.REG_ACC=this.REG_Y,this.F_SIGN=this.REG_Y>>7&1,this.F_ZERO=this.REG_Y;break;case 56:t=this.REG_ACC&this.load(o),this.F_CARRY=1&t,this.REG_ACC=this.F_ZERO=t>>1,this.F_SIGN=0;break;case 57:this.REG_ACC=this.F_ZERO=this.REG_ACC&this.load(o),this.F_CARRY=this.F_SIGN=this.REG_ACC>>7&1;break;case 58:t=this.REG_ACC&this.load(o),this.REG_ACC=this.F_ZERO=(t>>1)+(this.F_CARRY<<7),this.F_SIGN=this.F_CARRY,this.F_CARRY=t>>7&1,this.F_OVERFLOW=1&(t>>7^t>>6);break;case 59:t=(this.REG_X&this.REG_ACC)-this.load(o),this.F_SIGN=t>>7&1,this.F_ZERO=255&t,0!=(128&(this.REG_X^t))&&0!=(128&(this.REG_X^this.load(o)))?this.F_OVERFLOW=1:this.F_OVERFLOW=0,this.F_CARRY=t<0?0:1,this.REG_X=255&t;break;case 60:this.REG_ACC=this.REG_X=this.F_ZERO=this.load(o),this.F_SIGN=this.REG_ACC>>7&1,s+=r;break;case 61:this.write(o,this.REG_ACC&this.REG_X);break;case 62:t=this.load(o)-1&255,this.write(o,t),t=this.REG_ACC-t,this.F_CARRY=t>=0?1:0,this.F_SIGN=t>>7&1,this.F_ZERO=255&t,11!==n&&(s+=r);break;case 63:t=this.load(o)+1&255,this.write(o,t),t=this.REG_ACC-t-(1-this.F_CARRY),this.F_SIGN=t>>7&1,this.F_ZERO=255&t,0!=(128&(this.REG_ACC^t))&&0!=(128&(this.REG_ACC^this.load(o)))?this.F_OVERFLOW=1:this.F_OVERFLOW=0,this.F_CARRY=t<0?0:1,this.REG_ACC=255&t,11!==n&&(s+=r);break;case 64:t=this.load(o),e=this.F_CARRY,this.F_CARRY=t>>7&1,t=(t<<1&255)+e,this.write(o,t),this.REG_ACC=this.REG_ACC&t,this.F_SIGN=this.REG_ACC>>7&1,this.F_ZERO=this.REG_ACC,11!==n&&(s+=r);break;case 65:t=this.load(o),e=this.F_CARRY<<7,this.F_CARRY=1&t,t=(t>>1)+e,this.write(o,t),t=this.REG_ACC+this.load(o)+this.F_CARRY,0==(128&(this.REG_ACC^this.load(o)))&&0!=(128&(this.REG_ACC^t))?this.F_OVERFLOW=1:this.F_OVERFLOW=0,this.F_CARRY=t>255?1:0,this.F_SIGN=t>>7&1,this.F_ZERO=255&t,this.REG_ACC=255&t,11!==n&&(s+=r);break;case 66:t=this.load(o),this.F_CARRY=t>>7&1,t=t<<1&255,this.write(o,t),this.REG_ACC=this.REG_ACC|t,this.F_SIGN=this.REG_ACC>>7&1,this.F_ZERO=this.REG_ACC,11!==n&&(s+=r);break;case 67:t=255&this.load(o),this.F_CARRY=1&t,t>>=1,this.write(o,t),this.REG_ACC=this.REG_ACC^t,this.F_SIGN=this.REG_ACC>>7&1,this.F_ZERO=this.REG_ACC,11!==n&&(s+=r);break;case 69:this.load(o),11!==n&&(s+=r);break;default:this.nes.stop(),this.nes.crashMessage="Game crashed, invalid opcode at address $"+h.toString(16)}return s},load:function(t){return t<8192?this.mem[2047&t]:this.nes.mmap.load(t)},load16bit:function(t){return t<8191?this.mem[2047&t]|this.mem[t+1&2047]<<8:this.nes.mmap.load(t)|this.nes.mmap.load(t+1)<<8},write:function(t,e){t<8192?this.mem[2047&t]=e:this.nes.mmap.write(t,e)},requestIrq:function(t){this.irqRequested&&t===this.IRQ_NORMAL||(this.irqRequested=!0,this.irqType=t)},push:function(t){this.nes.mmap.write(this.REG_SP,t),this.REG_SP--,this.REG_SP=256|255&this.REG_SP},stackWrap:function(){this.REG_SP=256|255&this.REG_SP},pull:function(){return this.REG_SP++,this.REG_SP=256|255&this.REG_SP,this.nes.mmap.load(this.REG_SP)},pageCrossed:function(t,e){return(65280&t)!=(65280&e)},haltCycles:function(t){this.cyclesToHalt+=t},doNonMaskableInterrupt:function(t){0!=(128&this.nes.mmap.load(8192))&&(this.REG_PC_NEW++,this.push(this.REG_PC_NEW>>8&255),this.push(255&this.REG_PC_NEW),this.push(t),this.REG_PC_NEW=this.nes.mmap.load(65530)|this.nes.mmap.load(65531)<<8,this.REG_PC_NEW--)},doResetInterrupt:function(){this.REG_PC_NEW=this.nes.mmap.load(65532)|this.nes.mmap.load(65533)<<8,this.REG_PC_NEW--},doIrq:function(t){this.REG_PC_NEW++,this.push(this.REG_PC_NEW>>8&255),this.push(255&this.REG_PC_NEW),this.push(t),this.F_INTERRUPT_NEW=1,this.F_BRK_NEW=0,this.REG_PC_NEW=this.nes.mmap.load(65534)|this.nes.mmap.load(65535)<<8,this.REG_PC_NEW--},getStatus:function(){return this.F_CARRY|this.F_ZERO<<1|this.F_INTERRUPT<<2|this.F_DECIMAL<<3|this.F_BRK<<4|this.F_NOTUSED<<5|this.F_OVERFLOW<<6|this.F_SIGN<<7},setStatus:function(t){this.F_CARRY=1&t,this.F_ZERO=t>>1&1,this.F_INTERRUPT=t>>2&1,this.F_DECIMAL=t>>3&1,this.F_BRK=t>>4&1,this.F_NOTUSED=t>>5&1,this.F_OVERFLOW=t>>6&1,this.F_SIGN=t>>7&1},JSON_PROPERTIES:["mem","cyclesToHalt","irqRequested","irqType","REG_ACC","REG_X","REG_Y","REG_SP","REG_PC","REG_PC_NEW","REG_STATUS","F_CARRY","F_DECIMAL","F_INTERRUPT","F_INTERRUPT_NEW","F_OVERFLOW","F_SIGN","F_ZERO","F_NOTUSED","F_NOTUSED_NEW","F_BRK","F_BRK_NEW"],toJSON:function(){return s.toJSON(this)},fromJSON:function(t){s.fromJSON(this,t)}};var n=function(){this.opdata=new Array(256);for(var t=0;t<256;t++)this.opdata[t]=255;this.setOp(this.INS_ADC,105,this.ADDR_IMM,2,2),this.setOp(this.INS_ADC,101,this.ADDR_ZP,2,3),this.setOp(this.INS_ADC,117,this.ADDR_ZPX,2,4),this.setOp(this.INS_ADC,109,this.ADDR_ABS,3,4),this.setOp(this.INS_ADC,125,this.ADDR_ABSX,3,4),this.setOp(this.INS_ADC,121,this.ADDR_ABSY,3,4),this.setOp(this.INS_ADC,97,this.ADDR_PREIDXIND,2,6),this.setOp(this.INS_ADC,113,this.ADDR_POSTIDXIND,2,5),this.setOp(this.INS_AND,41,this.ADDR_IMM,2,2),this.setOp(this.INS_AND,37,this.ADDR_ZP,2,3),this.setOp(this.INS_AND,53,this.ADDR_ZPX,2,4),this.setOp(this.INS_AND,45,this.ADDR_ABS,3,4),this.setOp(this.INS_AND,61,this.ADDR_ABSX,3,4),this.setOp(this.INS_AND,57,this.ADDR_ABSY,3,4),this.setOp(this.INS_AND,33,this.ADDR_PREIDXIND,2,6),this.setOp(this.INS_AND,49,this.ADDR_POSTIDXIND,2,5),this.setOp(this.INS_ASL,10,this.ADDR_ACC,1,2),this.setOp(this.INS_ASL,6,this.ADDR_ZP,2,5),this.setOp(this.INS_ASL,22,this.ADDR_ZPX,2,6),this.setOp(this.INS_ASL,14,this.ADDR_ABS,3,6),this.setOp(this.INS_ASL,30,this.ADDR_ABSX,3,7),this.setOp(this.INS_BCC,144,this.ADDR_REL,2,2),this.setOp(this.INS_BCS,176,this.ADDR_REL,2,2),this.setOp(this.INS_BEQ,240,this.ADDR_REL,2,2),this.setOp(this.INS_BIT,36,this.ADDR_ZP,2,3),this.setOp(this.INS_BIT,44,this.ADDR_ABS,3,4),this.setOp(this.INS_BMI,48,this.ADDR_REL,2,2),this.setOp(this.INS_BNE,208,this.ADDR_REL,2,2),this.setOp(this.INS_BPL,16,this.ADDR_REL,2,2),this.setOp(this.INS_BRK,0,this.ADDR_IMP,1,7),this.setOp(this.INS_BVC,80,this.ADDR_REL,2,2),this.setOp(this.INS_BVS,112,this.ADDR_REL,2,2),this.setOp(this.INS_CLC,24,this.ADDR_IMP,1,2),this.setOp(this.INS_CLD,216,this.ADDR_IMP,1,2),this.setOp(this.INS_CLI,88,this.ADDR_IMP,1,2),this.setOp(this.INS_CLV,184,this.ADDR_IMP,1,2),this.setOp(this.INS_CMP,201,this.ADDR_IMM,2,2),this.setOp(this.INS_CMP,197,this.ADDR_ZP,2,3),this.setOp(this.INS_CMP,213,this.ADDR_ZPX,2,4),this.setOp(this.INS_CMP,205,this.ADDR_ABS,3,4),this.setOp(this.INS_CMP,221,this.ADDR_ABSX,3,4),this.setOp(this.INS_CMP,217,this.ADDR_ABSY,3,4),this.setOp(this.INS_CMP,193,this.ADDR_PREIDXIND,2,6),this.setOp(this.INS_CMP,209,this.ADDR_POSTIDXIND,2,5),this.setOp(this.INS_CPX,224,this.ADDR_IMM,2,2),this.setOp(this.INS_CPX,228,this.ADDR_ZP,2,3),this.setOp(this.INS_CPX,236,this.ADDR_ABS,3,4),this.setOp(this.INS_CPY,192,this.ADDR_IMM,2,2),this.setOp(this.INS_CPY,196,this.ADDR_ZP,2,3),this.setOp(this.INS_CPY,204,this.ADDR_ABS,3,4),this.setOp(this.INS_DEC,198,this.ADDR_ZP,2,5),this.setOp(this.INS_DEC,214,this.ADDR_ZPX,2,6),this.setOp(this.INS_DEC,206,this.ADDR_ABS,3,6),this.setOp(this.INS_DEC,222,this.ADDR_ABSX,3,7),this.setOp(this.INS_DEX,202,this.ADDR_IMP,1,2),this.setOp(this.INS_DEY,136,this.ADDR_IMP,1,2),this.setOp(this.INS_EOR,73,this.ADDR_IMM,2,2),this.setOp(this.INS_EOR,69,this.ADDR_ZP,2,3),this.setOp(this.INS_EOR,85,this.ADDR_ZPX,2,4),this.setOp(this.INS_EOR,77,this.ADDR_ABS,3,4),this.setOp(this.INS_EOR,93,this.ADDR_ABSX,3,4),this.setOp(this.INS_EOR,89,this.ADDR_ABSY,3,4),this.setOp(this.INS_EOR,65,this.ADDR_PREIDXIND,2,6),this.setOp(this.INS_EOR,81,this.ADDR_POSTIDXIND,2,5),this.setOp(this.INS_INC,230,this.ADDR_ZP,2,5),this.setOp(this.INS_INC,246,this.ADDR_ZPX,2,6),this.setOp(this.INS_INC,238,this.ADDR_ABS,3,6),this.setOp(this.INS_INC,254,this.ADDR_ABSX,3,7),this.setOp(this.INS_INX,232,this.ADDR_IMP,1,2),this.setOp(this.INS_INY,200,this.ADDR_IMP,1,2),this.setOp(this.INS_JMP,76,this.ADDR_ABS,3,3),this.setOp(this.INS_JMP,108,this.ADDR_INDABS,3,5),this.setOp(this.INS_JSR,32,this.ADDR_ABS,3,6),this.setOp(this.INS_LDA,169,this.ADDR_IMM,2,2),this.setOp(this.INS_LDA,165,this.ADDR_ZP,2,3),this.setOp(this.INS_LDA,181,this.ADDR_ZPX,2,4),this.setOp(this.INS_LDA,173,this.ADDR_ABS,3,4),this.setOp(this.INS_LDA,189,this.ADDR_ABSX,3,4),this.setOp(this.INS_LDA,185,this.ADDR_ABSY,3,4),this.setOp(this.INS_LDA,161,this.ADDR_PREIDXIND,2,6),this.setOp(this.INS_LDA,177,this.ADDR_POSTIDXIND,2,5),this.setOp(this.INS_LDX,162,this.ADDR_IMM,2,2),this.setOp(this.INS_LDX,166,this.ADDR_ZP,2,3),this.setOp(this.INS_LDX,182,this.ADDR_ZPY,2,4),this.setOp(this.INS_LDX,174,this.ADDR_ABS,3,4),this.setOp(this.INS_LDX,190,this.ADDR_ABSY,3,4),this.setOp(this.INS_LDY,160,this.ADDR_IMM,2,2),this.setOp(this.INS_LDY,164,this.ADDR_ZP,2,3),this.setOp(this.INS_LDY,180,this.ADDR_ZPX,2,4),this.setOp(this.INS_LDY,172,this.ADDR_ABS,3,4),this.setOp(this.INS_LDY,188,this.ADDR_ABSX,3,4),this.setOp(this.INS_LSR,74,this.ADDR_ACC,1,2),this.setOp(this.INS_LSR,70,this.ADDR_ZP,2,5),this.setOp(this.INS_LSR,86,this.ADDR_ZPX,2,6),this.setOp(this.INS_LSR,78,this.ADDR_ABS,3,6),this.setOp(this.INS_LSR,94,this.ADDR_ABSX,3,7),this.setOp(this.INS_NOP,26,this.ADDR_IMP,1,2),this.setOp(this.INS_NOP,58,this.ADDR_IMP,1,2),this.setOp(this.INS_NOP,90,this.ADDR_IMP,1,2),this.setOp(this.INS_NOP,122,this.ADDR_IMP,1,2),this.setOp(this.INS_NOP,218,this.ADDR_IMP,1,2),this.setOp(this.INS_NOP,234,this.ADDR_IMP,1,2),this.setOp(this.INS_NOP,250,this.ADDR_IMP,1,2),this.setOp(this.INS_ORA,9,this.ADDR_IMM,2,2),this.setOp(this.INS_ORA,5,this.ADDR_ZP,2,3),this.setOp(this.INS_ORA,21,this.ADDR_ZPX,2,4),this.setOp(this.INS_ORA,13,this.ADDR_ABS,3,4),this.setOp(this.INS_ORA,29,this.ADDR_ABSX,3,4),this.setOp(this.INS_ORA,25,this.ADDR_ABSY,3,4),this.setOp(this.INS_ORA,1,this.ADDR_PREIDXIND,2,6),this.setOp(this.INS_ORA,17,this.ADDR_POSTIDXIND,2,5),this.setOp(this.INS_PHA,72,this.ADDR_IMP,1,3),this.setOp(this.INS_PHP,8,this.ADDR_IMP,1,3),this.setOp(this.INS_PLA,104,this.ADDR_IMP,1,4),this.setOp(this.INS_PLP,40,this.ADDR_IMP,1,4),this.setOp(this.INS_ROL,42,this.ADDR_ACC,1,2),this.setOp(this.INS_ROL,38,this.ADDR_ZP,2,5),this.setOp(this.INS_ROL,54,this.ADDR_ZPX,2,6),this.setOp(this.INS_ROL,46,this.ADDR_ABS,3,6),this.setOp(this.INS_ROL,62,this.ADDR_ABSX,3,7),this.setOp(this.INS_ROR,106,this.ADDR_ACC,1,2),this.setOp(this.INS_ROR,102,this.ADDR_ZP,2,5),this.setOp(this.INS_ROR,118,this.ADDR_ZPX,2,6),this.setOp(this.INS_ROR,110,this.ADDR_ABS,3,6),this.setOp(this.INS_ROR,126,this.ADDR_ABSX,3,7),this.setOp(this.INS_RTI,64,this.ADDR_IMP,1,6),this.setOp(this.INS_RTS,96,this.ADDR_IMP,1,6),this.setOp(this.INS_SBC,233,this.ADDR_IMM,2,2),this.setOp(this.INS_SBC,229,this.ADDR_ZP,2,3),this.setOp(this.INS_SBC,245,this.ADDR_ZPX,2,4),this.setOp(this.INS_SBC,237,this.ADDR_ABS,3,4),this.setOp(this.INS_SBC,253,this.ADDR_ABSX,3,4),this.setOp(this.INS_SBC,249,this.ADDR_ABSY,3,4),this.setOp(this.INS_SBC,225,this.ADDR_PREIDXIND,2,6),this.setOp(this.INS_SBC,241,this.ADDR_POSTIDXIND,2,5),this.setOp(this.INS_SEC,56,this.ADDR_IMP,1,2),this.setOp(this.INS_SED,248,this.ADDR_IMP,1,2),this.setOp(this.INS_SEI,120,this.ADDR_IMP,1,2),this.setOp(this.INS_STA,133,this.ADDR_ZP,2,3),this.setOp(this.INS_STA,149,this.ADDR_ZPX,2,4),this.setOp(this.INS_STA,141,this.ADDR_ABS,3,4),this.setOp(this.INS_STA,157,this.ADDR_ABSX,3,5),this.setOp(this.INS_STA,153,this.ADDR_ABSY,3,5),this.setOp(this.INS_STA,129,this.ADDR_PREIDXIND,2,6),this.setOp(this.INS_STA,145,this.ADDR_POSTIDXIND,2,6),this.setOp(this.INS_STX,134,this.ADDR_ZP,2,3),this.setOp(this.INS_STX,150,this.ADDR_ZPY,2,4),this.setOp(this.INS_STX,142,this.ADDR_ABS,3,4),this.setOp(this.INS_STY,132,this.ADDR_ZP,2,3),this.setOp(this.INS_STY,148,this.ADDR_ZPX,2,4),this.setOp(this.INS_STY,140,this.ADDR_ABS,3,4),this.setOp(this.INS_TAX,170,this.ADDR_IMP,1,2),this.setOp(this.INS_TAY,168,this.ADDR_IMP,1,2),this.setOp(this.INS_TSX,186,this.ADDR_IMP,1,2),this.setOp(this.INS_TXA,138,this.ADDR_IMP,1,2),this.setOp(this.INS_TXS,154,this.ADDR_IMP,1,2),this.setOp(this.INS_TYA,152,this.ADDR_IMP,1,2),this.setOp(this.INS_ALR,75,this.ADDR_IMM,2,2),this.setOp(this.INS_ANC,11,this.ADDR_IMM,2,2),this.setOp(this.INS_ANC,43,this.ADDR_IMM,2,2),this.setOp(this.INS_ARR,107,this.ADDR_IMM,2,2),this.setOp(this.INS_AXS,203,this.ADDR_IMM,2,2),this.setOp(this.INS_LAX,163,this.ADDR_PREIDXIND,2,6),this.setOp(this.INS_LAX,167,this.ADDR_ZP,2,3),this.setOp(this.INS_LAX,175,this.ADDR_ABS,3,4),this.setOp(this.INS_LAX,179,this.ADDR_POSTIDXIND,2,5),this.setOp(this.INS_LAX,183,this.ADDR_ZPY,2,4),this.setOp(this.INS_LAX,191,this.ADDR_ABSY,3,4),this.setOp(this.INS_SAX,131,this.ADDR_PREIDXIND,2,6),this.setOp(this.INS_SAX,135,this.ADDR_ZP,2,3),this.setOp(this.INS_SAX,143,this.ADDR_ABS,3,4),this.setOp(this.INS_SAX,151,this.ADDR_ZPY,2,4),this.setOp(this.INS_DCP,195,this.ADDR_PREIDXIND,2,8),this.setOp(this.INS_DCP,199,this.ADDR_ZP,2,5),this.setOp(this.INS_DCP,207,this.ADDR_ABS,3,6),this.setOp(this.INS_DCP,211,this.ADDR_POSTIDXIND,2,8),this.setOp(this.INS_DCP,215,this.ADDR_ZPX,2,6),this.setOp(this.INS_DCP,219,this.ADDR_ABSY,3,7),this.setOp(this.INS_DCP,223,this.ADDR_ABSX,3,7),this.setOp(this.INS_ISC,227,this.ADDR_PREIDXIND,2,8),this.setOp(this.INS_ISC,231,this.ADDR_ZP,2,5),this.setOp(this.INS_ISC,239,this.ADDR_ABS,3,6),this.setOp(this.INS_ISC,243,this.ADDR_POSTIDXIND,2,8),this.setOp(this.INS_ISC,247,this.ADDR_ZPX,2,6),this.setOp(this.INS_ISC,251,this.ADDR_ABSY,3,7),this.setOp(this.INS_ISC,255,this.ADDR_ABSX,3,7),this.setOp(this.INS_RLA,35,this.ADDR_PREIDXIND,2,8),this.setOp(this.INS_RLA,39,this.ADDR_ZP,2,5),this.setOp(this.INS_RLA,47,this.ADDR_ABS,3,6),this.setOp(this.INS_RLA,51,this.ADDR_POSTIDXIND,2,8),this.setOp(this.INS_RLA,55,this.ADDR_ZPX,2,6),this.setOp(this.INS_RLA,59,this.ADDR_ABSY,3,7),this.setOp(this.INS_RLA,63,this.ADDR_ABSX,3,7),this.setOp(this.INS_RRA,99,this.ADDR_PREIDXIND,2,8),this.setOp(this.INS_RRA,103,this.ADDR_ZP,2,5),this.setOp(this.INS_RRA,111,this.ADDR_ABS,3,6),this.setOp(this.INS_RRA,115,this.ADDR_POSTIDXIND,2,8),this.setOp(this.INS_RRA,119,this.ADDR_ZPX,2,6),this.setOp(this.INS_RRA,123,this.ADDR_ABSY,3,7),this.setOp(this.INS_RRA,127,this.ADDR_ABSX,3,7),this.setOp(this.INS_SLO,3,this.ADDR_PREIDXIND,2,8),this.setOp(this.INS_SLO,7,this.ADDR_ZP,2,5),this.setOp(this.INS_SLO,15,this.ADDR_ABS,3,6),this.setOp(this.INS_SLO,19,this.ADDR_POSTIDXIND,2,8),this.setOp(this.INS_SLO,23,this.ADDR_ZPX,2,6),this.setOp(this.INS_SLO,27,this.ADDR_ABSY,3,7),this.setOp(this.INS_SLO,31,this.ADDR_ABSX,3,7),this.setOp(this.INS_SRE,67,this.ADDR_PREIDXIND,2,8),this.setOp(this.INS_SRE,71,this.ADDR_ZP,2,5),this.setOp(this.INS_SRE,79,this.ADDR_ABS,3,6),this.setOp(this.INS_SRE,83,this.ADDR_POSTIDXIND,2,8),this.setOp(this.INS_SRE,87,this.ADDR_ZPX,2,6),this.setOp(this.INS_SRE,91,this.ADDR_ABSY,3,7),this.setOp(this.INS_SRE,95,this.ADDR_ABSX,3,7),this.setOp(this.INS_SKB,128,this.ADDR_IMM,2,2),this.setOp(this.INS_SKB,130,this.ADDR_IMM,2,2),this.setOp(this.INS_SKB,137,this.ADDR_IMM,2,2),this.setOp(this.INS_SKB,194,this.ADDR_IMM,2,2),this.setOp(this.INS_SKB,226,this.ADDR_IMM,2,2),this.setOp(this.INS_IGN,12,this.ADDR_ABS,3,4),this.setOp(this.INS_IGN,28,this.ADDR_ABSX,3,4),this.setOp(this.INS_IGN,60,this.ADDR_ABSX,3,4),this.setOp(this.INS_IGN,92,this.ADDR_ABSX,3,4),this.setOp(this.INS_IGN,124,this.ADDR_ABSX,3,4),this.setOp(this.INS_IGN,220,this.ADDR_ABSX,3,4),this.setOp(this.INS_IGN,252,this.ADDR_ABSX,3,4),this.setOp(this.INS_IGN,4,this.ADDR_ZP,2,3),this.setOp(this.INS_IGN,68,this.ADDR_ZP,2,3),this.setOp(this.INS_IGN,100,this.ADDR_ZP,2,3),this.setOp(this.INS_IGN,20,this.ADDR_ZPX,2,4),this.setOp(this.INS_IGN,52,this.ADDR_ZPX,2,4),this.setOp(this.INS_IGN,84,this.ADDR_ZPX,2,4),this.setOp(this.INS_IGN,116,this.ADDR_ZPX,2,4),this.setOp(this.INS_IGN,212,this.ADDR_ZPX,2,4),this.setOp(this.INS_IGN,244,this.ADDR_ZPX,2,4),this.cycTable=new Array(7,6,2,8,3,3,5,5,3,2,2,2,4,4,6,6,2,5,2,8,4,4,6,6,2,4,2,7,4,4,7,7,6,6,2,8,3,3,5,5,4,2,2,2,4,4,6,6,2,5,2,8,4,4,6,6,2,4,2,7,4,4,7,7,6,6,2,8,3,3,5,5,3,2,2,2,3,4,6,6,2,5,2,8,4,4,6,6,2,4,2,7,4,4,7,7,6,6,2,8,3,3,5,5,4,2,2,2,5,4,6,6,2,5,2,8,4,4,6,6,2,4,2,7,4,4,7,7,2,6,2,6,3,3,3,3,2,2,2,2,4,4,4,4,2,6,2,6,4,4,4,4,2,5,2,5,5,5,5,5,2,6,2,6,3,3,3,3,2,2,2,2,4,4,4,4,2,5,2,5,4,4,4,4,2,4,2,4,4,4,4,4,2,6,2,8,3,3,5,5,2,2,2,2,4,4,6,6,2,5,2,8,4,4,6,6,2,4,2,7,4,4,7,7,2,6,3,8,3,3,5,5,2,2,2,2,4,4,6,6,2,5,2,8,4,4,6,6,2,4,2,7,4,4,7,7),this.instname=new Array(70),this.instname[0]="ADC",this.instname[1]="AND",this.instname[2]="ASL",this.instname[3]="BCC",this.instname[4]="BCS",this.instname[5]="BEQ",this.instname[6]="BIT",this.instname[7]="BMI",this.instname[8]="BNE",this.instname[9]="BPL",this.instname[10]="BRK",this.instname[11]="BVC",this.instname[12]="BVS",this.instname[13]="CLC",this.instname[14]="CLD",this.instname[15]="CLI",this.instname[16]="CLV",this.instname[17]="CMP",this.instname[18]="CPX",this.instname[19]="CPY",this.instname[20]="DEC",this.instname[21]="DEX",this.instname[22]="DEY",this.instname[23]="EOR",this.instname[24]="INC",this.instname[25]="INX",this.instname[26]="INY",this.instname[27]="JMP",this.instname[28]="JSR",this.instname[29]="LDA",this.instname[30]="LDX",this.instname[31]="LDY",this.instname[32]="LSR",this.instname[33]="NOP",this.instname[34]="ORA",this.instname[35]="PHA",this.instname[36]="PHP",this.instname[37]="PLA",this.instname[38]="PLP",this.instname[39]="ROL",this.instname[40]="ROR",this.instname[41]="RTI",this.instname[42]="RTS",this.instname[43]="SBC",this.instname[44]="SEC",this.instname[45]="SED",this.instname[46]="SEI",this.instname[47]="STA",this.instname[48]="STX",this.instname[49]="STY",this.instname[50]="TAX",this.instname[51]="TAY",this.instname[52]="TSX",this.instname[53]="TXA",this.instname[54]="TXS",this.instname[55]="TYA",this.instname[56]="ALR",this.instname[57]="ANC",this.instname[58]="ARR",this.instname[59]="AXS",this.instname[60]="LAX",this.instname[61]="SAX",this.instname[62]="DCP",this.instname[63]="ISC",this.instname[64]="RLA",this.instname[65]="RRA",this.instname[66]="SLO",this.instname[67]="SRE",this.instname[68]="SKB",this.instname[69]="IGN",this.addrDesc=new Array("Zero Page           ","Relative            ","Implied             ","Absolute            ","Accumulator         ","Immediate           ","Zero Page,X         ","Zero Page,Y         ","Absolute,X          ","Absolute,Y          ","Preindexed Indirect ","Postindexed Indirect","Indirect Absolute   ")};n.prototype={INS_ADC:0,INS_AND:1,INS_ASL:2,INS_BCC:3,INS_BCS:4,INS_BEQ:5,INS_BIT:6,INS_BMI:7,INS_BNE:8,INS_BPL:9,INS_BRK:10,INS_BVC:11,INS_BVS:12,INS_CLC:13,INS_CLD:14,INS_CLI:15,INS_CLV:16,INS_CMP:17,INS_CPX:18,INS_CPY:19,INS_DEC:20,INS_DEX:21,INS_DEY:22,INS_EOR:23,INS_INC:24,INS_INX:25,INS_INY:26,INS_JMP:27,INS_JSR:28,INS_LDA:29,INS_LDX:30,INS_LDY:31,INS_LSR:32,INS_NOP:33,INS_ORA:34,INS_PHA:35,INS_PHP:36,INS_PLA:37,INS_PLP:38,INS_ROL:39,INS_ROR:40,INS_RTI:41,INS_RTS:42,INS_SBC:43,INS_SEC:44,INS_SED:45,INS_SEI:46,INS_STA:47,INS_STX:48,INS_STY:49,INS_TAX:50,INS_TAY:51,INS_TSX:52,INS_TXA:53,INS_TXS:54,INS_TYA:55,INS_ALR:56,INS_ANC:57,INS_ARR:58,INS_AXS:59,INS_LAX:60,INS_SAX:61,INS_DCP:62,INS_ISC:63,INS_RLA:64,INS_RRA:65,INS_SLO:66,INS_SRE:67,INS_SKB:68,INS_IGN:69,INS_DUMMY:70,ADDR_ZP:0,ADDR_REL:1,ADDR_IMP:2,ADDR_ABS:3,ADDR_ACC:4,ADDR_IMM:5,ADDR_ZPX:6,ADDR_ZPY:7,ADDR_ABSX:8,ADDR_ABSY:9,ADDR_PREIDXIND:10,ADDR_POSTIDXIND:11,ADDR_INDABS:12,setOp:function(t,e,i,s,r){this.opdata[e]=255&t|(255&i)<<8|(255&s)<<16|(255&r)<<24}},t.exports=r},520:(t,e,i)=>{t.exports={Controller:i(188),NES:i(744)}},939:(t,e,i)=>{var s=i(610),r={0:function(t){this.nes=t}};r[0].prototype={reset:function(){this.joy1StrobeState=0,this.joy2StrobeState=0,this.joypadLastWrite=0,this.zapperFired=!1,this.zapperX=null,this.zapperY=null},write:function(t,e){t<8192?this.nes.cpu.mem[2047&t]=e:t>16407?(this.nes.cpu.mem[t]=e,t>=24576&&t<32768&&this.nes.opts.onBatteryRamWrite(t,e)):t>8199&&t<16384?this.regWrite(8192+(7&t),e):this.regWrite(t,e)},writelow:function(t,e){t<8192?this.nes.cpu.mem[2047&t]=e:t>16407?this.nes.cpu.mem[t]=e:t>8199&&t<16384?this.regWrite(8192+(7&t),e):this.regWrite(t,e)},load:function(t){return(t&=65535)>16407?this.nes.cpu.mem[t]:t>=8192?this.regLoad(t):this.nes.cpu.mem[2047&t]},regLoad:function(t){switch(t>>12){case 0:case 1:break;case 2:case 3:switch(7&t){case 0:return this.nes.cpu.mem[8192];case 1:return this.nes.cpu.mem[8193];case 2:return this.nes.ppu.readStatusRegister();case 3:case 5:case 6:return 0;case 4:return this.nes.ppu.sramLoad();case 7:return this.nes.ppu.vramLoad()}break;case 4:switch(t-16405){case 0:return this.nes.papu.readReg(t);case 1:return this.joy1Read();case 2:var e;return e=null!==this.zapperX&&null!==this.zapperY&&this.nes.ppu.isPixelWhite(this.zapperX,this.zapperY)?0:8,this.zapperFired&&(e|=16),65535&(this.joy2Read()|e)}}return 0},regWrite:function(t,e){switch(t){case 8192:this.nes.cpu.mem[t]=e,this.nes.ppu.updateControlReg1(e);break;case 8193:this.nes.cpu.mem[t]=e,this.nes.ppu.updateControlReg2(e);break;case 8195:this.nes.ppu.writeSRAMAddress(e);break;case 8196:this.nes.ppu.sramWrite(e);break;case 8197:this.nes.ppu.scrollWrite(e);break;case 8198:this.nes.ppu.writeVRAMAddress(e);break;case 8199:this.nes.ppu.vramWrite(e);break;case 16404:this.nes.ppu.sramDMA(e);break;case 16405:case 16407:this.nes.papu.writeReg(t,e);break;case 16406:0==(1&e)&&1==(1&this.joypadLastWrite)&&(this.joy1StrobeState=0,this.joy2StrobeState=0),this.joypadLastWrite=e;break;default:t>=16384&&t<=16407&&this.nes.papu.writeReg(t,e)}},joy1Read:function(){var t;switch(this.joy1StrobeState){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:t=this.nes.controllers[1].state[this.joy1StrobeState];break;case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:case 16:case 17:case 18:default:t=0;break;case 19:t=1}return this.joy1StrobeState++,24===this.joy1StrobeState&&(this.joy1StrobeState=0),t},joy2Read:function(){var t;switch(this.joy2StrobeState){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:t=this.nes.controllers[2].state[this.joy2StrobeState];break;case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:case 16:case 17:case 18:default:t=0;break;case 19:t=1}return this.joy2StrobeState++,24===this.joy2StrobeState&&(this.joy2StrobeState=0),t},loadROM:function(){if(!this.nes.rom.valid||this.nes.rom.romCount<1)throw new Error("NoMapper: Invalid ROM! Unable to load.");this.loadPRGROM(),this.loadCHRROM(),this.loadBatteryRam(),this.nes.cpu.requestIrq(this.nes.cpu.IRQ_RESET)},loadPRGROM:function(){this.nes.rom.romCount>1?(this.loadRomBank(0,32768),this.loadRomBank(1,49152)):(this.loadRomBank(0,32768),this.loadRomBank(0,49152))},loadCHRROM:function(){this.nes.rom.vromCount>0&&(1===this.nes.rom.vromCount?(this.loadVromBank(0,0),this.loadVromBank(0,4096)):(this.loadVromBank(0,0),this.loadVromBank(1,4096)))},loadBatteryRam:function(){if(this.nes.rom.batteryRam){var t=this.nes.rom.batteryRam;null!==t&&8192===t.length&&s.copyArrayElements(t,0,this.nes.cpu.mem,24576,8192)}},loadRomBank:function(t,e){t%=this.nes.rom.romCount,s.copyArrayElements(this.nes.rom.rom[t],0,this.nes.cpu.mem,e,16384)},loadVromBank:function(t,e){if(0!==this.nes.rom.vromCount){this.nes.ppu.triggerRendering(),s.copyArrayElements(this.nes.rom.vrom[t%this.nes.rom.vromCount],0,this.nes.ppu.vramMem,e,4096);var i=this.nes.rom.vromTile[t%this.nes.rom.vromCount];s.copyArrayElements(i,0,this.nes.ppu.ptTile,e>>4,256)}},load32kRomBank:function(t,e){this.loadRomBank(2*t%this.nes.rom.romCount,e),this.loadRomBank((2*t+1)%this.nes.rom.romCount,e+16384)},load8kVromBank:function(t,e){0!==this.nes.rom.vromCount&&(this.nes.ppu.triggerRendering(),this.loadVromBank(t%this.nes.rom.vromCount,e),this.loadVromBank((t+1)%this.nes.rom.vromCount,e+4096))},load1kVromBank:function(t,e){if(0!==this.nes.rom.vromCount){this.nes.ppu.triggerRendering();var i=Math.floor(t/4)%this.nes.rom.vromCount,r=t%4*1024;s.copyArrayElements(this.nes.rom.vrom[i],r,this.nes.ppu.vramMem,e,1024);for(var n=this.nes.rom.vromTile[i],h=e>>4,o=0;o<64;o++)this.nes.ppu.ptTile[h+o]=n[(t%4<<6)+o]}},load2kVromBank:function(t,e){if(0!==this.nes.rom.vromCount){this.nes.ppu.triggerRendering();var i=Math.floor(t/2)%this.nes.rom.vromCount,r=t%2*2048;s.copyArrayElements(this.nes.rom.vrom[i],r,this.nes.ppu.vramMem,e,2048);for(var n=this.nes.rom.vromTile[i],h=e>>4,o=0;o<128;o++)this.nes.ppu.ptTile[h+o]=n[(t%2<<7)+o]}},load8kRomBank:function(t,e){var i=Math.floor(t/2)%this.nes.rom.romCount,r=t%2*8192;s.copyArrayElements(this.nes.rom.rom[i],r,this.nes.cpu.mem,e,8192)},clockIrqCounter:function(){},latchAccess:function(t){},toJSON:function(){return{joy1StrobeState:this.joy1StrobeState,joy2StrobeState:this.joy2StrobeState,joypadLastWrite:this.joypadLastWrite}},fromJSON:function(t){this.joy1StrobeState=t.joy1StrobeState,this.joy2StrobeState=t.joy2StrobeState,this.joypadLastWrite=t.joypadLastWrite}},r[1]=function(t){this.nes=t},r[1].prototype=new r[0],r[1].prototype.reset=function(){r[0].prototype.reset.apply(this),this.regBuffer=0,this.regBufferCounter=0,this.mirroring=0,this.oneScreenMirroring=0,this.prgSwitchingArea=1,this.prgSwitchingSize=1,this.vromSwitchingSize=0,this.romSelectionReg0=0,this.romSelectionReg1=0,this.romBankSelect=0},r[1].prototype.write=function(t,e){t<32768?r[0].prototype.write.apply(this,arguments):0!=(128&e)?(this.regBufferCounter=0,this.regBuffer=0,0===this.getRegNumber(t)&&(this.prgSwitchingArea=1,this.prgSwitchingSize=1)):(this.regBuffer=this.regBuffer&255-(1<<this.regBufferCounter)|(1&e)<<this.regBufferCounter,this.regBufferCounter++,5===this.regBufferCounter&&(this.setReg(this.getRegNumber(t),this.regBuffer),this.regBuffer=0,this.regBufferCounter=0))},r[1].prototype.setReg=function(t,e){var i;switch(t){case 0:(i=3&e)!==this.mirroring&&(this.mirroring=i,0==(2&this.mirroring)?this.nes.ppu.setMirroring(this.nes.rom.SINGLESCREEN_MIRRORING):0!=(1&this.mirroring)?this.nes.ppu.setMirroring(this.nes.rom.HORIZONTAL_MIRRORING):this.nes.ppu.setMirroring(this.nes.rom.VERTICAL_MIRRORING)),this.prgSwitchingArea=e>>2&1,this.prgSwitchingSize=e>>3&1,this.vromSwitchingSize=e>>4&1;break;case 1:this.romSelectionReg0=e>>4&1,this.nes.rom.vromCount>0&&(0===this.vromSwitchingSize?0===this.romSelectionReg0?this.load8kVromBank(15&e,0):this.load8kVromBank(Math.floor(this.nes.rom.vromCount/2)+(15&e),0):0===this.romSelectionReg0?this.loadVromBank(15&e,0):this.loadVromBank(Math.floor(this.nes.rom.vromCount/2)+(15&e),0));break;case 2:this.romSelectionReg1=e>>4&1,this.nes.rom.vromCount>0&&1===this.vromSwitchingSize&&(0===this.romSelectionReg1?this.loadVromBank(15&e,4096):this.loadVromBank(Math.floor(this.nes.rom.vromCount/2)+(15&e),4096));break;default:var s;i=15&e;var r=0;this.nes.rom.romCount>=32?0===this.vromSwitchingSize?1===this.romSelectionReg0&&(r=16):r=(this.romSelectionReg0|this.romSelectionReg1<<1)<<3:this.nes.rom.romCount>=16&&1===this.romSelectionReg0&&(r=8),0===this.prgSwitchingSize?(s=r+(15&e),this.load32kRomBank(s,32768)):(s=2*r+(15&e),0===this.prgSwitchingArea?this.loadRomBank(s,49152):this.loadRomBank(s,32768))}},r[1].prototype.getRegNumber=function(t){return t>=32768&&t<=40959?0:t>=40960&&t<=49151?1:t>=49152&&t<=57343?2:3},r[1].prototype.loadROM=function(){if(!this.nes.rom.valid)throw new Error("MMC1: Invalid ROM! Unable to load.");this.loadRomBank(0,32768),this.loadRomBank(this.nes.rom.romCount-1,49152),this.loadCHRROM(),this.loadBatteryRam(),this.nes.cpu.requestIrq(this.nes.cpu.IRQ_RESET)},r[1].prototype.switchLowHighPrgRom=function(t){},r[1].prototype.switch16to32=function(){},r[1].prototype.switch32to16=function(){},r[1].prototype.toJSON=function(){var t=r[0].prototype.toJSON.apply(this);return t.mirroring=this.mirroring,t.oneScreenMirroring=this.oneScreenMirroring,t.prgSwitchingArea=this.prgSwitchingArea,t.prgSwitchingSize=this.prgSwitchingSize,t.vromSwitchingSize=this.vromSwitchingSize,t.romSelectionReg0=this.romSelectionReg0,t.romSelectionReg1=this.romSelectionReg1,t.romBankSelect=this.romBankSelect,t.regBuffer=this.regBuffer,t.regBufferCounter=this.regBufferCounter,t},r[1].prototype.fromJSON=function(t){r[0].prototype.fromJSON.apply(this,arguments),this.mirroring=t.mirroring,this.oneScreenMirroring=t.oneScreenMirroring,this.prgSwitchingArea=t.prgSwitchingArea,this.prgSwitchingSize=t.prgSwitchingSize,this.vromSwitchingSize=t.vromSwitchingSize,this.romSelectionReg0=t.romSelectionReg0,this.romSelectionReg1=t.romSelectionReg1,this.romBankSelect=t.romBankSelect,this.regBuffer=t.regBuffer,this.regBufferCounter=t.regBufferCounter},r[2]=function(t){this.nes=t},r[2].prototype=new r[0],r[2].prototype.write=function(t,e){t<32768?r[0].prototype.write.apply(this,arguments):this.loadRomBank(e,32768)},r[2].prototype.loadROM=function(){if(!this.nes.rom.valid)throw new Error("UNROM: Invalid ROM! Unable to load.");this.loadRomBank(0,32768),this.loadRomBank(this.nes.rom.romCount-1,49152),this.loadCHRROM(),this.nes.cpu.requestIrq(this.nes.cpu.IRQ_RESET)},r[3]=function(t){this.nes=t},r[3].prototype=new r[0],r[3].prototype.write=function(t,e){if(t<32768)r[0].prototype.write.apply(this,arguments);else{var i=e%(this.nes.rom.vromCount/2)*2;this.loadVromBank(i,0),this.loadVromBank(i+1,4096),this.load8kVromBank(2*e,0)}},r[4]=function(t){this.nes=t,this.CMD_SEL_2_1K_VROM_0000=0,this.CMD_SEL_2_1K_VROM_0800=1,this.CMD_SEL_1K_VROM_1000=2,this.CMD_SEL_1K_VROM_1400=3,this.CMD_SEL_1K_VROM_1800=4,this.CMD_SEL_1K_VROM_1C00=5,this.CMD_SEL_ROM_PAGE1=6,this.CMD_SEL_ROM_PAGE2=7,this.command=null,this.prgAddressSelect=null,this.chrAddressSelect=null,this.pageNumber=null,this.irqCounter=null,this.irqLatchValue=null,this.irqEnable=null,this.prgAddressChanged=!1},r[4].prototype=new r[0],r[4].prototype.write=function(t,e){if(t<32768)r[0].prototype.write.apply(this,arguments);else switch(t){case 32768:this.command=7&e;var i=e>>6&1;i!==this.prgAddressSelect&&(this.prgAddressChanged=!0),this.prgAddressSelect=i,this.chrAddressSelect=e>>7&1;break;case 32769:this.executeCommand(this.command,e);break;case 40960:0!=(1&e)?this.nes.ppu.setMirroring(this.nes.rom.HORIZONTAL_MIRRORING):this.nes.ppu.setMirroring(this.nes.rom.VERTICAL_MIRRORING);break;case 40961:break;case 49152:this.irqCounter=e;break;case 49153:this.irqLatchValue=e;break;case 57344:this.irqEnable=0;break;case 57345:this.irqEnable=1}},r[4].prototype.executeCommand=function(t,e){switch(t){case this.CMD_SEL_2_1K_VROM_0000:0===this.chrAddressSelect?(this.load1kVromBank(e,0),this.load1kVromBank(e+1,1024)):(this.load1kVromBank(e,4096),this.load1kVromBank(e+1,5120));break;case this.CMD_SEL_2_1K_VROM_0800:0===this.chrAddressSelect?(this.load1kVromBank(e,2048),this.load1kVromBank(e+1,3072)):(this.load1kVromBank(e,6144),this.load1kVromBank(e+1,7168));break;case this.CMD_SEL_1K_VROM_1000:0===this.chrAddressSelect?this.load1kVromBank(e,4096):this.load1kVromBank(e,0);break;case this.CMD_SEL_1K_VROM_1400:0===this.chrAddressSelect?this.load1kVromBank(e,5120):this.load1kVromBank(e,1024);break;case this.CMD_SEL_1K_VROM_1800:0===this.chrAddressSelect?this.load1kVromBank(e,6144):this.load1kVromBank(e,2048);break;case this.CMD_SEL_1K_VROM_1C00:0===this.chrAddressSelect?this.load1kVromBank(e,7168):this.load1kVromBank(e,3072);break;case this.CMD_SEL_ROM_PAGE1:this.prgAddressChanged&&(0===this.prgAddressSelect?this.load8kRomBank(2*(this.nes.rom.romCount-1),49152):this.load8kRomBank(2*(this.nes.rom.romCount-1),32768),this.prgAddressChanged=!1),0===this.prgAddressSelect?this.load8kRomBank(e,32768):this.load8kRomBank(e,49152);break;case this.CMD_SEL_ROM_PAGE2:this.load8kRomBank(e,40960),this.prgAddressChanged&&(0===this.prgAddressSelect?this.load8kRomBank(2*(this.nes.rom.romCount-1),49152):this.load8kRomBank(2*(this.nes.rom.romCount-1),32768),this.prgAddressChanged=!1)}},r[4].prototype.loadROM=function(){if(!this.nes.rom.valid)throw new Error("MMC3: Invalid ROM! Unable to load.");this.load8kRomBank(2*(this.nes.rom.romCount-1),49152),this.load8kRomBank(2*(this.nes.rom.romCount-1)+1,57344),this.load8kRomBank(0,32768),this.load8kRomBank(1,40960),this.loadCHRROM(),this.loadBatteryRam(),this.nes.cpu.requestIrq(this.nes.cpu.IRQ_RESET)},r[4].prototype.clockIrqCounter=function(){1===this.irqEnable&&(this.irqCounter--,this.irqCounter<0&&(this.nes.cpu.requestIrq(this.nes.cpu.IRQ_NORMAL),this.irqCounter=this.irqLatchValue))},r[4].prototype.toJSON=function(){var t=r[0].prototype.toJSON.apply(this);return t.command=this.command,t.prgAddressSelect=this.prgAddressSelect,t.chrAddressSelect=this.chrAddressSelect,t.pageNumber=this.pageNumber,t.irqCounter=this.irqCounter,t.irqLatchValue=this.irqLatchValue,t.irqEnable=this.irqEnable,t.prgAddressChanged=this.prgAddressChanged,t},r[4].prototype.fromJSON=function(t){r[0].prototype.fromJSON.apply(this,arguments),this.command=t.command,this.prgAddressSelect=t.prgAddressSelect,this.chrAddressSelect=t.chrAddressSelect,this.pageNumber=t.pageNumber,this.irqCounter=t.irqCounter,this.irqLatchValue=t.irqLatchValue,this.irqEnable=t.irqEnable,this.prgAddressChanged=t.prgAddressChanged},r[5]=function(t){this.nes=t},r[5].prototype=new r[0],r[5].prototype.write=function(t,e){t<32768?r[0].prototype.write.apply(this,arguments):this.load8kVromBank(e,0)},r[5].prototype.write=function(t,e){if(t<20480)r[0].prototype.write.apply(this,arguments);else switch(t){case 20736:this.prg_size=3&e;break;case 20737:this.chr_size=3&e;break;case 20738:this.sram_we_a=3&e;break;case 20739:this.sram_we_b=3&e;break;case 20740:this.graphic_mode=3&e;break;case 20741:this.nametable_mode=e,this.nametable_type[0]=3&e,this.load1kVromBank(3&e,8192),e>>=2,this.nametable_type[1]=3&e,this.load1kVromBank(3&e,9216),e>>=2,this.nametable_type[2]=3&e,this.load1kVromBank(3&e,10240),e>>=2,this.nametable_type[3]=3&e,this.load1kVromBank(3&e,11264);break;case 20742:this.fill_chr=e;break;case 20743:this.fill_pal=3&e;break;case 20755:this.SetBank_SRAM(3,3&e);break;case 20756:case 20757:case 20758:case 20759:this.SetBank_CPU(t,e);break;case 20768:case 20769:case 20770:case 20771:case 20772:case 20773:case 20774:case 20775:this.chr_mode=0,this.chr_page[0][7&t]=e,this.SetBank_PPU();break;case 20776:case 20777:case 20778:case 20779:this.chr_mode=1,this.chr_page[1][0+(3&t)]=e,this.chr_page[1][4+(3&t)]=e,this.SetBank_PPU();break;case 20992:this.split_control=e;break;case 20993:this.split_scroll=e;break;case 20994:this.split_page=63&e;break;case 20995:this.irq_line=e,this.nes.cpu.ClearIRQ();break;case 20996:this.irq_enable=e,this.nes.cpu.ClearIRQ();break;case 20997:this.mult_a=e;break;case 20998:this.mult_b=e;break;default:t>=20480&&t<=20501?this.nes.papu.exWrite(t,e):t>=23552&&t<=24575?2===this.graphic_mode||3!==this.graphic_mode&&this.irq_status:t>=24576&&t<=32767&&2===this.sram_we_a&&this.sram_we_b}},r[5].prototype.loadROM=function(){if(!this.nes.rom.valid)throw new Error("UNROM: Invalid ROM! Unable to load.");this.load8kRomBank(2*this.nes.rom.romCount-1,32768),this.load8kRomBank(2*this.nes.rom.romCount-1,40960),this.load8kRomBank(2*this.nes.rom.romCount-1,49152),this.load8kRomBank(2*this.nes.rom.romCount-1,57344),this.loadCHRROM(),this.nes.cpu.requestIrq(this.nes.cpu.IRQ_RESET)},r[7]=function(t){this.nes=t},r[7].prototype=new r[0],r[7].prototype.write=function(t,e){t<32768?r[0].prototype.write.apply(this,arguments):(this.load32kRomBank(7&e,32768),16&e?this.nes.ppu.setMirroring(this.nes.rom.SINGLESCREEN_MIRRORING2):this.nes.ppu.setMirroring(this.nes.rom.SINGLESCREEN_MIRRORING))},r[7].prototype.loadROM=function(){if(!this.nes.rom.valid)throw new Error("AOROM: Invalid ROM! Unable to load.");this.loadPRGROM(),this.loadCHRROM(),this.nes.cpu.requestIrq(this.nes.cpu.IRQ_RESET)},r[11]=function(t){this.nes=t},r[11].prototype=new r[0],r[11].prototype.write=function(t,e){if(t<32768)r[0].prototype.write.apply(this,arguments);else{var i=2*(15&e)%this.nes.rom.romCount,s=(2*(15&e)+1)%this.nes.rom.romCount;if(this.loadRomBank(i,32768),this.loadRomBank(s,49152),this.nes.rom.vromCount>0){var n=2*(e>>4)%this.nes.rom.vromCount;this.loadVromBank(n,0),this.loadVromBank(n+1,4096)}}},r[34]=function(t){this.nes=t},r[34].prototype=new r[0],r[34].prototype.write=function(t,e){t<32768?r[0].prototype.write.apply(this,arguments):this.load32kRomBank(e,32768)},r[38]=function(t){this.nes=t},r[38].prototype=new r[0],r[38].prototype.write=function(t,e){t<28672||t>32767?r[0].prototype.write.apply(this,arguments):(this.load32kRomBank(3&e,32768),this.load8kVromBank(2*(e>>2&3),0))},r[66]=function(t){this.nes=t},r[66].prototype=new r[0],r[66].prototype.write=function(t,e){t<32768?r[0].prototype.write.apply(this,arguments):(this.load32kRomBank(e>>4&3,32768),this.load8kVromBank(2*(3&e),0))},r[94]=function(t){this.nes=t},r[94].prototype=new r[0],r[94].prototype.write=function(t,e){t<32768?r[0].prototype.write.apply(this,arguments):this.loadRomBank(e>>2,32768)},r[94].prototype.loadROM=function(){if(!this.nes.rom.valid)throw new Error("UN1ROM: Invalid ROM! Unable to load.");this.loadRomBank(0,32768),this.loadRomBank(this.nes.rom.romCount-1,49152),this.loadCHRROM(),this.nes.cpu.requestIrq(this.nes.cpu.IRQ_RESET)},r[140]=function(t){this.nes=t},r[140].prototype=new r[0],r[140].prototype.write=function(t,e){t<24576||t>32767?r[0].prototype.write.apply(this,arguments):(this.load32kRomBank(e>>4&3,32768),this.load8kVromBank(2*(15&e),0))},r[180]=function(t){this.nes=t},r[180].prototype=new r[0],r[180].prototype.write=function(t,e){t<32768?r[0].prototype.write.apply(this,arguments):this.loadRomBank(e,49152)},r[180].prototype.loadROM=function(){if(!this.nes.rom.valid)throw new Error("Mapper 180: Invalid ROM! Unable to load.");this.loadRomBank(0,32768),this.loadRomBank(this.nes.rom.romCount-1,49152),this.loadCHRROM(),this.nes.cpu.requestIrq(this.nes.cpu.IRQ_RESET)},t.exports=r},744:(t,e,i)=>{var s=i(990),r=i(188),n=i(321),h=i(306),o=i(471),a=function(t){var e;if(this.opts={onFrame:function(){},onAudioSample:null,onStatusUpdate:function(){},onBatteryRamWrite:function(){},preferredFrameRate:60,emulateSound:!0,sampleRate:48e3},void 0!==t)for(e in this.opts)void 0!==t[e]&&(this.opts[e]=t[e]);this.frameTime=1e3/this.opts.preferredFrameRate,this.ui={writeFrame:this.opts.onFrame,updateStatus:this.opts.onStatusUpdate},this.cpu=new s(this),this.ppu=new n(this),this.papu=new h(this),this.mmap=null,this.controllers={1:new r,2:new r},this.ui.updateStatus("Ready to load a ROM."),this.frame=this.frame.bind(this),this.buttonDown=this.buttonDown.bind(this),this.buttonUp=this.buttonUp.bind(this),this.zapperMove=this.zapperMove.bind(this),this.zapperFireDown=this.zapperFireDown.bind(this),this.zapperFireUp=this.zapperFireUp.bind(this)};a.prototype={fpsFrameCount:0,romData:null,reset:function(){null!==this.mmap&&this.mmap.reset(),this.cpu.reset(),this.ppu.reset(),this.papu.reset(),this.lastFpsTime=null,this.fpsFrameCount=0},frame:function(){this.ppu.startFrame();var t=0,e=this.opts.emulateSound,i=this.cpu,s=this.ppu,r=this.papu;t:for(;;)for(0===i.cyclesToHalt?(t=i.emulate(),e&&r.clockFrameCounter(t),t*=3):i.cyclesToHalt>8?(t=24,e&&r.clockFrameCounter(8),i.cyclesToHalt-=8):(t=3*i.cyclesToHalt,e&&r.clockFrameCounter(i.cyclesToHalt),i.cyclesToHalt=0);t>0;t--){if(s.curX===s.spr0HitX&&1===s.f_spVisibility&&s.scanline-21===s.spr0HitY&&s.setStatusFlag(s.STATUS_SPRITE0HIT,!0),s.requestEndFrame&&(s.nmiCounter--,0===s.nmiCounter)){s.requestEndFrame=!1,s.startVBlank();break t}s.curX++,341===s.curX&&(s.curX=0,s.endScanline())}this.fpsFrameCount++},buttonDown:function(t,e){this.controllers[t].buttonDown(e)},buttonUp:function(t,e){this.controllers[t].buttonUp(e)},zapperMove:function(t,e){this.mmap&&(this.mmap.zapperX=t,this.mmap.zapperY=e)},zapperFireDown:function(){this.mmap&&(this.mmap.zapperFired=!0)},zapperFireUp:function(){this.mmap&&(this.mmap.zapperFired=!1)},getFPS:function(){var t=+new Date,e=null;return this.lastFpsTime&&(e=this.fpsFrameCount/((t-this.lastFpsTime)/1e3)),this.fpsFrameCount=0,this.lastFpsTime=t,e},reloadROM:function(){null!==this.romData&&this.loadROM(this.romData)},loadROM:function(t){this.rom=new o(this),this.rom.load(t),this.reset(),this.mmap=this.rom.createMapper(),this.mmap.loadROM(),this.ppu.setMirroring(this.rom.getMirroringType()),this.romData=t},setFramerate:function(t){this.opts.preferredFrameRate=t,this.frameTime=1e3/t,this.papu.setSampleRate(this.opts.sampleRate,!1)},toJSON:function(){return{romData:this.romData,cpu:this.cpu.toJSON(),mmap:this.mmap.toJSON(),ppu:this.ppu.toJSON()}},fromJSON:function(t){this.reset(),this.romData=t.romData,this.cpu.fromJSON(t.cpu),this.mmap.fromJSON(t.mmap),this.ppu.fromJSON(t.ppu)}},t.exports=a},306:t=>{var e=function(t){this.nes=t,this.square1=new r(this,!0),this.square2=new r(this,!1),this.triangle=new n(this),this.noise=new s(this),this.dmc=new i(this),this.frameIrqCounter=null,this.frameIrqCounterMax=4,this.initCounter=2048,this.channelEnableValue=null,this.sampleRate=44100,this.lengthLookup=null,this.dmcFreqLookup=null,this.noiseWavelengthLookup=null,this.square_table=null,this.tnd_table=null,this.frameIrqEnabled=!1,this.frameIrqActive=null,this.frameClockNow=null,this.startedPlaying=!1,this.recordOutput=!1,this.initingHardware=!1,this.masterFrameCounter=null,this.derivedFrameCounter=null,this.countSequence=null,this.sampleTimer=null,this.frameTime=null,this.sampleTimerMax=null,this.sampleCount=null,this.triValue=0,this.smpSquare1=null,this.smpSquare2=null,this.smpTriangle=null,this.smpDmc=null,this.accCount=null,this.prevSampleL=0,this.prevSampleR=0,this.smpAccumL=0,this.smpAccumR=0,this.dacRange=0,this.dcValue=0,this.masterVolume=256,this.stereoPosLSquare1=null,this.stereoPosLSquare2=null,this.stereoPosLTriangle=null,this.stereoPosLNoise=null,this.stereoPosLDMC=null,this.stereoPosRSquare1=null,this.stereoPosRSquare2=null,this.stereoPosRTriangle=null,this.stereoPosRNoise=null,this.stereoPosRDMC=null,this.extraCycles=null,this.maxSample=null,this.minSample=null,this.panning=[80,170,100,150,128],this.setPanning(this.panning),this.initLengthLookup(),this.initDmcFrequencyLookup(),this.initNoiseWavelengthLookup(),this.initDACtables();for(var e=0;e<20;e++)16===e?this.writeReg(16400,16):this.writeReg(16384+e,0);this.reset()};e.prototype={reset:function(){this.sampleRate=this.nes.opts.sampleRate,this.sampleTimerMax=Math.floor(1832727040*this.nes.opts.preferredFrameRate/(60*this.sampleRate)),this.frameTime=Math.floor(14915*this.nes.opts.preferredFrameRate/60),this.sampleTimer=0,this.updateChannelEnable(0),this.masterFrameCounter=0,this.derivedFrameCounter=0,this.countSequence=0,this.sampleCount=0,this.initCounter=2048,this.frameIrqEnabled=!1,this.initingHardware=!1,this.resetCounter(),this.square1.reset(),this.square2.reset(),this.triangle.reset(),this.noise.reset(),this.dmc.reset(),this.accCount=0,this.smpSquare1=0,this.smpSquare2=0,this.smpTriangle=0,this.smpDmc=0,this.frameIrqEnabled=!1,this.frameIrqCounterMax=4,this.channelEnableValue=255,this.startedPlaying=!1,this.prevSampleL=0,this.prevSampleR=0,this.smpAccumL=0,this.smpAccumR=0,this.maxSample=-5e5,this.minSample=5e5},readReg:function(t){var e=0;return e|=this.square1.getLengthStatus(),e|=this.square2.getLengthStatus()<<1,e|=this.triangle.getLengthStatus()<<2,e|=this.noise.getLengthStatus()<<3,e|=this.dmc.getLengthStatus()<<4,e|=(this.frameIrqActive&&this.frameIrqEnabled?1:0)<<6,e|=this.dmc.getIrqStatus()<<7,this.frameIrqActive=!1,this.dmc.irqGenerated=!1,65535&e},writeReg:function(t,e){t>=16384&&t<16388?this.square1.writeReg(t,e):t>=16388&&t<16392?this.square2.writeReg(t,e):t>=16392&&t<16396?this.triangle.writeReg(t,e):t>=16396&&t<=16399?this.noise.writeReg(t,e):16400===t||16401===t||16402===t||16403===t?this.dmc.writeReg(t,e):16405===t?(this.updateChannelEnable(e),0!==e&&this.initCounter>0&&(this.initingHardware=!0),this.dmc.writeReg(t,e)):16407===t&&(this.countSequence=e>>7&1,this.masterFrameCounter=0,this.frameIrqActive=!1,this.frameIrqEnabled=0==(e>>6&1),0===this.countSequence?(this.frameIrqCounterMax=4,this.derivedFrameCounter=4):(this.frameIrqCounterMax=5,this.derivedFrameCounter=0,this.frameCounterTick()))},resetCounter:function(){0===this.countSequence?this.derivedFrameCounter=4:this.derivedFrameCounter=0},updateChannelEnable:function(t){this.channelEnableValue=65535&t,this.square1.setEnabled(0!=(1&t)),this.square2.setEnabled(0!=(2&t)),this.triangle.setEnabled(0!=(4&t)),this.noise.setEnabled(0!=(8&t)),this.dmc.setEnabled(0!=(16&t))},clockFrameCounter:function(t){if(this.initCounter>0&&this.initingHardware)return this.initCounter-=t,void(this.initCounter<=0&&(this.initingHardware=!1));t+=this.extraCycles;var e=this.sampleTimerMax-this.sampleTimer;t<<10>e?(this.extraCycles=(t<<10)-e>>10,t-=this.extraCycles):this.extraCycles=0;var i=this.dmc,s=this.triangle,r=this.square1,n=this.square2,h=this.noise;if(i.isEnabled)for(i.shiftCounter-=t<<3;i.shiftCounter<=0&&i.dmaFrequency>0;)i.shiftCounter+=i.dmaFrequency,i.clockDmc();if(s.progTimerMax>0)for(s.progTimerCount-=t;s.progTimerCount<=0;)s.progTimerCount+=s.progTimerMax+1,s.linearCounter>0&&s.lengthCounter>0&&(s.triangleCounter++,s.triangleCounter&=31,s.isEnabled&&(s.triangleCounter>=16?s.sampleValue=15&s.triangleCounter:s.sampleValue=15-(15&s.triangleCounter),s.sampleValue<<=4));r.progTimerCount-=t,r.progTimerCount<=0&&(r.progTimerCount+=r.progTimerMax+1<<1,r.squareCounter++,r.squareCounter&=7,r.updateSampleValue()),n.progTimerCount-=t,n.progTimerCount<=0&&(n.progTimerCount+=n.progTimerMax+1<<1,n.squareCounter++,n.squareCounter&=7,n.updateSampleValue());var o=t;if(h.progTimerCount-o>0)h.progTimerCount-=o,h.accCount+=o,h.accValue+=o*h.sampleValue;else for(;o-- >0;)--h.progTimerCount<=0&&h.progTimerMax>0&&(h.shiftReg<<=1,h.tmp=32768&(h.shiftReg<<(0===h.randomMode?1:6)^h.shiftReg),0!==h.tmp?(h.shiftReg|=1,h.randomBit=0,h.sampleValue=0):(h.randomBit=1,h.isEnabled&&h.lengthCounter>0?h.sampleValue=h.masterVolume:h.sampleValue=0),h.progTimerCount+=h.progTimerMax),h.accValue+=h.sampleValue,h.accCount++;this.frameIrqEnabled&&this.frameIrqActive&&this.nes.cpu.requestIrq(this.nes.cpu.IRQ_NORMAL),this.masterFrameCounter+=t<<1,this.masterFrameCounter>=this.frameTime&&(this.masterFrameCounter-=this.frameTime,this.frameCounterTick()),this.accSample(t),this.sampleTimer+=t<<10,this.sampleTimer>=this.sampleTimerMax&&(this.sample(),this.sampleTimer-=this.sampleTimerMax)},accSample:function(t){this.triangle.sampleCondition&&(this.triValue=Math.floor((this.triangle.progTimerCount<<4)/(this.triangle.progTimerMax+1)),this.triValue>16&&(this.triValue=16),this.triangle.triangleCounter>=16&&(this.triValue=16-this.triValue),this.triValue+=this.triangle.sampleValue),2===t?(this.smpTriangle+=this.triValue<<1,this.smpDmc+=this.dmc.sample<<1,this.smpSquare1+=this.square1.sampleValue<<1,this.smpSquare2+=this.square2.sampleValue<<1,this.accCount+=2):4===t?(this.smpTriangle+=this.triValue<<2,this.smpDmc+=this.dmc.sample<<2,this.smpSquare1+=this.square1.sampleValue<<2,this.smpSquare2+=this.square2.sampleValue<<2,this.accCount+=4):(this.smpTriangle+=t*this.triValue,this.smpDmc+=t*this.dmc.sample,this.smpSquare1+=t*this.square1.sampleValue,this.smpSquare2+=t*this.square2.sampleValue,this.accCount+=t)},frameCounterTick:function(){this.derivedFrameCounter++,this.derivedFrameCounter>=this.frameIrqCounterMax&&(this.derivedFrameCounter=0),1!==this.derivedFrameCounter&&3!==this.derivedFrameCounter||(this.triangle.clockLengthCounter(),this.square1.clockLengthCounter(),this.square2.clockLengthCounter(),this.noise.clockLengthCounter(),this.square1.clockSweep(),this.square2.clockSweep()),this.derivedFrameCounter>=0&&this.derivedFrameCounter<4&&(this.square1.clockEnvDecay(),this.square2.clockEnvDecay(),this.noise.clockEnvDecay(),this.triangle.clockLinearCounter()),3===this.derivedFrameCounter&&0===this.countSequence&&(this.frameIrqActive=!0)},sample:function(){var t,e;this.accCount>0?(this.smpSquare1<<=4,this.smpSquare1=Math.floor(this.smpSquare1/this.accCount),this.smpSquare2<<=4,this.smpSquare2=Math.floor(this.smpSquare2/this.accCount),this.smpTriangle=Math.floor(this.smpTriangle/this.accCount),this.smpDmc<<=4,this.smpDmc=Math.floor(this.smpDmc/this.accCount),this.accCount=0):(this.smpSquare1=this.square1.sampleValue<<4,this.smpSquare2=this.square2.sampleValue<<4,this.smpTriangle=this.triangle.sampleValue,this.smpDmc=this.dmc.sample<<4);var i=Math.floor((this.noise.accValue<<4)/this.noise.accCount);this.noise.accValue=i>>4,this.noise.accCount=1,t=this.smpSquare1*this.stereoPosLSquare1+this.smpSquare2*this.stereoPosLSquare2>>8,e=3*this.smpTriangle*this.stereoPosLTriangle+(i<<1)*this.stereoPosLNoise+this.smpDmc*this.stereoPosLDMC>>8,t>=this.square_table.length&&(t=this.square_table.length-1),e>=this.tnd_table.length&&(e=this.tnd_table.length-1);var s=this.square_table[t]+this.tnd_table[e]-this.dcValue;t=this.smpSquare1*this.stereoPosRSquare1+this.smpSquare2*this.stereoPosRSquare2>>8,e=3*this.smpTriangle*this.stereoPosRTriangle+(i<<1)*this.stereoPosRNoise+this.smpDmc*this.stereoPosRDMC>>8,t>=this.square_table.length&&(t=this.square_table.length-1),e>=this.tnd_table.length&&(e=this.tnd_table.length-1);var r=this.square_table[t]+this.tnd_table[e]-this.dcValue,n=s-this.prevSampleL;this.prevSampleL+=n,this.smpAccumL+=n-(this.smpAccumL>>10),s=this.smpAccumL;var h=r-this.prevSampleR;this.prevSampleR+=h,this.smpAccumR+=h-(this.smpAccumR>>10),r=this.smpAccumR,s>this.maxSample&&(this.maxSample=s),s<this.minSample&&(this.minSample=s),this.nes.opts.onAudioSample&&this.nes.opts.onAudioSample(s/32768,r/32768),this.smpSquare1=0,this.smpSquare2=0,this.smpTriangle=0,this.smpDmc=0},getLengthMax:function(t){return this.lengthLookup[t>>3]},getDmcFrequency:function(t){return t>=0&&t<16?this.dmcFreqLookup[t]:0},getNoiseWaveLength:function(t){return t>=0&&t<16?this.noiseWavelengthLookup[t]:0},setPanning:function(t){for(var e=0;e<5;e++)this.panning[e]=t[e];this.updateStereoPos()},setMasterVolume:function(t){t<0&&(t=0),t>256&&(t=256),this.masterVolume=t,this.updateStereoPos()},updateStereoPos:function(){this.stereoPosLSquare1=this.panning[0]*this.masterVolume>>8,this.stereoPosLSquare2=this.panning[1]*this.masterVolume>>8,this.stereoPosLTriangle=this.panning[2]*this.masterVolume>>8,this.stereoPosLNoise=this.panning[3]*this.masterVolume>>8,this.stereoPosLDMC=this.panning[4]*this.masterVolume>>8,this.stereoPosRSquare1=this.masterVolume-this.stereoPosLSquare1,this.stereoPosRSquare2=this.masterVolume-this.stereoPosLSquare2,this.stereoPosRTriangle=this.masterVolume-this.stereoPosLTriangle,this.stereoPosRNoise=this.masterVolume-this.stereoPosLNoise,this.stereoPosRDMC=this.masterVolume-this.stereoPosLDMC},initLengthLookup:function(){this.lengthLookup=[10,254,20,2,40,4,80,6,160,8,60,10,14,12,26,14,12,16,24,18,48,20,96,22,192,24,72,26,16,28,32,30]},initDmcFrequencyLookup:function(){this.dmcFreqLookup=new Array(16),this.dmcFreqLookup[0]=3424,this.dmcFreqLookup[1]=3040,this.dmcFreqLookup[2]=2720,this.dmcFreqLookup[3]=2560,this.dmcFreqLookup[4]=2288,this.dmcFreqLookup[5]=2032,this.dmcFreqLookup[6]=1808,this.dmcFreqLookup[7]=1712,this.dmcFreqLookup[8]=1520,this.dmcFreqLookup[9]=1280,this.dmcFreqLookup[10]=1136,this.dmcFreqLookup[11]=1024,this.dmcFreqLookup[12]=848,this.dmcFreqLookup[13]=672,this.dmcFreqLookup[14]=576,this.dmcFreqLookup[15]=432},initNoiseWavelengthLookup:function(){this.noiseWavelengthLookup=new Array(16),this.noiseWavelengthLookup[0]=4,this.noiseWavelengthLookup[1]=8,this.noiseWavelengthLookup[2]=16,this.noiseWavelengthLookup[3]=32,this.noiseWavelengthLookup[4]=64,this.noiseWavelengthLookup[5]=96,this.noiseWavelengthLookup[6]=128,this.noiseWavelengthLookup[7]=160,this.noiseWavelengthLookup[8]=202,this.noiseWavelengthLookup[9]=254,this.noiseWavelengthLookup[10]=380,this.noiseWavelengthLookup[11]=508,this.noiseWavelengthLookup[12]=762,this.noiseWavelengthLookup[13]=1016,this.noiseWavelengthLookup[14]=2034,this.noiseWavelengthLookup[15]=4068},initDACtables:function(){var t,e,i,s=0,r=0;for(this.square_table=new Array(512),this.tnd_table=new Array(3264),i=0;i<512;i++)t=95.52/(8128/(i/16)+100),t*=.98411,t*=5e4,e=Math.floor(t),this.square_table[i]=e,e>s&&(s=e);for(i=0;i<3264;i++)t=163.67/(24329/(i/16)+100),t*=.98411,t*=5e4,e=Math.floor(t),this.tnd_table[i]=e,e>r&&(r=e);this.dacRange=s+r,this.dcValue=this.dacRange/2}};var i=function(t){this.papu=t,this.MODE_NORMAL=0,this.MODE_LOOP=1,this.MODE_IRQ=2,this.isEnabled=null,this.hasSample=null,this.irqGenerated=!1,this.playMode=null,this.dmaFrequency=null,this.dmaCounter=null,this.deltaCounter=null,this.playStartAddress=null,this.playAddress=null,this.playLength=null,this.playLengthCounter=null,this.shiftCounter=null,this.reg4012=null,this.reg4013=null,this.sample=null,this.dacLsb=null,this.data=null,this.reset()};i.prototype={clockDmc:function(){this.hasSample&&(0==(1&this.data)?this.deltaCounter>0&&this.deltaCounter--:this.deltaCounter<63&&this.deltaCounter++,this.sample=this.isEnabled?(this.deltaCounter<<1)+this.dacLsb:0,this.data>>=1),this.dmaCounter--,this.dmaCounter<=0&&(this.hasSample=!1,this.endOfSample(),this.dmaCounter=8),this.irqGenerated&&this.papu.nes.cpu.requestIrq(this.papu.nes.cpu.IRQ_NORMAL)},endOfSample:function(){0===this.playLengthCounter&&this.playMode===this.MODE_LOOP&&(this.playAddress=this.playStartAddress,this.playLengthCounter=this.playLength),this.playLengthCounter>0&&(this.nextSample(),0===this.playLengthCounter&&this.playMode===this.MODE_IRQ&&(this.irqGenerated=!0))},nextSample:function(){this.data=this.papu.nes.mmap.load(this.playAddress),this.papu.nes.cpu.haltCycles(4),this.playLengthCounter--,this.playAddress++,this.playAddress>65535&&(this.playAddress=32768),this.hasSample=!0},writeReg:function(t,e){16400===t?(e>>6==0?this.playMode=this.MODE_NORMAL:1==(e>>6&1)?this.playMode=this.MODE_LOOP:e>>6==2&&(this.playMode=this.MODE_IRQ),0==(128&e)&&(this.irqGenerated=!1),this.dmaFrequency=this.papu.getDmcFrequency(15&e)):16401===t?(this.deltaCounter=e>>1&63,this.dacLsb=1&e,this.sample=(this.deltaCounter<<1)+this.dacLsb):16402===t?(this.playStartAddress=e<<6|49152,this.playAddress=this.playStartAddress,this.reg4012=e):16403===t?(this.playLength=1+(e<<4),this.playLengthCounter=this.playLength,this.reg4013=e):16405===t&&(0==(e>>4&1)?this.playLengthCounter=0:(this.playAddress=this.playStartAddress,this.playLengthCounter=this.playLength),this.irqGenerated=!1)},setEnabled:function(t){!this.isEnabled&&t&&(this.playLengthCounter=this.playLength),this.isEnabled=t},getLengthStatus:function(){return 0!==this.playLengthCounter&&this.isEnabled?1:0},getIrqStatus:function(){return this.irqGenerated?1:0},reset:function(){this.isEnabled=!1,this.irqGenerated=!1,this.playMode=this.MODE_NORMAL,this.dmaFrequency=0,this.dmaCounter=0,this.deltaCounter=0,this.playStartAddress=0,this.playAddress=0,this.playLength=0,this.playLengthCounter=0,this.sample=0,this.dacLsb=0,this.shiftCounter=0,this.reg4012=0,this.reg4013=0,this.data=0}};var s=function(t){this.papu=t,this.isEnabled=null,this.envDecayDisable=null,this.envDecayLoopEnable=null,this.lengthCounterEnable=null,this.envReset=null,this.shiftNow=null,this.lengthCounter=null,this.progTimerCount=null,this.progTimerMax=null,this.envDecayRate=null,this.envDecayCounter=null,this.envVolume=null,this.masterVolume=null,this.shiftReg=16384,this.randomBit=null,this.randomMode=null,this.sampleValue=null,this.accValue=0,this.accCount=1,this.tmp=null,this.reset()};s.prototype={reset:function(){this.progTimerCount=0,this.progTimerMax=0,this.isEnabled=!1,this.lengthCounter=0,this.lengthCounterEnable=!1,this.envDecayDisable=!1,this.envDecayLoopEnable=!1,this.shiftNow=!1,this.envDecayRate=0,this.envDecayCounter=0,this.envVolume=0,this.masterVolume=0,this.shiftReg=1,this.randomBit=0,this.randomMode=0,this.sampleValue=0,this.tmp=0},clockLengthCounter:function(){this.lengthCounterEnable&&this.lengthCounter>0&&(this.lengthCounter--,0===this.lengthCounter&&this.updateSampleValue())},clockEnvDecay:function(){this.envReset?(this.envReset=!1,this.envDecayCounter=this.envDecayRate+1,this.envVolume=15):--this.envDecayCounter<=0&&(this.envDecayCounter=this.envDecayRate+1,this.envVolume>0?this.envVolume--:this.envVolume=this.envDecayLoopEnable?15:0),this.envDecayDisable?this.masterVolume=this.envDecayRate:this.masterVolume=this.envVolume,this.updateSampleValue()},updateSampleValue:function(){this.isEnabled&&this.lengthCounter>0&&(this.sampleValue=this.randomBit*this.masterVolume)},writeReg:function(t,e){16396===t?(this.envDecayDisable=0!=(16&e),this.envDecayRate=15&e,this.envDecayLoopEnable=0!=(32&e),this.lengthCounterEnable=0==(32&e),this.envDecayDisable?this.masterVolume=this.envDecayRate:this.masterVolume=this.envVolume):16398===t?(this.progTimerMax=this.papu.getNoiseWaveLength(15&e),this.randomMode=e>>7):16399===t&&(this.lengthCounter=this.papu.getLengthMax(248&e),this.envReset=!0)},setEnabled:function(t){this.isEnabled=t,t||(this.lengthCounter=0),this.updateSampleValue()},getLengthStatus:function(){return 0!==this.lengthCounter&&this.isEnabled?1:0}};var r=function(t,e){this.papu=t,this.dutyLookup=[0,1,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,1,1,1,1,0,0,0,1,0,0,1,1,1,1,1],this.impLookup=[1,-1,0,0,0,0,0,0,1,0,-1,0,0,0,0,0,1,0,0,0,-1,0,0,0,-1,0,1,0,0,0,0,0],this.sqr1=e,this.isEnabled=null,this.lengthCounterEnable=null,this.sweepActive=null,this.envDecayDisable=null,this.envDecayLoopEnable=null,this.envReset=null,this.sweepCarry=null,this.updateSweepPeriod=null,this.progTimerCount=null,this.progTimerMax=null,this.lengthCounter=null,this.squareCounter=null,this.sweepCounter=null,this.sweepCounterMax=null,this.sweepMode=null,this.sweepShiftAmount=null,this.envDecayRate=null,this.envDecayCounter=null,this.envVolume=null,this.masterVolume=null,this.dutyMode=null,this.sweepResult=null,this.sampleValue=null,this.vol=null,this.reset()};r.prototype={reset:function(){this.progTimerCount=0,this.progTimerMax=0,this.lengthCounter=0,this.squareCounter=0,this.sweepCounter=0,this.sweepCounterMax=0,this.sweepMode=0,this.sweepShiftAmount=0,this.envDecayRate=0,this.envDecayCounter=0,this.envVolume=0,this.masterVolume=0,this.dutyMode=0,this.vol=0,this.isEnabled=!1,this.lengthCounterEnable=!1,this.sweepActive=!1,this.sweepCarry=!1,this.envDecayDisable=!1,this.envDecayLoopEnable=!1},clockLengthCounter:function(){this.lengthCounterEnable&&this.lengthCounter>0&&(this.lengthCounter--,0===this.lengthCounter&&this.updateSampleValue())},clockEnvDecay:function(){this.envReset?(this.envReset=!1,this.envDecayCounter=this.envDecayRate+1,this.envVolume=15):--this.envDecayCounter<=0&&(this.envDecayCounter=this.envDecayRate+1,this.envVolume>0?this.envVolume--:this.envVolume=this.envDecayLoopEnable?15:0),this.envDecayDisable?this.masterVolume=this.envDecayRate:this.masterVolume=this.envVolume,this.updateSampleValue()},clockSweep:function(){--this.sweepCounter<=0&&(this.sweepCounter=this.sweepCounterMax+1,this.sweepActive&&this.sweepShiftAmount>0&&this.progTimerMax>7&&(this.sweepCarry=!1,0===this.sweepMode?(this.progTimerMax+=this.progTimerMax>>this.sweepShiftAmount,this.progTimerMax>4095&&(this.progTimerMax=4095,this.sweepCarry=!0)):this.progTimerMax=this.progTimerMax-((this.progTimerMax>>this.sweepShiftAmount)-(this.sqr1?1:0)))),this.updateSweepPeriod&&(this.updateSweepPeriod=!1,this.sweepCounter=this.sweepCounterMax+1)},updateSampleValue:function(){this.isEnabled&&this.lengthCounter>0&&this.progTimerMax>7?0===this.sweepMode&&this.progTimerMax+(this.progTimerMax>>this.sweepShiftAmount)>4095?this.sampleValue=0:this.sampleValue=this.masterVolume*this.dutyLookup[(this.dutyMode<<3)+this.squareCounter]:this.sampleValue=0},writeReg:function(t,e){var i=this.sqr1?0:4;t===16384+i?(this.envDecayDisable=0!=(16&e),this.envDecayRate=15&e,this.envDecayLoopEnable=0!=(32&e),this.dutyMode=e>>6&3,this.lengthCounterEnable=0==(32&e),this.envDecayDisable?this.masterVolume=this.envDecayRate:this.masterVolume=this.envVolume,this.updateSampleValue()):t===16385+i?(this.sweepActive=0!=(128&e),this.sweepCounterMax=e>>4&7,this.sweepMode=e>>3&1,this.sweepShiftAmount=7&e,this.updateSweepPeriod=!0):t===16386+i?(this.progTimerMax&=1792,this.progTimerMax|=e):t===16387+i&&(this.progTimerMax&=255,this.progTimerMax|=(7&e)<<8,this.isEnabled&&(this.lengthCounter=this.papu.getLengthMax(248&e)),this.envReset=!0)},setEnabled:function(t){this.isEnabled=t,t||(this.lengthCounter=0),this.updateSampleValue()},getLengthStatus:function(){return 0!==this.lengthCounter&&this.isEnabled?1:0}};var n=function(t){this.papu=t,this.isEnabled=null,this.sampleCondition=null,this.lengthCounterEnable=null,this.lcHalt=null,this.lcControl=null,this.progTimerCount=null,this.progTimerMax=null,this.triangleCounter=null,this.lengthCounter=null,this.linearCounter=null,this.lcLoadValue=null,this.sampleValue=null,this.tmp=null,this.reset()};n.prototype={reset:function(){this.progTimerCount=0,this.progTimerMax=0,this.triangleCounter=0,this.isEnabled=!1,this.sampleCondition=!1,this.lengthCounter=0,this.lengthCounterEnable=!1,this.linearCounter=0,this.lcLoadValue=0,this.lcHalt=!0,this.lcControl=!1,this.tmp=0,this.sampleValue=15},clockLengthCounter:function(){this.lengthCounterEnable&&this.lengthCounter>0&&(this.lengthCounter--,0===this.lengthCounter&&this.updateSampleCondition())},clockLinearCounter:function(){this.lcHalt?(this.linearCounter=this.lcLoadValue,this.updateSampleCondition()):this.linearCounter>0&&(this.linearCounter--,this.updateSampleCondition()),this.lcControl||(this.lcHalt=!1)},getLengthStatus:function(){return 0!==this.lengthCounter&&this.isEnabled?1:0},readReg:function(t){return 0},writeReg:function(t,e){16392===t?(this.lcControl=0!=(128&e),this.lcLoadValue=127&e,this.lengthCounterEnable=!this.lcControl):16394===t?(this.progTimerMax&=1792,this.progTimerMax|=e):16395===t&&(this.progTimerMax&=255,this.progTimerMax|=(7&e)<<8,this.lengthCounter=this.papu.getLengthMax(248&e),this.lcHalt=!0),this.updateSampleCondition()},clockProgrammableTimer:function(t){if(this.progTimerMax>0)for(this.progTimerCount+=t;this.progTimerMax>0&&this.progTimerCount>=this.progTimerMax;)this.progTimerCount-=this.progTimerMax,this.isEnabled&&this.lengthCounter>0&&this.linearCounter>0&&this.clockTriangleGenerator()},clockTriangleGenerator:function(){this.triangleCounter++,this.triangleCounter&=31},setEnabled:function(t){this.isEnabled=t,t||(this.lengthCounter=0),this.updateSampleCondition()},updateSampleCondition:function(){this.sampleCondition=this.isEnabled&&this.progTimerMax>7&&this.linearCounter>0&&this.lengthCounter>0}},t.exports=e},321:(t,e,i)=>{var s=i(361),r=i(610),n=function(t){this.nes=t,this.vramMem=null,this.spriteMem=null,this.vramAddress=null,this.vramTmpAddress=null,this.vramBufferedReadValue=null,this.firstWrite=null,this.sramAddress=null,this.currentMirroring=null,this.requestEndFrame=null,this.nmiOk=null,this.dummyCycleToggle=null,this.validTileData=null,this.nmiCounter=null,this.scanlineAlreadyRendered=null,this.f_nmiOnVblank=null,this.f_spriteSize=null,this.f_bgPatternTable=null,this.f_spPatternTable=null,this.f_addrInc=null,this.f_nTblAddress=null,this.f_color=null,this.f_spVisibility=null,this.f_bgVisibility=null,this.f_spClipping=null,this.f_bgClipping=null,this.f_dispType=null,this.cntFV=null,this.cntV=null,this.cntH=null,this.cntVT=null,this.cntHT=null,this.regFV=null,this.regV=null,this.regH=null,this.regVT=null,this.regHT=null,this.regFH=null,this.regS=null,this.curNt=null,this.attrib=null,this.buffer=null,this.bgbuffer=null,this.pixrendered=null,this.validTileData=null,this.scantile=null,this.scanline=null,this.lastRenderedScanline=null,this.curX=null,this.sprX=null,this.sprY=null,this.sprTile=null,this.sprCol=null,this.vertFlip=null,this.horiFlip=null,this.bgPriority=null,this.spr0HitX=null,this.spr0HitY=null,this.hitSpr0=null,this.sprPalette=null,this.imgPalette=null,this.ptTile=null,this.ntable1=null,this.currentMirroring=null,this.nameTable=null,this.vramMirrorTable=null,this.palTable=null,this.showSpr0Hit=!1,this.clipToTvSize=!0,this.reset()};n.prototype={STATUS_VRAMWRITE:4,STATUS_SLSPRITECOUNT:5,STATUS_SPRITE0HIT:6,STATUS_VBLANK:7,reset:function(){var t;for(this.vramMem=new Array(32768),this.spriteMem=new Array(256),t=0;t<this.vramMem.length;t++)this.vramMem[t]=0;for(t=0;t<this.spriteMem.length;t++)this.spriteMem[t]=0;for(this.vramAddress=null,this.vramTmpAddress=null,this.vramBufferedReadValue=0,this.firstWrite=!0,this.sramAddress=0,this.currentMirroring=-1,this.requestEndFrame=!1,this.nmiOk=!1,this.dummyCycleToggle=!1,this.validTileData=!1,this.nmiCounter=0,this.scanlineAlreadyRendered=null,this.f_nmiOnVblank=0,this.f_spriteSize=0,this.f_bgPatternTable=0,this.f_spPatternTable=0,this.f_addrInc=0,this.f_nTblAddress=0,this.f_color=0,this.f_spVisibility=0,this.f_bgVisibility=0,this.f_spClipping=0,this.f_bgClipping=0,this.f_dispType=0,this.cntFV=0,this.cntV=0,this.cntH=0,this.cntVT=0,this.cntHT=0,this.regFV=0,this.regV=0,this.regH=0,this.regVT=0,this.regHT=0,this.regFH=0,this.regS=0,this.curNt=null,this.attrib=new Array(32),this.buffer=new Array(61440),this.bgbuffer=new Array(61440),this.pixrendered=new Array(61440),this.validTileData=null,this.scantile=new Array(32),this.scanline=0,this.lastRenderedScanline=-1,this.curX=0,this.sprX=new Array(64),this.sprY=new Array(64),this.sprTile=new Array(64),this.sprCol=new Array(64),this.vertFlip=new Array(64),this.horiFlip=new Array(64),this.bgPriority=new Array(64),this.spr0HitX=0,this.spr0HitY=0,this.hitSpr0=!1,this.sprPalette=new Array(16),this.imgPalette=new Array(16),this.ptTile=new Array(512),t=0;t<512;t++)this.ptTile[t]=new s;for(this.ntable1=new Array(4),this.currentMirroring=-1,this.nameTable=new Array(4),t=0;t<4;t++)this.nameTable[t]=new h(32,32,"Nt"+t);for(this.vramMirrorTable=new Array(32768),t=0;t<32768;t++)this.vramMirrorTable[t]=t;this.palTable=new o,this.palTable.loadNTSCPalette(),this.updateControlReg1(0),this.updateControlReg2(0)},setMirroring:function(t){if(t!==this.currentMirroring){this.currentMirroring=t,this.triggerRendering(),null===this.vramMirrorTable&&(this.vramMirrorTable=new Array(32768));for(var e=0;e<32768;e++)this.vramMirrorTable[e]=e;this.defineMirrorRegion(16160,16128,32),this.defineMirrorRegion(16192,16128,32),this.defineMirrorRegion(16256,16128,32),this.defineMirrorRegion(16320,16128,32),this.defineMirrorRegion(12288,8192,3840),this.defineMirrorRegion(16384,0,16384),t===this.nes.rom.HORIZONTAL_MIRRORING?(this.ntable1[0]=0,this.ntable1[1]=0,this.ntable1[2]=1,this.ntable1[3]=1,this.defineMirrorRegion(9216,8192,1024),this.defineMirrorRegion(11264,10240,1024)):t===this.nes.rom.VERTICAL_MIRRORING?(this.ntable1[0]=0,this.ntable1[1]=1,this.ntable1[2]=0,this.ntable1[3]=1,this.defineMirrorRegion(10240,8192,1024),this.defineMirrorRegion(11264,9216,1024)):t===this.nes.rom.SINGLESCREEN_MIRRORING?(this.ntable1[0]=0,this.ntable1[1]=0,this.ntable1[2]=0,this.ntable1[3]=0,this.defineMirrorRegion(9216,8192,1024),this.defineMirrorRegion(10240,8192,1024),this.defineMirrorRegion(11264,8192,1024)):t===this.nes.rom.SINGLESCREEN_MIRRORING2?(this.ntable1[0]=1,this.ntable1[1]=1,this.ntable1[2]=1,this.ntable1[3]=1,this.defineMirrorRegion(9216,9216,1024),this.defineMirrorRegion(10240,9216,1024),this.defineMirrorRegion(11264,9216,1024)):(this.ntable1[0]=0,this.ntable1[1]=1,this.ntable1[2]=2,this.ntable1[3]=3)}},defineMirrorRegion:function(t,e,i){for(var s=0;s<i;s++)this.vramMirrorTable[t+s]=e+s},startVBlank:function(){this.nes.cpu.requestIrq(this.nes.cpu.IRQ_NMI),this.lastRenderedScanline<239&&this.renderFramePartially(this.lastRenderedScanline+1,240-this.lastRenderedScanline),this.endFrame(),this.lastRenderedScanline=-1},endScanline:function(){switch(this.scanline){case 19:this.dummyCycleToggle&&(this.curX=1,this.dummyCycleToggle=!this.dummyCycleToggle);break;case 20:this.setStatusFlag(this.STATUS_VBLANK,!1),this.setStatusFlag(this.STATUS_SPRITE0HIT,!1),this.hitSpr0=!1,this.spr0HitX=-1,this.spr0HitY=-1,1!==this.f_bgVisibility&&1!==this.f_spVisibility||(this.cntFV=this.regFV,this.cntV=this.regV,this.cntH=this.regH,this.cntVT=this.regVT,this.cntHT=this.regHT,1===this.f_bgVisibility&&this.renderBgScanline(!1,0)),1===this.f_bgVisibility&&1===this.f_spVisibility&&this.checkSprite0(0),1!==this.f_bgVisibility&&1!==this.f_spVisibility||this.nes.mmap.clockIrqCounter();break;case 261:this.setStatusFlag(this.STATUS_VBLANK,!0),this.requestEndFrame=!0,this.nmiCounter=9,this.scanline=-1;break;default:this.scanline>=21&&this.scanline<=260&&(1===this.f_bgVisibility&&(this.scanlineAlreadyRendered||(this.cntHT=this.regHT,this.cntH=this.regH,this.renderBgScanline(!0,this.scanline+1-21)),this.scanlineAlreadyRendered=!1,this.hitSpr0||1!==this.f_spVisibility||this.sprX[0]>=-7&&this.sprX[0]<256&&this.sprY[0]+1<=this.scanline-20&&this.sprY[0]+1+(0===this.f_spriteSize?8:16)>=this.scanline-20&&this.checkSprite0(this.scanline-20)&&(this.hitSpr0=!0)),1!==this.f_bgVisibility&&1!==this.f_spVisibility||this.nes.mmap.clockIrqCounter())}this.scanline++,this.regsToAddress(),this.cntsToAddress()},startFrame:function(){var t=0;if(0===this.f_dispType)t=this.imgPalette[0];else switch(this.f_color){case 0:case 3:default:t=0;break;case 1:t=65280;break;case 2:t=16711680;break;case 4:t=255}var e,i=this.buffer;for(e=0;e<61440;e++)i[e]=t;var s=this.pixrendered;for(e=0;e<s.length;e++)s[e]=65},endFrame:function(){var t,e,i,s=this.buffer;if(this.showSpr0Hit){if(this.sprX[0]>=0&&this.sprX[0]<256&&this.sprY[0]>=0&&this.sprY[0]<240){for(t=0;t<256;t++)s[(this.sprY[0]<<8)+t]=16733525;for(t=0;t<240;t++)s[(t<<8)+this.sprX[0]]=16733525}if(this.spr0HitX>=0&&this.spr0HitX<256&&this.spr0HitY>=0&&this.spr0HitY<240){for(t=0;t<256;t++)s[(this.spr0HitY<<8)+t]=5635925;for(t=0;t<240;t++)s[(t<<8)+this.spr0HitX]=5635925}}if(this.clipToTvSize||0===this.f_bgClipping||0===this.f_spClipping)for(i=0;i<240;i++)for(e=0;e<8;e++)s[(i<<8)+e]=0;if(this.clipToTvSize)for(i=0;i<240;i++)for(e=0;e<8;e++)s[255+(i<<8)-e]=0;if(this.clipToTvSize)for(i=0;i<8;i++)for(e=0;e<256;e++)s[(i<<8)+e]=0,s[(239-i<<8)+e]=0;this.nes.ui.writeFrame(s)},updateControlReg1:function(t){this.triggerRendering(),this.f_nmiOnVblank=t>>7&1,this.f_spriteSize=t>>5&1,this.f_bgPatternTable=t>>4&1,this.f_spPatternTable=t>>3&1,this.f_addrInc=t>>2&1,this.f_nTblAddress=3&t,this.regV=t>>1&1,this.regH=1&t,this.regS=t>>4&1},updateControlReg2:function(t){this.triggerRendering(),this.f_color=t>>5&7,this.f_spVisibility=t>>4&1,this.f_bgVisibility=t>>3&1,this.f_spClipping=t>>2&1,this.f_bgClipping=t>>1&1,this.f_dispType=1&t,0===this.f_dispType&&this.palTable.setEmphasis(this.f_color),this.updatePalettes()},setStatusFlag:function(t,e){var i=1<<t;this.nes.cpu.mem[8194]=this.nes.cpu.mem[8194]&255-i|(e?i:0)},readStatusRegister:function(){var t=this.nes.cpu.mem[8194];return this.firstWrite=!0,this.setStatusFlag(this.STATUS_VBLANK,!1),t},writeSRAMAddress:function(t){this.sramAddress=t},sramLoad:function(){return this.spriteMem[this.sramAddress]},sramWrite:function(t){this.spriteMem[this.sramAddress]=t,this.spriteRamWriteUpdate(this.sramAddress,t),this.sramAddress++,this.sramAddress%=256},scrollWrite:function(t){this.triggerRendering(),this.firstWrite?(this.regHT=t>>3&31,this.regFH=7&t):(this.regFV=7&t,this.regVT=t>>3&31),this.firstWrite=!this.firstWrite},writeVRAMAddress:function(t){this.firstWrite?(this.regFV=t>>4&3,this.regV=t>>3&1,this.regH=t>>2&1,this.regVT=7&this.regVT|(3&t)<<3):(this.triggerRendering(),this.regVT=24&this.regVT|t>>5&7,this.regHT=31&t,this.cntFV=this.regFV,this.cntV=this.regV,this.cntH=this.regH,this.cntVT=this.regVT,this.cntHT=this.regHT,this.checkSprite0(this.scanline-20)),this.firstWrite=!this.firstWrite,this.cntsToAddress(),this.vramAddress<8192&&this.nes.mmap.latchAccess(this.vramAddress)},vramLoad:function(){var t;return this.cntsToAddress(),this.regsToAddress(),this.vramAddress<=16127?(t=this.vramBufferedReadValue,this.vramAddress<8192?this.vramBufferedReadValue=this.vramMem[this.vramAddress]:this.vramBufferedReadValue=this.mirroredLoad(this.vramAddress),this.vramAddress<8192&&this.nes.mmap.latchAccess(this.vramAddress),this.vramAddress+=1===this.f_addrInc?32:1,this.cntsFromAddress(),this.regsFromAddress(),t):(t=this.mirroredLoad(this.vramAddress),this.vramAddress+=1===this.f_addrInc?32:1,this.cntsFromAddress(),this.regsFromAddress(),t)},vramWrite:function(t){this.triggerRendering(),this.cntsToAddress(),this.regsToAddress(),this.vramAddress>=8192?this.mirroredWrite(this.vramAddress,t):(this.writeMem(this.vramAddress,t),this.nes.mmap.latchAccess(this.vramAddress)),this.vramAddress+=1===this.f_addrInc?32:1,this.regsFromAddress(),this.cntsFromAddress()},sramDMA:function(t){for(var e,i=256*t,s=this.sramAddress;s<256;s++)e=this.nes.cpu.mem[i+s],this.spriteMem[s]=e,this.spriteRamWriteUpdate(s,e);this.nes.cpu.haltCycles(513)},regsFromAddress:function(){var t=this.vramTmpAddress>>8&255;this.regFV=t>>4&7,this.regV=t>>3&1,this.regH=t>>2&1,this.regVT=7&this.regVT|(3&t)<<3,t=255&this.vramTmpAddress,this.regVT=24&this.regVT|t>>5&7,this.regHT=31&t},cntsFromAddress:function(){var t=this.vramAddress>>8&255;this.cntFV=t>>4&3,this.cntV=t>>3&1,this.cntH=t>>2&1,this.cntVT=7&this.cntVT|(3&t)<<3,t=255&this.vramAddress,this.cntVT=24&this.cntVT|t>>5&7,this.cntHT=31&t},regsToAddress:function(){var t=(7&this.regFV)<<4;t|=(1&this.regV)<<3,t|=(1&this.regH)<<2,t|=this.regVT>>3&3;var e=(7&this.regVT)<<5;e|=31&this.regHT,this.vramTmpAddress=32767&(t<<8|e)},cntsToAddress:function(){var t=(7&this.cntFV)<<4;t|=(1&this.cntV)<<3,t|=(1&this.cntH)<<2,t|=this.cntVT>>3&3;var e=(7&this.cntVT)<<5;e|=31&this.cntHT,this.vramAddress=32767&(t<<8|e)},incTileCounter:function(t){for(var e=t;0!==e;e--)this.cntHT++,32===this.cntHT&&(this.cntHT=0,this.cntVT++,this.cntVT>=30&&(this.cntH++,2===this.cntH&&(this.cntH=0,this.cntV++,2===this.cntV&&(this.cntV=0,this.cntFV++,this.cntFV&=7))))},mirroredLoad:function(t){return this.vramMem[this.vramMirrorTable[t]]},mirroredWrite:function(t,e){if(t>=16128&&t<16160)16128===t||16144===t?(this.writeMem(16128,e),this.writeMem(16144,e)):16132===t||16148===t?(this.writeMem(16132,e),this.writeMem(16148,e)):16136===t||16152===t?(this.writeMem(16136,e),this.writeMem(16152,e)):16140===t||16156===t?(this.writeMem(16140,e),this.writeMem(16156,e)):this.writeMem(t,e);else{if(!(t<this.vramMirrorTable.length))throw new Error("Invalid VRAM address: "+t.toString(16));this.writeMem(this.vramMirrorTable[t],e)}},triggerRendering:function(){this.scanline>=21&&this.scanline<=260&&(this.renderFramePartially(this.lastRenderedScanline+1,this.scanline-21-this.lastRenderedScanline),this.lastRenderedScanline=this.scanline-21)},renderFramePartially:function(t,e){if(1===this.f_spVisibility&&this.renderSpritesPartially(t,e,!0),1===this.f_bgVisibility){var i=t<<8,s=t+e<<8;s>61440&&(s=61440);for(var r=this.buffer,n=this.bgbuffer,h=this.pixrendered,o=i;o<s;o++)h[o]>255&&(r[o]=n[o])}1===this.f_spVisibility&&this.renderSpritesPartially(t,e,!1),this.validTileData=!1},renderBgScanline:function(t,e){var i=0===this.regS?0:256,s=(e<<8)-this.regFH;if(this.curNt=this.ntable1[this.cntV+this.cntV+this.cntH],this.cntHT=this.regHT,this.cntH=this.regH,this.curNt=this.ntable1[this.cntV+this.cntV+this.cntH],e<240&&e-this.cntFV>=0){for(var r,n,h,o,a=this.cntFV<<3,l=this.scantile,u=this.attrib,c=this.ptTile,p=this.nameTable,d=this.imgPalette,m=this.pixrendered,f=t?this.bgbuffer:this.buffer,_=0;_<32;_++){if(e>=0){if(this.validTileData){if(void 0===(r=l[_]))continue;n=r.pix,h=u[_]}else{if(void 0===(r=c[i+p[this.curNt].getTileIndex(this.cntHT,this.cntVT)]))continue;n=r.pix,h=p[this.curNt].getAttrib(this.cntHT,this.cntVT),l[_]=r,u[_]=h}var R=0,g=(_<<3)-this.regFH;if(g>-8)if(g<0&&(s-=g,R=-g),r.opaque[this.cntFV])for(;R<8;R++)f[s]=d[n[a+R]+h],m[s]|=256,s++;else for(;R<8;R++)0!==(o=n[a+R])&&(f[s]=d[o+h],m[s]|=256),s++}32==++this.cntHT&&(this.cntHT=0,this.cntH++,this.cntH%=2,this.curNt=this.ntable1[(this.cntV<<1)+this.cntH])}this.validTileData=!0}this.cntFV++,8===this.cntFV&&(this.cntFV=0,this.cntVT++,30===this.cntVT?(this.cntVT=0,this.cntV++,this.cntV%=2,this.curNt=this.ntable1[(this.cntV<<1)+this.cntH]):32===this.cntVT&&(this.cntVT=0),this.validTileData=!1)},renderSpritesPartially:function(t,e,i){if(1===this.f_spVisibility)for(var s=0;s<64;s++)if(this.bgPriority[s]===i&&this.sprX[s]>=0&&this.sprX[s]<256&&this.sprY[s]+8>=t&&this.sprY[s]<t+e)if(0===this.f_spriteSize)this.srcy1=0,this.srcy2=8,this.sprY[s]<t&&(this.srcy1=t-this.sprY[s]-1),this.sprY[s]+8>t+e&&(this.srcy2=t+e-this.sprY[s]+1),0===this.f_spPatternTable?this.ptTile[this.sprTile[s]].render(this.buffer,0,this.srcy1,8,this.srcy2,this.sprX[s],this.sprY[s]+1,this.sprCol[s],this.sprPalette,this.horiFlip[s],this.vertFlip[s],s,this.pixrendered):this.ptTile[this.sprTile[s]+256].render(this.buffer,0,this.srcy1,8,this.srcy2,this.sprX[s],this.sprY[s]+1,this.sprCol[s],this.sprPalette,this.horiFlip[s],this.vertFlip[s],s,this.pixrendered);else{var r=this.sprTile[s];0!=(1&r)&&(r=this.sprTile[s]-1+256);var n=0,h=8;this.sprY[s]<t&&(n=t-this.sprY[s]-1),this.sprY[s]+8>t+e&&(h=t+e-this.sprY[s]),this.ptTile[r+(this.vertFlip[s]?1:0)].render(this.buffer,0,n,8,h,this.sprX[s],this.sprY[s]+1,this.sprCol[s],this.sprPalette,this.horiFlip[s],this.vertFlip[s],s,this.pixrendered),n=0,h=8,this.sprY[s]+8<t&&(n=t-(this.sprY[s]+8+1)),this.sprY[s]+16>t+e&&(h=t+e-(this.sprY[s]+8)),this.ptTile[r+(this.vertFlip[s]?0:1)].render(this.buffer,0,n,8,h,this.sprX[s],this.sprY[s]+1+8,this.sprCol[s],this.sprPalette,this.horiFlip[s],this.vertFlip[s],s,this.pixrendered)}},checkSprite0:function(t){var e;this.spr0HitX=-1,this.spr0HitY=-1;var i,s,r,n,h,o=0===this.f_spPatternTable?0:256;if(i=this.sprX[0],s=this.sprY[0]+1,0===this.f_spriteSize){if(s<=t&&s+8>t&&i>=-7&&i<256)if(r=this.ptTile[this.sprTile[0]+o],e=this.vertFlip[0]?7-(t-s):t-s,e*=8,h=256*t+i,this.horiFlip[0])for(n=7;n>=0;n--){if(i>=0&&i<256&&h>=0&&h<61440&&0!==this.pixrendered[h]&&0!==r.pix[e+n])return this.spr0HitX=h%256,this.spr0HitY=t,!0;i++,h++}else for(n=0;n<8;n++){if(i>=0&&i<256&&h>=0&&h<61440&&0!==this.pixrendered[h]&&0!==r.pix[e+n])return this.spr0HitX=h%256,this.spr0HitY=t,!0;i++,h++}}else if(s<=t&&s+16>t&&i>=-7&&i<256)if((e=this.vertFlip[0]?15-(t-s):t-s)<8?r=this.ptTile[this.sprTile[0]+(this.vertFlip[0]?1:0)+(0!=(1&this.sprTile[0])?255:0)]:(r=this.ptTile[this.sprTile[0]+(this.vertFlip[0]?0:1)+(0!=(1&this.sprTile[0])?255:0)],this.vertFlip[0]?e=15-e:e-=8),e*=8,h=256*t+i,this.horiFlip[0])for(n=7;n>=0;n--){if(i>=0&&i<256&&h>=0&&h<61440&&0!==this.pixrendered[h]&&0!==r.pix[e+n])return this.spr0HitX=h%256,this.spr0HitY=t,!0;i++,h++}else for(n=0;n<8;n++){if(i>=0&&i<256&&h>=0&&h<61440&&0!==this.pixrendered[h]&&0!==r.pix[e+n])return this.spr0HitX=h%256,this.spr0HitY=t,!0;i++,h++}return!1},writeMem:function(t,e){this.vramMem[t]=e,t<8192?(this.vramMem[t]=e,this.patternWrite(t,e)):t>=8192&&t<9152?this.nameTableWrite(this.ntable1[0],t-8192,e):t>=9152&&t<9216?this.attribTableWrite(this.ntable1[0],t-9152,e):t>=9216&&t<10176?this.nameTableWrite(this.ntable1[1],t-9216,e):t>=10176&&t<10240?this.attribTableWrite(this.ntable1[1],t-10176,e):t>=10240&&t<11200?this.nameTableWrite(this.ntable1[2],t-10240,e):t>=11200&&t<11264?this.attribTableWrite(this.ntable1[2],t-11200,e):t>=11264&&t<12224?this.nameTableWrite(this.ntable1[3],t-11264,e):t>=12224&&t<12288?this.attribTableWrite(this.ntable1[3],t-12224,e):t>=16128&&t<16160&&this.updatePalettes()},updatePalettes:function(){var t;for(t=0;t<16;t++)0===this.f_dispType?this.imgPalette[t]=this.palTable.getEntry(63&this.vramMem[16128+t]):this.imgPalette[t]=this.palTable.getEntry(32&this.vramMem[16128+t]);for(t=0;t<16;t++)0===this.f_dispType?this.sprPalette[t]=this.palTable.getEntry(63&this.vramMem[16144+t]):this.sprPalette[t]=this.palTable.getEntry(32&this.vramMem[16144+t])},patternWrite:function(t,e){var i=Math.floor(t/16),s=t%16;s<8?this.ptTile[i].setScanline(s,e,this.vramMem[t+8]):this.ptTile[i].setScanline(s-8,this.vramMem[t-8],e)},nameTableWrite:function(t,e,i){this.nameTable[t].tile[e]=i,this.checkSprite0(this.scanline-20)},attribTableWrite:function(t,e,i){this.nameTable[t].writeAttrib(e,i)},spriteRamWriteUpdate:function(t,e){var i=Math.floor(t/4);0===i&&this.checkSprite0(this.scanline-20),t%4==0?this.sprY[i]=e:t%4==1?this.sprTile[i]=e:t%4==2?(this.vertFlip[i]=0!=(128&e),this.horiFlip[i]=0!=(64&e),this.bgPriority[i]=0!=(32&e),this.sprCol[i]=(3&e)<<2):t%4==3&&(this.sprX[i]=e)},doNMI:function(){this.setStatusFlag(this.STATUS_VBLANK,!0),this.nes.cpu.requestIrq(this.nes.cpu.IRQ_NMI)},isPixelWhite:function(t,e){return this.triggerRendering(),16777215===this.nes.ppu.buffer[(e<<8)+t]},JSON_PROPERTIES:["vramMem","spriteMem","cntFV","cntV","cntH","cntVT","cntHT","regFV","regV","regH","regVT","regHT","regFH","regS","vramAddress","vramTmpAddress","f_nmiOnVblank","f_spriteSize","f_bgPatternTable","f_spPatternTable","f_addrInc","f_nTblAddress","f_color","f_spVisibility","f_bgVisibility","f_spClipping","f_bgClipping","f_dispType","vramBufferedReadValue","firstWrite","currentMirroring","vramMirrorTable","ntable1","sramAddress","hitSpr0","sprPalette","imgPalette","curX","scanline","lastRenderedScanline","curNt","scantile","attrib","buffer","bgbuffer","pixrendered","requestEndFrame","nmiOk","dummyCycleToggle","nmiCounter","validTileData","scanlineAlreadyRendered"],toJSON:function(){var t,e=r.toJSON(this);for(e.nameTable=[],t=0;t<this.nameTable.length;t++)e.nameTable[t]=this.nameTable[t].toJSON();for(e.ptTile=[],t=0;t<this.ptTile.length;t++)e.ptTile[t]=this.ptTile[t].toJSON();return e},fromJSON:function(t){var e;for(r.fromJSON(this,t),e=0;e<this.nameTable.length;e++)this.nameTable[e].fromJSON(t.nameTable[e]);for(e=0;e<this.ptTile.length;e++)this.ptTile[e].fromJSON(t.ptTile[e]);for(e=0;e<this.spriteMem.length;e++)this.spriteRamWriteUpdate(e,this.spriteMem[e])}};var h=function(t,e,i){this.width=t,this.height=e,this.name=i,this.tile=new Array(t*e),this.attrib=new Array(t*e);for(var s=0;s<t*e;s++)this.tile[s]=0,this.attrib[s]=0};h.prototype={getTileIndex:function(t,e){return this.tile[e*this.width+t]},getAttrib:function(t,e){return this.attrib[e*this.width+t]},writeAttrib:function(t,e){for(var i,s,r,n=t%8*4,h=4*Math.floor(t/8),o=0;o<2;o++)for(var a=0;a<2;a++){i=e>>2*(2*o+a)&3;for(var l=0;l<2;l++)for(var u=0;u<2;u++)s=n+2*a+u,r=(h+2*o+l)*this.width+s,this.attrib[r]=i<<2&12}},toJSON:function(){return{tile:this.tile,attrib:this.attrib}},fromJSON:function(t){this.tile=t.tile,this.attrib=t.attrib}};var o=function(){this.curTable=new Array(64),this.emphTable=new Array(8),this.currentEmph=-1};o.prototype={reset:function(){this.setEmphasis(0)},loadNTSCPalette:function(){this.curTable=[5395026,11796480,10485760,11599933,7602281,91,95,6208,12048,543240,26368,1196544,7153664,0,0,0,12899815,16728064,14421538,16729963,14090399,6818519,6588,21681,27227,35843,43776,2918400,10777088,0,0,0,16316664,16755516,16742785,16735173,16730354,14633471,4681215,46327,57599,58229,259115,7911470,15065624,7895160,0,0,16777215,16773822,16300216,16300248,16758527,16761855,13095423,10148607,8973816,8650717,12122296,16119980,16777136,16308472,0,0],this.makeTables(),this.setEmphasis(0)},loadPALPalette:function(){this.curTable=[5395026,11796480,10485760,11599933,7602281,91,95,6208,12048,543240,26368,1196544,7153664,0,0,0,12899815,16728064,14421538,16729963,14090399,6818519,6588,21681,27227,35843,43776,2918400,10777088,0,0,0,16316664,16755516,16742785,16735173,16730354,14633471,4681215,46327,57599,58229,259115,7911470,15065624,7895160,0,0,16777215,16773822,16300216,16300248,16758527,16761855,13095423,10148607,8973816,8650717,12122296,16119980,16777136,16308472,0,0],this.makeTables(),this.setEmphasis(0)},makeTables:function(){for(var t,e,i,s,r,n,h,o,a=0;a<8;a++)for(n=1,h=1,o=1,0!=(1&a)&&(n=.75,o=.75),0!=(2&a)&&(n=.75,h=.75),0!=(4&a)&&(h=.75,o=.75),this.emphTable[a]=new Array(64),r=0;r<64;r++)s=this.curTable[r],t=Math.floor(this.getRed(s)*n),e=Math.floor(this.getGreen(s)*h),i=Math.floor(this.getBlue(s)*o),this.emphTable[a][r]=this.getRgb(t,e,i)},setEmphasis:function(t){if(t!==this.currentEmph){this.currentEmph=t;for(var e=0;e<64;e++)this.curTable[e]=this.emphTable[t][e]}},getEntry:function(t){return this.curTable[t]},getRed:function(t){return t>>16&255},getGreen:function(t){return t>>8&255},getBlue:function(t){return 255&t},getRgb:function(t,e,i){return t<<16|e<<8|i},loadDefaultPalette:function(){this.curTable[0]=this.getRgb(117,117,117),this.curTable[1]=this.getRgb(39,27,143),this.curTable[2]=this.getRgb(0,0,171),this.curTable[3]=this.getRgb(71,0,159),this.curTable[4]=this.getRgb(143,0,119),this.curTable[5]=this.getRgb(171,0,19),this.curTable[6]=this.getRgb(167,0,0),this.curTable[7]=this.getRgb(127,11,0),this.curTable[8]=this.getRgb(67,47,0),this.curTable[9]=this.getRgb(0,71,0),this.curTable[10]=this.getRgb(0,81,0),this.curTable[11]=this.getRgb(0,63,23),this.curTable[12]=this.getRgb(27,63,95),this.curTable[13]=this.getRgb(0,0,0),this.curTable[14]=this.getRgb(0,0,0),this.curTable[15]=this.getRgb(0,0,0),this.curTable[16]=this.getRgb(188,188,188),this.curTable[17]=this.getRgb(0,115,239),this.curTable[18]=this.getRgb(35,59,239),this.curTable[19]=this.getRgb(131,0,243),this.curTable[20]=this.getRgb(191,0,191),this.curTable[21]=this.getRgb(231,0,91),this.curTable[22]=this.getRgb(219,43,0),this.curTable[23]=this.getRgb(203,79,15),this.curTable[24]=this.getRgb(139,115,0),this.curTable[25]=this.getRgb(0,151,0),this.curTable[26]=this.getRgb(0,171,0),this.curTable[27]=this.getRgb(0,147,59),this.curTable[28]=this.getRgb(0,131,139),this.curTable[29]=this.getRgb(0,0,0),this.curTable[30]=this.getRgb(0,0,0),this.curTable[31]=this.getRgb(0,0,0),this.curTable[32]=this.getRgb(255,255,255),this.curTable[33]=this.getRgb(63,191,255),this.curTable[34]=this.getRgb(95,151,255),this.curTable[35]=this.getRgb(167,139,253),this.curTable[36]=this.getRgb(247,123,255),this.curTable[37]=this.getRgb(255,119,183),this.curTable[38]=this.getRgb(255,119,99),this.curTable[39]=this.getRgb(255,155,59),this.curTable[40]=this.getRgb(243,191,63),this.curTable[41]=this.getRgb(131,211,19),this.curTable[42]=this.getRgb(79,223,75),this.curTable[43]=this.getRgb(88,248,152),this.curTable[44]=this.getRgb(0,235,219),this.curTable[45]=this.getRgb(0,0,0),this.curTable[46]=this.getRgb(0,0,0),this.curTable[47]=this.getRgb(0,0,0),this.curTable[48]=this.getRgb(255,255,255),this.curTable[49]=this.getRgb(171,231,255),this.curTable[50]=this.getRgb(199,215,255),this.curTable[51]=this.getRgb(215,203,255),this.curTable[52]=this.getRgb(255,199,255),this.curTable[53]=this.getRgb(255,199,219),this.curTable[54]=this.getRgb(255,191,179),this.curTable[55]=this.getRgb(255,219,171),this.curTable[56]=this.getRgb(255,231,163),this.curTable[57]=this.getRgb(227,255,163),this.curTable[58]=this.getRgb(171,243,191),this.curTable[59]=this.getRgb(179,255,207),this.curTable[60]=this.getRgb(159,255,243),this.curTable[61]=this.getRgb(0,0,0),this.curTable[62]=this.getRgb(0,0,0),this.curTable[63]=this.getRgb(0,0,0),this.makeTables(),this.setEmphasis(0)}},t.exports=n},471:(t,e,i)=>{var s=i(939),r=i(361),n=function(t){this.nes=t,this.mapperName=new Array(92);for(var e=0;e<92;e++)this.mapperName[e]="Unknown Mapper";this.mapperName[0]="Direct Access",this.mapperName[1]="Nintendo MMC1",this.mapperName[2]="UNROM",this.mapperName[3]="CNROM",this.mapperName[4]="Nintendo MMC3",this.mapperName[5]="Nintendo MMC5",this.mapperName[6]="FFE F4xxx",this.mapperName[7]="AOROM",this.mapperName[8]="FFE F3xxx",this.mapperName[9]="Nintendo MMC2",this.mapperName[10]="Nintendo MMC4",this.mapperName[11]="Color Dreams Chip",this.mapperName[12]="FFE F6xxx",this.mapperName[15]="100-in-1 switch",this.mapperName[16]="Bandai chip",this.mapperName[17]="FFE F8xxx",this.mapperName[18]="Jaleco SS8806 chip",this.mapperName[19]="Namcot 106 chip",this.mapperName[20]="Famicom Disk System",this.mapperName[21]="Konami VRC4a",this.mapperName[22]="Konami VRC2a",this.mapperName[23]="Konami VRC2a",this.mapperName[24]="Konami VRC6",this.mapperName[25]="Konami VRC4b",this.mapperName[32]="Irem G-101 chip",this.mapperName[33]="Taito TC0190/TC0350",this.mapperName[34]="32kB ROM switch",this.mapperName[64]="Tengen RAMBO-1 chip",this.mapperName[65]="Irem H-3001 chip",this.mapperName[66]="GNROM switch",this.mapperName[67]="SunSoft3 chip",this.mapperName[68]="SunSoft4 chip",this.mapperName[69]="SunSoft5 FME-7 chip",this.mapperName[71]="Camerica chip",this.mapperName[78]="Irem 74HC161/32-based",this.mapperName[91]="Pirate HK-SF3 chip"};n.prototype={VERTICAL_MIRRORING:0,HORIZONTAL_MIRRORING:1,FOURSCREEN_MIRRORING:2,SINGLESCREEN_MIRRORING:3,SINGLESCREEN_MIRRORING2:4,SINGLESCREEN_MIRRORING3:5,SINGLESCREEN_MIRRORING4:6,CHRROM_MIRRORING:7,header:null,rom:null,vrom:null,vromTile:null,romCount:null,vromCount:null,mirroring:null,batteryRam:null,trainer:null,fourScreen:null,mapperType:null,valid:!1,load:function(t){var e,i,s;if(-1===t.indexOf("NES"))throw new Error("Not a valid NES ROM.");for(this.header=new Array(16),e=0;e<16;e++)this.header[e]=255&t.charCodeAt(e);this.romCount=this.header[4],this.vromCount=2*this.header[5],this.mirroring=0!=(1&this.header[6])?1:0,this.batteryRam=0!=(2&this.header[6]),this.trainer=0!=(4&this.header[6]),this.fourScreen=0!=(8&this.header[6]),this.mapperType=this.header[6]>>4|240&this.header[7];var n=!1;for(e=8;e<16;e++)if(0!==this.header[e]){n=!0;break}n&&(this.mapperType&=15),this.rom=new Array(this.romCount);var h,o,a=16;for(e=0;e<this.romCount;e++){for(this.rom[e]=new Array(16384),i=0;i<16384&&!(a+i>=t.length);i++)this.rom[e][i]=255&t.charCodeAt(a+i);a+=16384}for(this.vrom=new Array(this.vromCount),e=0;e<this.vromCount;e++){for(this.vrom[e]=new Array(4096),i=0;i<4096&&!(a+i>=t.length);i++)this.vrom[e][i]=255&t.charCodeAt(a+i);a+=4096}for(this.vromTile=new Array(this.vromCount),e=0;e<this.vromCount;e++)for(this.vromTile[e]=new Array(256),i=0;i<256;i++)this.vromTile[e][i]=new r;for(s=0;s<this.vromCount;s++)for(e=0;e<4096;e++)h=e>>4,(o=e%16)<8?this.vromTile[s][h].setScanline(o,this.vrom[s][e],this.vrom[s][e+8]):this.vromTile[s][h].setScanline(o-8,this.vrom[s][e-8],this.vrom[s][e]);this.valid=!0},getMirroringType:function(){return this.fourScreen?this.FOURSCREEN_MIRRORING:0===this.mirroring?this.HORIZONTAL_MIRRORING:this.VERTICAL_MIRRORING},getMapperName:function(){return this.mapperType>=0&&this.mapperType<this.mapperName.length?this.mapperName[this.mapperType]:"Unknown Mapper, "+this.mapperType},mapperSupported:function(){return void 0!==s[this.mapperType]},createMapper:function(){if(this.mapperSupported())return new s[this.mapperType](this.nes);throw new Error("This ROM uses a mapper not supported by JSNES: "+this.getMapperName()+"("+this.mapperType+")")}},t.exports=n},361:t=>{var e=function(){this.pix=new Array(64),this.fbIndex=null,this.tIndex=null,this.x=null,this.y=null,this.w=null,this.h=null,this.incX=null,this.incY=null,this.palIndex=null,this.tpri=null,this.c=null,this.initialized=!1,this.opaque=new Array(8)};e.prototype={setBuffer:function(t){for(this.y=0;this.y<8;this.y++)this.setScanline(this.y,t[this.y],t[this.y+8])},setScanline:function(t,e,i){for(this.initialized=!0,this.tIndex=t<<3,this.x=0;this.x<8;this.x++)this.pix[this.tIndex+this.x]=(e>>7-this.x&1)+((i>>7-this.x&1)<<1),0===this.pix[this.tIndex+this.x]&&(this.opaque[t]=!1)},render:function(t,e,i,s,r,n,h,o,a,l,u,c,p){if(!(n<-7||n>=256||h<-7||h>=240))if(this.w=s-e,this.h=r-i,n<0&&(e-=n),n+s>=256&&(s=256-n),h<0&&(i-=h),h+r>=240&&(r=240-h),l||u)if(l&&!u)for(this.fbIndex=(h<<8)+n,this.tIndex=7,this.y=0;this.y<8;this.y++){for(this.x=0;this.x<8;this.x++)this.x>=e&&this.x<s&&this.y>=i&&this.y<r&&(this.palIndex=this.pix[this.tIndex],this.tpri=p[this.fbIndex],0!==this.palIndex&&c<=(255&this.tpri)&&(t[this.fbIndex]=a[this.palIndex+o],this.tpri=3840&this.tpri|c,p[this.fbIndex]=this.tpri)),this.fbIndex++,this.tIndex--;this.fbIndex-=8,this.fbIndex+=256,this.tIndex+=16}else if(u&&!l)for(this.fbIndex=(h<<8)+n,this.tIndex=56,this.y=0;this.y<8;this.y++){for(this.x=0;this.x<8;this.x++)this.x>=e&&this.x<s&&this.y>=i&&this.y<r&&(this.palIndex=this.pix[this.tIndex],this.tpri=p[this.fbIndex],0!==this.palIndex&&c<=(255&this.tpri)&&(t[this.fbIndex]=a[this.palIndex+o],this.tpri=3840&this.tpri|c,p[this.fbIndex]=this.tpri)),this.fbIndex++,this.tIndex++;this.fbIndex-=8,this.fbIndex+=256,this.tIndex-=16}else for(this.fbIndex=(h<<8)+n,this.tIndex=63,this.y=0;this.y<8;this.y++){for(this.x=0;this.x<8;this.x++)this.x>=e&&this.x<s&&this.y>=i&&this.y<r&&(this.palIndex=this.pix[this.tIndex],this.tpri=p[this.fbIndex],0!==this.palIndex&&c<=(255&this.tpri)&&(t[this.fbIndex]=a[this.palIndex+o],this.tpri=3840&this.tpri|c,p[this.fbIndex]=this.tpri)),this.fbIndex++,this.tIndex--;this.fbIndex-=8,this.fbIndex+=256}else for(this.fbIndex=(h<<8)+n,this.tIndex=0,this.y=0;this.y<8;this.y++){for(this.x=0;this.x<8;this.x++)this.x>=e&&this.x<s&&this.y>=i&&this.y<r&&(this.palIndex=this.pix[this.tIndex],this.tpri=p[this.fbIndex],0!==this.palIndex&&c<=(255&this.tpri)&&(t[this.fbIndex]=a[this.palIndex+o],this.tpri=3840&this.tpri|c,p[this.fbIndex]=this.tpri)),this.fbIndex++,this.tIndex++;this.fbIndex-=8,this.fbIndex+=256}},isTransparent:function(t,e){return 0===this.pix[(e<<3)+t]},toJSON:function(){return{opaque:this.opaque,pix:this.pix}},fromJSON:function(t){this.opaque=t.opaque,this.pix=t.pix}},t.exports=e},610:t=>{t.exports={copyArrayElements:function(t,e,i,s,r){for(var n=0;n<r;++n)i[s+n]=t[e+n]},copyArray:function(t){return t.slice(0)},fromJSON:function(t,e){for(var i=0;i<t.JSON_PROPERTIES.length;i++)t[t.JSON_PROPERTIES[i]]=e[t.JSON_PROPERTIES[i]]},toJSON:function(t){for(var e={},i=0;i<t.JSON_PROPERTIES.length;i++)e[t.JSON_PROPERTIES[i]]=t[t.JSON_PROPERTIES[i]];return e}}},483:(t,e,i)=>{t.exports=function t(e,i,s){function r(h,o){if(!i[h]){if(!e[h]){if(n)return n(h,!0);var a=new Error("Cannot find module '"+h+"'");throw a.code="MODULE_NOT_FOUND",a}var l=i[h]={exports:{}};e[h][0].call(l.exports,(function(t){return r(e[h][1][t]||t)}),l,l.exports,t,e,i,s)}return i[h].exports}for(var n=void 0,h=0;h<s.length;h++)r(s[h]);return r}({1:[function(t,e,s){(function(t){"use strict";var i,s,r=t.MutationObserver||t.WebKitMutationObserver;if(r){var n=0,h=new r(u),o=t.document.createTextNode("");h.observe(o,{characterData:!0}),i=function(){o.data=n=++n%2}}else if(t.setImmediate||void 0===t.MessageChannel)i="document"in t&&"onreadystatechange"in t.document.createElement("script")?function(){var e=t.document.createElement("script");e.onreadystatechange=function(){u(),e.onreadystatechange=null,e.parentNode.removeChild(e),e=null},t.document.documentElement.appendChild(e)}:function(){setTimeout(u,0)};else{var a=new t.MessageChannel;a.port1.onmessage=u,i=function(){a.port2.postMessage(0)}}var l=[];function u(){var t,e;s=!0;for(var i=l.length;i;){for(e=l,l=[],t=-1;++t<i;)e[t]();i=l.length}s=!1}e.exports=function(t){1!==l.push(t)||s||i()}}).call(this,void 0!==i.g?i.g:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(t,e,i){"use strict";var s=t(1);function r(){}var n={},h=["REJECTED"],o=["FULFILLED"],a=["PENDING"];function l(t){if("function"!=typeof t)throw new TypeError("resolver must be a function");this.state=a,this.queue=[],this.outcome=void 0,t!==r&&d(this,t)}function u(t,e,i){this.promise=t,"function"==typeof e&&(this.onFulfilled=e,this.callFulfilled=this.otherCallFulfilled),"function"==typeof i&&(this.onRejected=i,this.callRejected=this.otherCallRejected)}function c(t,e,i){s((function(){var s;try{s=e(i)}catch(e){return n.reject(t,e)}s===t?n.reject(t,new TypeError("Cannot resolve promise with itself")):n.resolve(t,s)}))}function p(t){var e=t&&t.then;if(t&&("object"==typeof t||"function"==typeof t)&&"function"==typeof e)return function(){e.apply(t,arguments)}}function d(t,e){var i=!1;function s(e){i||(i=!0,n.reject(t,e))}function r(e){i||(i=!0,n.resolve(t,e))}var h=m((function(){e(r,s)}));"error"===h.status&&s(h.value)}function m(t,e){var i={};try{i.value=t(e),i.status="success"}catch(t){i.status="error",i.value=t}return i}e.exports=l,l.prototype.catch=function(t){return this.then(null,t)},l.prototype.then=function(t,e){if("function"!=typeof t&&this.state===o||"function"!=typeof e&&this.state===h)return this;var i=new this.constructor(r);return this.state!==a?c(i,this.state===o?t:e,this.outcome):this.queue.push(new u(i,t,e)),i},u.prototype.callFulfilled=function(t){n.resolve(this.promise,t)},u.prototype.otherCallFulfilled=function(t){c(this.promise,this.onFulfilled,t)},u.prototype.callRejected=function(t){n.reject(this.promise,t)},u.prototype.otherCallRejected=function(t){c(this.promise,this.onRejected,t)},n.resolve=function(t,e){var i=m(p,e);if("error"===i.status)return n.reject(t,i.value);var s=i.value;if(s)d(t,s);else{t.state=o,t.outcome=e;for(var r=-1,h=t.queue.length;++r<h;)t.queue[r].callFulfilled(e)}return t},n.reject=function(t,e){t.state=h,t.outcome=e;for(var i=-1,s=t.queue.length;++i<s;)t.queue[i].callRejected(e);return t},l.resolve=function(t){return t instanceof this?t:n.resolve(new this(r),t)},l.reject=function(t){var e=new this(r);return n.reject(e,t)},l.all=function(t){var e=this;if("[object Array]"!==Object.prototype.toString.call(t))return this.reject(new TypeError("must be an array"));var i=t.length,s=!1;if(!i)return this.resolve([]);for(var h=new Array(i),o=0,a=-1,l=new this(r);++a<i;)u(t[a],a);return l;function u(t,r){e.resolve(t).then((function(t){h[r]=t,++o!==i||s||(s=!0,n.resolve(l,h))}),(function(t){s||(s=!0,n.reject(l,t))}))}},l.race=function(t){var e=this;if("[object Array]"!==Object.prototype.toString.call(t))return this.reject(new TypeError("must be an array"));var i,s=t.length,h=!1;if(!s)return this.resolve([]);for(var o=-1,a=new this(r);++o<s;)i=t[o],e.resolve(i).then((function(t){h||(h=!0,n.resolve(a,t))}),(function(t){h||(h=!0,n.reject(a,t))}));return a}},{1:1}],3:[function(t,e,s){(function(e){"use strict";"function"!=typeof e.Promise&&(e.Promise=t(2))}).call(this,void 0!==i.g?i.g:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{2:2}],4:[function(t,e,i){"use strict";var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};var r=function(){try{if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof webkitIndexedDB)return webkitIndexedDB;if("undefined"!=typeof mozIndexedDB)return mozIndexedDB;if("undefined"!=typeof OIndexedDB)return OIndexedDB;if("undefined"!=typeof msIndexedDB)return msIndexedDB}catch(t){return}}();function n(t,e){t=t||[],e=e||{};try{return new Blob(t,e)}catch(r){if("TypeError"!==r.name)throw r;for(var i=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),s=0;s<t.length;s+=1)i.append(t[s]);return i.getBlob(e.type)}}"undefined"==typeof Promise&&t(3);var h=Promise;function o(t,e){e&&t.then((function(t){e(null,t)}),(function(t){e(t)}))}function a(t,e,i){"function"==typeof e&&t.then(e),"function"==typeof i&&t.catch(i)}function l(t){return"string"!=typeof t&&(console.warn(t+" used as a key, but it is not a string."),t=String(t)),t}function u(){if(arguments.length&&"function"==typeof arguments[arguments.length-1])return arguments[arguments.length-1]}var c="local-forage-detect-blob-support",p=void 0,d={},m=Object.prototype.toString,f="readonly",_="readwrite";function R(t){for(var e=t.length,i=new ArrayBuffer(e),s=new Uint8Array(i),r=0;r<e;r++)s[r]=t.charCodeAt(r);return i}function g(t){return"boolean"==typeof p?h.resolve(p):function(t){return new h((function(e){var i=t.transaction(c,_),s=n([""]);i.objectStore(c).put(s,"key"),i.onabort=function(t){t.preventDefault(),t.stopPropagation(),e(!1)},i.oncomplete=function(){var t=navigator.userAgent.match(/Chrome\/(\d+)/),i=navigator.userAgent.match(/Edge\//);e(i||!t||parseInt(t[1],10)>=43)}})).catch((function(){return!1}))}(t).then((function(t){return p=t}))}function S(t){var e=d[t.name],i={};i.promise=new h((function(t,e){i.resolve=t,i.reject=e})),e.deferredOperations.push(i),e.dbReady?e.dbReady=e.dbReady.then((function(){return i.promise})):e.dbReady=i.promise}function b(t){var e=d[t.name].deferredOperations.pop();if(e)return e.resolve(),e.promise}function v(t,e){var i=d[t.name].deferredOperations.pop();if(i)return i.reject(e),i.promise}function y(t,e){return new h((function(i,s){if(d[t.name]=d[t.name]||{forages:[],db:null,dbReady:null,deferredOperations:[]},t.db){if(!e)return i(t.db);S(t),t.db.close()}var n=[t.name];e&&n.push(t.version);var h=r.open.apply(r,n);e&&(h.onupgradeneeded=function(e){var i=h.result;try{i.createObjectStore(t.storeName),e.oldVersion<=1&&i.createObjectStore(c)}catch(i){if("ConstraintError"!==i.name)throw i;console.warn('The database "'+t.name+'" has been upgraded from version '+e.oldVersion+" to version "+e.newVersion+', but the storage "'+t.storeName+'" already exists.')}}),h.onerror=function(t){t.preventDefault(),s(h.error)},h.onsuccess=function(){var e=h.result;e.onversionchange=function(t){t.target.close()},i(e),b(t)}}))}function I(t){return y(t,!1)}function A(t){return y(t,!0)}function C(t,e){if(!t.db)return!0;var i=!t.db.objectStoreNames.contains(t.storeName),s=t.version<t.db.version,r=t.version>t.db.version;if(s&&(t.version!==e&&console.warn('The database "'+t.name+"\" can't be downgraded from version "+t.db.version+" to version "+t.version+"."),t.version=t.db.version),r||i){if(i){var n=t.db.version+1;n>t.version&&(t.version=n)}return!0}return!1}function D(t){return n([R(atob(t.data))],{type:t.type})}function N(t){return t&&t.__local_forage_encoded_blob}function E(t){var e=this,i=e._initReady().then((function(){var t=d[e._dbInfo.name];if(t&&t.dbReady)return t.dbReady}));return a(i,t,t),i}function O(t,e,i,s){void 0===s&&(s=1);try{var r=t.db.transaction(t.storeName,e);i(null,r)}catch(r){if(s>0&&(!t.db||"InvalidStateError"===r.name||"NotFoundError"===r.name))return h.resolve().then((function(){if(!t.db||"NotFoundError"===r.name&&!t.db.objectStoreNames.contains(t.storeName)&&t.version<=t.db.version)return t.db&&(t.version=t.db.version+1),A(t)})).then((function(){return function(t){S(t);for(var e=d[t.name],i=e.forages,s=0;s<i.length;s++){var r=i[s];r._dbInfo.db&&(r._dbInfo.db.close(),r._dbInfo.db=null)}return t.db=null,I(t).then((function(e){return t.db=e,C(t)?A(t):e})).then((function(s){t.db=e.db=s;for(var r=0;r<i.length;r++)i[r]._dbInfo.db=s})).catch((function(e){throw v(t,e),e}))}(t).then((function(){O(t,e,i,s-1)}))})).catch(i);i(r)}}var T={_driver:"asyncStorage",_initStorage:function(t){var e=this,i={db:null};if(t)for(var s in t)i[s]=t[s];var r=d[i.name];r||(r={forages:[],db:null,dbReady:null,deferredOperations:[]},d[i.name]=r),r.forages.push(e),e._initReady||(e._initReady=e.ready,e.ready=E);var n=[];function o(){return h.resolve()}for(var a=0;a<r.forages.length;a++){var l=r.forages[a];l!==e&&n.push(l._initReady().catch(o))}var u=r.forages.slice(0);return h.all(n).then((function(){return i.db=r.db,I(i)})).then((function(t){return i.db=t,C(i,e._defaultConfig.version)?A(i):t})).then((function(t){i.db=r.db=t,e._dbInfo=i;for(var s=0;s<u.length;s++){var n=u[s];n!==e&&(n._dbInfo.db=i.db,n._dbInfo.version=i.version)}}))},_support:function(){try{if(!r||!r.open)return!1;var t="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),e="function"==typeof fetch&&-1!==fetch.toString().indexOf("[native code");return(!t||e)&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange}catch(t){return!1}}(),iterate:function(t,e){var i=this,s=new h((function(e,s){i.ready().then((function(){O(i._dbInfo,f,(function(r,n){if(r)return s(r);try{var h=n.objectStore(i._dbInfo.storeName).openCursor(),o=1;h.onsuccess=function(){var i=h.result;if(i){var s=i.value;N(s)&&(s=D(s));var r=t(s,i.key,o++);void 0!==r?e(r):i.continue()}else e()},h.onerror=function(){s(h.error)}}catch(t){s(t)}}))})).catch(s)}));return o(s,e),s},getItem:function(t,e){var i=this;t=l(t);var s=new h((function(e,s){i.ready().then((function(){O(i._dbInfo,f,(function(r,n){if(r)return s(r);try{var h=n.objectStore(i._dbInfo.storeName).get(t);h.onsuccess=function(){var t=h.result;void 0===t&&(t=null),N(t)&&(t=D(t)),e(t)},h.onerror=function(){s(h.error)}}catch(t){s(t)}}))})).catch(s)}));return o(s,e),s},setItem:function(t,e,i){var s=this;t=l(t);var r=new h((function(i,r){var n;s.ready().then((function(){return n=s._dbInfo,"[object Blob]"===m.call(e)?g(n.db).then((function(t){return t?e:(i=e,new h((function(t,e){var s=new FileReader;s.onerror=e,s.onloadend=function(e){var s=btoa(e.target.result||"");t({__local_forage_encoded_blob:!0,data:s,type:i.type})},s.readAsBinaryString(i)})));var i})):e})).then((function(e){O(s._dbInfo,_,(function(n,h){if(n)return r(n);try{var o=h.objectStore(s._dbInfo.storeName);null===e&&(e=void 0);var a=o.put(e,t);h.oncomplete=function(){void 0===e&&(e=null),i(e)},h.onabort=h.onerror=function(){var t=a.error?a.error:a.transaction.error;r(t)}}catch(t){r(t)}}))})).catch(r)}));return o(r,i),r},removeItem:function(t,e){var i=this;t=l(t);var s=new h((function(e,s){i.ready().then((function(){O(i._dbInfo,_,(function(r,n){if(r)return s(r);try{var h=n.objectStore(i._dbInfo.storeName).delete(t);n.oncomplete=function(){e()},n.onerror=function(){s(h.error)},n.onabort=function(){var t=h.error?h.error:h.transaction.error;s(t)}}catch(t){s(t)}}))})).catch(s)}));return o(s,e),s},clear:function(t){var e=this,i=new h((function(t,i){e.ready().then((function(){O(e._dbInfo,_,(function(s,r){if(s)return i(s);try{var n=r.objectStore(e._dbInfo.storeName).clear();r.oncomplete=function(){t()},r.onabort=r.onerror=function(){var t=n.error?n.error:n.transaction.error;i(t)}}catch(t){i(t)}}))})).catch(i)}));return o(i,t),i},length:function(t){var e=this,i=new h((function(t,i){e.ready().then((function(){O(e._dbInfo,f,(function(s,r){if(s)return i(s);try{var n=r.objectStore(e._dbInfo.storeName).count();n.onsuccess=function(){t(n.result)},n.onerror=function(){i(n.error)}}catch(t){i(t)}}))})).catch(i)}));return o(i,t),i},key:function(t,e){var i=this,s=new h((function(e,s){t<0?e(null):i.ready().then((function(){O(i._dbInfo,f,(function(r,n){if(r)return s(r);try{var h=n.objectStore(i._dbInfo.storeName),o=!1,a=h.openKeyCursor();a.onsuccess=function(){var i=a.result;i?0===t||o?e(i.key):(o=!0,i.advance(t)):e(null)},a.onerror=function(){s(a.error)}}catch(t){s(t)}}))})).catch(s)}));return o(s,e),s},keys:function(t){var e=this,i=new h((function(t,i){e.ready().then((function(){O(e._dbInfo,f,(function(s,r){if(s)return i(s);try{var n=r.objectStore(e._dbInfo.storeName).openKeyCursor(),h=[];n.onsuccess=function(){var e=n.result;e?(h.push(e.key),e.continue()):t(h)},n.onerror=function(){i(n.error)}}catch(t){i(t)}}))})).catch(i)}));return o(i,t),i},dropInstance:function(t,e){e=u.apply(this,arguments);var i,s=this.config();if((t="function"!=typeof t&&t||{}).name||(t.name=t.name||s.name,t.storeName=t.storeName||s.storeName),t.name){var n=t.name===s.name&&this._dbInfo.db?h.resolve(this._dbInfo.db):I(t).then((function(e){var i=d[t.name],s=i.forages;i.db=e;for(var r=0;r<s.length;r++)s[r]._dbInfo.db=e;return e}));i=t.storeName?n.then((function(e){if(e.objectStoreNames.contains(t.storeName)){var i=e.version+1;S(t);var s=d[t.name],n=s.forages;e.close();for(var o=0;o<n.length;o++){var a=n[o];a._dbInfo.db=null,a._dbInfo.version=i}var l=new h((function(e,s){var n=r.open(t.name,i);n.onerror=function(t){n.result.close(),s(t)},n.onupgradeneeded=function(){n.result.deleteObjectStore(t.storeName)},n.onsuccess=function(){var t=n.result;t.close(),e(t)}}));return l.then((function(t){s.db=t;for(var e=0;e<n.length;e++){var i=n[e];i._dbInfo.db=t,b(i._dbInfo)}})).catch((function(e){throw(v(t,e)||h.resolve()).catch((function(){})),e}))}})):n.then((function(e){S(t);var i=d[t.name],s=i.forages;e.close();for(var n=0;n<s.length;n++)s[n]._dbInfo.db=null;var o=new h((function(e,i){var s=r.deleteDatabase(t.name);s.onerror=function(){var t=s.result;t&&t.close(),i(s.error)},s.onblocked=function(){console.warn('dropInstance blocked for database "'+t.name+'" until all open connections are closed')},s.onsuccess=function(){var t=s.result;t&&t.close(),e(t)}}));return o.then((function(t){i.db=t;for(var e=0;e<s.length;e++)b(s[e]._dbInfo)})).catch((function(e){throw(v(t,e)||h.resolve()).catch((function(){})),e}))}))}else i=h.reject("Invalid arguments");return o(i,e),i}};var M="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",w=/^~~local_forage_type~([^~]+)~/,F="__lfsc__:",k="arbf",P="blob",x="si08",L="ui08",B="uic8",V="si16",G="si32",q="ur16",X="ui32",Y="fl32",H="fl64",W=Object.prototype.toString;function U(t){var e,i,s,r,n,h=.75*t.length,o=t.length,a=0;"="===t[t.length-1]&&(h--,"="===t[t.length-2]&&h--);var l=new ArrayBuffer(h),u=new Uint8Array(l);for(e=0;e<o;e+=4)i=M.indexOf(t[e]),s=M.indexOf(t[e+1]),r=M.indexOf(t[e+2]),n=M.indexOf(t[e+3]),u[a++]=i<<2|s>>4,u[a++]=(15&s)<<4|r>>2,u[a++]=(3&r)<<6|63&n;return l}function Z(t){var e,i=new Uint8Array(t),s="";for(e=0;e<i.length;e+=3)s+=M[i[e]>>2],s+=M[(3&i[e])<<4|i[e+1]>>4],s+=M[(15&i[e+1])<<2|i[e+2]>>6],s+=M[63&i[e+2]];return i.length%3==2?s=s.substring(0,s.length-1)+"=":i.length%3==1&&(s=s.substring(0,s.length-2)+"=="),s}var j={serialize:function(t,e){var i="";if(t&&(i=W.call(t)),t&&("[object ArrayBuffer]"===i||t.buffer&&"[object ArrayBuffer]"===W.call(t.buffer))){var s,r=F;t instanceof ArrayBuffer?(s=t,r+=k):(s=t.buffer,"[object Int8Array]"===i?r+=x:"[object Uint8Array]"===i?r+=L:"[object Uint8ClampedArray]"===i?r+=B:"[object Int16Array]"===i?r+=V:"[object Uint16Array]"===i?r+=q:"[object Int32Array]"===i?r+=G:"[object Uint32Array]"===i?r+=X:"[object Float32Array]"===i?r+=Y:"[object Float64Array]"===i?r+=H:e(new Error("Failed to get type for BinaryArray"))),e(r+Z(s))}else if("[object Blob]"===i){var n=new FileReader;n.onload=function(){var i="~~local_forage_type~"+t.type+"~"+Z(this.result);e(F+P+i)},n.readAsArrayBuffer(t)}else try{e(JSON.stringify(t))}catch(i){console.error("Couldn't convert value into a JSON string: ",t),e(null,i)}},deserialize:function(t){if(t.substring(0,9)!==F)return JSON.parse(t);var e,i=t.substring(13),s=t.substring(9,13);if(s===P&&w.test(i)){var r=i.match(w);e=r[1],i=i.substring(r[0].length)}var h=U(i);switch(s){case k:return h;case P:return n([h],{type:e});case x:return new Int8Array(h);case L:return new Uint8Array(h);case B:return new Uint8ClampedArray(h);case V:return new Int16Array(h);case q:return new Uint16Array(h);case G:return new Int32Array(h);case X:return new Uint32Array(h);case Y:return new Float32Array(h);case H:return new Float64Array(h);default:throw new Error("Unkown type: "+s)}},stringToBuffer:U,bufferToString:Z};function z(t,e,i,s){t.executeSql("CREATE TABLE IF NOT EXISTS "+e.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],i,s)}function J(t,e,i,s,r,n){t.executeSql(i,s,r,(function(t,h){h.code===h.SYNTAX_ERR?t.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[e.storeName],(function(t,o){o.rows.length?n(t,h):z(t,e,(function(){t.executeSql(i,s,r,n)}),n)}),n):n(t,h)}),n)}function K(t,e,i,s){var r=this;t=l(t);var n=new h((function(n,h){r.ready().then((function(){void 0===e&&(e=null);var o=e,a=r._dbInfo;a.serializer.serialize(e,(function(e,l){l?h(l):a.db.transaction((function(i){J(i,a,"INSERT OR REPLACE INTO "+a.storeName+" (key, value) VALUES (?, ?)",[t,e],(function(){n(o)}),(function(t,e){h(e)}))}),(function(e){if(e.code===e.QUOTA_ERR){if(s>0)return void n(K.apply(r,[t,o,i,s-1]));h(e)}}))}))})).catch(h)}));return o(n,i),n}var Q={_driver:"webSQLStorage",_initStorage:function(t){var e=this,i={db:null};if(t)for(var s in t)i[s]="string"!=typeof t[s]?t[s].toString():t[s];var r=new h((function(t,s){try{i.db=openDatabase(i.name,String(i.version),i.description,i.size)}catch(t){return s(t)}i.db.transaction((function(r){z(r,i,(function(){e._dbInfo=i,t()}),(function(t,e){s(e)}))}),s)}));return i.serializer=j,r},_support:"function"==typeof openDatabase,iterate:function(t,e){var i=this,s=new h((function(e,s){i.ready().then((function(){var r=i._dbInfo;r.db.transaction((function(i){J(i,r,"SELECT * FROM "+r.storeName,[],(function(i,s){for(var n=s.rows,h=n.length,o=0;o<h;o++){var a=n.item(o),l=a.value;if(l&&(l=r.serializer.deserialize(l)),void 0!==(l=t(l,a.key,o+1)))return void e(l)}e()}),(function(t,e){s(e)}))}))})).catch(s)}));return o(s,e),s},getItem:function(t,e){var i=this;t=l(t);var s=new h((function(e,s){i.ready().then((function(){var r=i._dbInfo;r.db.transaction((function(i){J(i,r,"SELECT * FROM "+r.storeName+" WHERE key = ? LIMIT 1",[t],(function(t,i){var s=i.rows.length?i.rows.item(0).value:null;s&&(s=r.serializer.deserialize(s)),e(s)}),(function(t,e){s(e)}))}))})).catch(s)}));return o(s,e),s},setItem:function(t,e,i){return K.apply(this,[t,e,i,1])},removeItem:function(t,e){var i=this;t=l(t);var s=new h((function(e,s){i.ready().then((function(){var r=i._dbInfo;r.db.transaction((function(i){J(i,r,"DELETE FROM "+r.storeName+" WHERE key = ?",[t],(function(){e()}),(function(t,e){s(e)}))}))})).catch(s)}));return o(s,e),s},clear:function(t){var e=this,i=new h((function(t,i){e.ready().then((function(){var s=e._dbInfo;s.db.transaction((function(e){J(e,s,"DELETE FROM "+s.storeName,[],(function(){t()}),(function(t,e){i(e)}))}))})).catch(i)}));return o(i,t),i},length:function(t){var e=this,i=new h((function(t,i){e.ready().then((function(){var s=e._dbInfo;s.db.transaction((function(e){J(e,s,"SELECT COUNT(key) as c FROM "+s.storeName,[],(function(e,i){var s=i.rows.item(0).c;t(s)}),(function(t,e){i(e)}))}))})).catch(i)}));return o(i,t),i},key:function(t,e){var i=this,s=new h((function(e,s){i.ready().then((function(){var r=i._dbInfo;r.db.transaction((function(i){J(i,r,"SELECT key FROM "+r.storeName+" WHERE id = ? LIMIT 1",[t+1],(function(t,i){var s=i.rows.length?i.rows.item(0).key:null;e(s)}),(function(t,e){s(e)}))}))})).catch(s)}));return o(s,e),s},keys:function(t){var e=this,i=new h((function(t,i){e.ready().then((function(){var s=e._dbInfo;s.db.transaction((function(e){J(e,s,"SELECT key FROM "+s.storeName,[],(function(e,i){for(var s=[],r=0;r<i.rows.length;r++)s.push(i.rows.item(r).key);t(s)}),(function(t,e){i(e)}))}))})).catch(i)}));return o(i,t),i},dropInstance:function(t,e){e=u.apply(this,arguments);var i=this.config();(t="function"!=typeof t&&t||{}).name||(t.name=t.name||i.name,t.storeName=t.storeName||i.storeName);var s,r=this;return o(s=t.name?new h((function(e){var s;s=t.name===i.name?r._dbInfo.db:openDatabase(t.name,"","",0),t.storeName?e({db:s,storeNames:[t.storeName]}):e(function(t){return new h((function(e,i){t.transaction((function(s){s.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],(function(i,s){for(var r=[],n=0;n<s.rows.length;n++)r.push(s.rows.item(n).name);e({db:t,storeNames:r})}),(function(t,e){i(e)}))}),(function(t){i(t)}))}))}(s))})).then((function(t){return new h((function(e,i){t.db.transaction((function(s){function r(t){return new h((function(e,i){s.executeSql("DROP TABLE IF EXISTS "+t,[],(function(){e()}),(function(t,e){i(e)}))}))}for(var n=[],o=0,a=t.storeNames.length;o<a;o++)n.push(r(t.storeNames[o]));h.all(n).then((function(){e()})).catch((function(t){i(t)}))}),(function(t){i(t)}))}))})):h.reject("Invalid arguments"),e),s}};function $(t,e){var i=t.name+"/";return t.storeName!==e.storeName&&(i+=t.storeName+"/"),i}function tt(){return!function(){var t="_localforage_support_test";try{return localStorage.setItem(t,!0),localStorage.removeItem(t),!1}catch(t){return!0}}()||localStorage.length>0}var et={_driver:"localStorageWrapper",_initStorage:function(t){var e={};if(t)for(var i in t)e[i]=t[i];return e.keyPrefix=$(t,this._defaultConfig),tt()?(this._dbInfo=e,e.serializer=j,h.resolve()):h.reject()},_support:function(){try{return"undefined"!=typeof localStorage&&"setItem"in localStorage&&!!localStorage.setItem}catch(t){return!1}}(),iterate:function(t,e){var i=this,s=i.ready().then((function(){for(var e=i._dbInfo,s=e.keyPrefix,r=s.length,n=localStorage.length,h=1,o=0;o<n;o++){var a=localStorage.key(o);if(0===a.indexOf(s)){var l=localStorage.getItem(a);if(l&&(l=e.serializer.deserialize(l)),void 0!==(l=t(l,a.substring(r),h++)))return l}}}));return o(s,e),s},getItem:function(t,e){var i=this;t=l(t);var s=i.ready().then((function(){var e=i._dbInfo,s=localStorage.getItem(e.keyPrefix+t);return s&&(s=e.serializer.deserialize(s)),s}));return o(s,e),s},setItem:function(t,e,i){var s=this;t=l(t);var r=s.ready().then((function(){void 0===e&&(e=null);var i=e;return new h((function(r,n){var h=s._dbInfo;h.serializer.serialize(e,(function(e,s){if(s)n(s);else try{localStorage.setItem(h.keyPrefix+t,e),r(i)}catch(t){"QuotaExceededError"!==t.name&&"NS_ERROR_DOM_QUOTA_REACHED"!==t.name||n(t),n(t)}}))}))}));return o(r,i),r},removeItem:function(t,e){var i=this;t=l(t);var s=i.ready().then((function(){var e=i._dbInfo;localStorage.removeItem(e.keyPrefix+t)}));return o(s,e),s},clear:function(t){var e=this,i=e.ready().then((function(){for(var t=e._dbInfo.keyPrefix,i=localStorage.length-1;i>=0;i--){var s=localStorage.key(i);0===s.indexOf(t)&&localStorage.removeItem(s)}}));return o(i,t),i},length:function(t){var e=this.keys().then((function(t){return t.length}));return o(e,t),e},key:function(t,e){var i=this,s=i.ready().then((function(){var e,s=i._dbInfo;try{e=localStorage.key(t)}catch(t){e=null}return e&&(e=e.substring(s.keyPrefix.length)),e}));return o(s,e),s},keys:function(t){var e=this,i=e.ready().then((function(){for(var t=e._dbInfo,i=localStorage.length,s=[],r=0;r<i;r++){var n=localStorage.key(r);0===n.indexOf(t.keyPrefix)&&s.push(n.substring(t.keyPrefix.length))}return s}));return o(i,t),i},dropInstance:function(t,e){if(e=u.apply(this,arguments),!(t="function"!=typeof t&&t||{}).name){var i=this.config();t.name=t.name||i.name,t.storeName=t.storeName||i.storeName}var s,r=this;return s=t.name?new h((function(e){t.storeName?e($(t,r._defaultConfig)):e(t.name+"/")})).then((function(t){for(var e=localStorage.length-1;e>=0;e--){var i=localStorage.key(e);0===i.indexOf(t)&&localStorage.removeItem(i)}})):h.reject("Invalid arguments"),o(s,e),s}},it=function(t,e){for(var i=t.length,s=0;s<i;){if((r=t[s])===(n=e)||"number"==typeof r&&"number"==typeof n&&isNaN(r)&&isNaN(n))return!0;s++}var r,n;return!1},st=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},rt={},nt={},ht={INDEXEDDB:T,WEBSQL:Q,LOCALSTORAGE:et},ot=[ht.INDEXEDDB._driver,ht.WEBSQL._driver,ht.LOCALSTORAGE._driver],at=["dropInstance"],lt=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(at),ut={description:"",driver:ot.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function ct(t,e){t[e]=function(){var i=arguments;return t.ready().then((function(){return t[e].apply(t,i)}))}}function pt(){for(var t=1;t<arguments.length;t++){var e=arguments[t];if(e)for(var i in e)e.hasOwnProperty(i)&&(st(e[i])?arguments[0][i]=e[i].slice():arguments[0][i]=e[i])}return arguments[0]}var dt=function(){function t(e){for(var i in function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),ht)if(ht.hasOwnProperty(i)){var s=ht[i],r=s._driver;this[i]=r,rt[r]||this.defineDriver(s)}this._defaultConfig=pt({},ut),this._config=pt({},this._defaultConfig,e),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch((function(){}))}return t.prototype.config=function(t){if("object"===(void 0===t?"undefined":s(t))){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var e in t){if("storeName"===e&&(t[e]=t[e].replace(/\W/g,"_")),"version"===e&&"number"!=typeof t[e])return new Error("Database version must be a number.");this._config[e]=t[e]}return!("driver"in t)||!t.driver||this.setDriver(this._config.driver)}return"string"==typeof t?this._config[t]:this._config},t.prototype.defineDriver=function(t,e,i){var s=new h((function(e,i){try{var s=t._driver,r=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!t._driver)return void i(r);for(var n=lt.concat("_initStorage"),a=0,l=n.length;a<l;a++){var u=n[a];if((!it(at,u)||t[u])&&"function"!=typeof t[u])return void i(r)}!function(){for(var e=function(t){return function(){var e=new Error("Method "+t+" is not implemented by the current driver"),i=h.reject(e);return o(i,arguments[arguments.length-1]),i}},i=0,s=at.length;i<s;i++){var r=at[i];t[r]||(t[r]=e(r))}}();var c=function(i){rt[s]&&console.info("Redefining LocalForage driver: "+s),rt[s]=t,nt[s]=i,e()};"_support"in t?t._support&&"function"==typeof t._support?t._support().then(c,i):c(!!t._support):c(!0)}catch(t){i(t)}}));return a(s,e,i),s},t.prototype.driver=function(){return this._driver||null},t.prototype.getDriver=function(t,e,i){var s=rt[t]?h.resolve(rt[t]):h.reject(new Error("Driver not found."));return a(s,e,i),s},t.prototype.getSerializer=function(t){var e=h.resolve(j);return a(e,t),e},t.prototype.ready=function(t){var e=this,i=e._driverSet.then((function(){return null===e._ready&&(e._ready=e._initDriver()),e._ready}));return a(i,t,t),i},t.prototype.setDriver=function(t,e,i){var s=this;st(t)||(t=[t]);var r=this._getSupportedDrivers(t);function n(){s._config.driver=s.driver()}function o(t){return s._extend(t),n(),s._ready=s._initStorage(s._config),s._ready}var l=null!==this._driverSet?this._driverSet.catch((function(){return h.resolve()})):h.resolve();return this._driverSet=l.then((function(){var t=r[0];return s._dbInfo=null,s._ready=null,s.getDriver(t).then((function(t){s._driver=t._driver,n(),s._wrapLibraryMethodsWithReady(),s._initDriver=function(t){return function(){var e=0;return function i(){for(;e<t.length;){var r=t[e];return e++,s._dbInfo=null,s._ready=null,s.getDriver(r).then(o).catch(i)}n();var a=new Error("No available storage method found.");return s._driverSet=h.reject(a),s._driverSet}()}}(r)}))})).catch((function(){n();var t=new Error("No available storage method found.");return s._driverSet=h.reject(t),s._driverSet})),a(this._driverSet,e,i),this._driverSet},t.prototype.supports=function(t){return!!nt[t]},t.prototype._extend=function(t){pt(this,t)},t.prototype._getSupportedDrivers=function(t){for(var e=[],i=0,s=t.length;i<s;i++){var r=t[i];this.supports(r)&&e.push(r)}return e},t.prototype._wrapLibraryMethodsWithReady=function(){for(var t=0,e=lt.length;t<e;t++)ct(this,lt[t])},t.prototype.createInstance=function(e){return new t(e)},t}(),mt=new dt;e.exports=mt},{3:3}]},{},[4])(4)},694:t=>{window,t.exports=function(t){var e={};function i(s){if(e[s])return e[s].exports;var r=e[s]={i:s,l:!1,exports:{}};return t[s].call(r.exports,r,r.exports,i),r.l=!0,r.exports}return i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)i.d(s,r,function(e){return t[e]}.bind(null,r));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){"use strict";i.r(e);var s,r=function(t,e){var i=e.x-t.x,s=e.y-t.y;return Math.sqrt(i*i+s*s)},n=function(t){return t*(Math.PI/180)},h=new Map,o=function(t){h.has(t)&&clearTimeout(h.get(t)),h.set(t,setTimeout(t,100))},a=function(t,e,i){for(var s,r=e.split(/[ ,]+/g),n=0;n<r.length;n+=1)s=r[n],t.addEventListener?t.addEventListener(s,i,!1):t.attachEvent&&t.attachEvent(s,i)},l=function(t,e,i){for(var s,r=e.split(/[ ,]+/g),n=0;n<r.length;n+=1)s=r[n],t.removeEventListener?t.removeEventListener(s,i):t.detachEvent&&t.detachEvent(s,i)},u=function(t){return t.preventDefault(),t.type.match(/^touch/)?t.changedTouches:t},c=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},p=function(t,e){e.top||e.right||e.bottom||e.left?(t.style.top=e.top,t.style.right=e.right,t.style.bottom=e.bottom,t.style.left=e.left):(t.style.left=e.x+"px",t.style.top=e.y+"px")},d=function(t,e,i){var s=m(t);for(var r in s)if(s.hasOwnProperty(r))if("string"==typeof e)s[r]=e+" "+i;else{for(var n="",h=0,o=e.length;h<o;h+=1)n+=e[h]+" "+i+", ";s[r]=n.slice(0,-2)}return s},m=function(t){var e={};return e[t]="",["webkit","Moz","o"].forEach((function(i){e[i+t.charAt(0).toUpperCase()+t.slice(1)]=""})),e},f=function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);return t},_=function(t,e){if(t.length)for(var i=0,s=t.length;i<s;i+=1)e(t[i]);else e(t)},R=!!("ontouchstart"in window),g=!!window.PointerEvent,S=!!window.MSPointerEvent,b={start:"mousedown",move:"mousemove",end:"mouseup"},v={};function y(){}g?s={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:S?s={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:R?(s={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},v=b):s=b,y.prototype.on=function(t,e){var i,s=t.split(/[ ,]+/g);this._handlers_=this._handlers_||{};for(var r=0;r<s.length;r+=1)i=s[r],this._handlers_[i]=this._handlers_[i]||[],this._handlers_[i].push(e);return this},y.prototype.off=function(t,e){return this._handlers_=this._handlers_||{},void 0===t?this._handlers_={}:void 0===e?this._handlers_[t]=null:this._handlers_[t]&&this._handlers_[t].indexOf(e)>=0&&this._handlers_[t].splice(this._handlers_[t].indexOf(e),1),this},y.prototype.trigger=function(t,e){var i,s=this,r=t.split(/[ ,]+/g);s._handlers_=s._handlers_||{};for(var n=0;n<r.length;n+=1)i=r[n],s._handlers_[i]&&s._handlers_[i].length&&s._handlers_[i].forEach((function(t){t.call(s,{type:i,target:s},e)}))},y.prototype.config=function(t){this.options=this.defaults||{},t&&(this.options=function(t,e){var i={};for(var s in t)t.hasOwnProperty(s)&&e.hasOwnProperty(s)?i[s]=e[s]:t.hasOwnProperty(s)&&(i[s]=t[s]);return i}(this.options,t))},y.prototype.bindEvt=function(t,e){var i=this;return i._domHandlers_=i._domHandlers_||{},i._domHandlers_[e]=function(){"function"==typeof i["on"+e]?i["on"+e].apply(i,arguments):console.warn('[WARNING] : Missing "on'+e+'" handler.')},a(t,s[e],i._domHandlers_[e]),v[e]&&a(t,v[e],i._domHandlers_[e]),i},y.prototype.unbindEvt=function(t,e){return this._domHandlers_=this._domHandlers_||{},l(t,s[e],this._domHandlers_[e]),v[e]&&l(t,v[e],this._domHandlers_[e]),delete this._domHandlers_[e],this};var I=y;function A(t,e){return this.identifier=e.identifier,this.position=e.position,this.frontPosition=e.frontPosition,this.collection=t,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(e),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=A.id,A.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}A.prototype=new I,A.constructor=A,A.id=0,A.prototype.buildEl=function(t){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},A.prototype.stylize=function(){if(this.options.dataOnly)return this;var t=this.options.fadeTime+"ms",e=function(t,e){var i=m("borderRadius");for(var s in i)i.hasOwnProperty(s)&&(i[s]="50%");return i}(),i=d("transition","opacity",t),s={};return s.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},s.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},s.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},f(s.el,i),"circle"===this.options.shape&&f(s.back,e),f(s.front,e),this.applyStyles(s),this},A.prototype.applyStyles=function(t){for(var e in this.ui)if(this.ui.hasOwnProperty(e))for(var i in t[e])this.ui[e].style[i]=t[e][i];return this},A.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},A.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},A.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},A.prototype.show=function(t){var e=this;return e.options.dataOnly||(clearTimeout(e.removeTimeout),clearTimeout(e.showTimeout),clearTimeout(e.restTimeout),e.addToDom(),e.restCallback(),setTimeout((function(){e.ui.el.style.opacity=1}),0),e.showTimeout=setTimeout((function(){e.trigger("shown",e.instance),"function"==typeof t&&t.call(this)}),e.options.fadeTime)),e},A.prototype.hide=function(t){var e=this;if(e.options.dataOnly)return e;if(e.ui.el.style.opacity=e.options.restOpacity,clearTimeout(e.removeTimeout),clearTimeout(e.showTimeout),clearTimeout(e.restTimeout),e.removeTimeout=setTimeout((function(){var i="dynamic"===e.options.mode?"none":"block";e.ui.el.style.display=i,"function"==typeof t&&t.call(e),e.trigger("hidden",e.instance)}),e.options.fadeTime),e.options.restJoystick){var i=e.options.restJoystick,s={};s.x=!0===i||!1!==i.x?0:e.instance.frontPosition.x,s.y=!0===i||!1!==i.y?0:e.instance.frontPosition.y,e.setPosition(t,s)}return e},A.prototype.setPosition=function(t,e){var i=this;i.frontPosition={x:e.x,y:e.y};var s=i.options.fadeTime+"ms",r={};r.front=d("transition",["transform"],s);var n={front:{}};n.front={transform:"translate("+i.frontPosition.x+"px,"+i.frontPosition.y+"px)"},i.applyStyles(r),i.applyStyles(n),i.restTimeout=setTimeout((function(){"function"==typeof t&&t.call(i),i.restCallback()}),i.options.fadeTime)},A.prototype.restCallback=function(){var t={};t.front=d("transition","none",""),this.applyStyles(t),this.trigger("rested",this.instance)},A.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},A.prototype.computeDirection=function(t){var e,i,s,r=t.angle.radian,n=Math.PI/4,h=Math.PI/2;if(r>n&&r<3*n&&!t.lockX?e="up":r>-n&&r<=n&&!t.lockY?e="left":r>3*-n&&r<=-n&&!t.lockX?e="down":t.lockY||(e="right"),t.lockY||(i=r>-h&&r<h?"left":"right"),t.lockX||(s=r>0?"up":"down"),t.force>this.options.threshold){var o,a={};for(o in this.direction)this.direction.hasOwnProperty(o)&&(a[o]=this.direction[o]);var l={};for(o in this.direction={x:i,y:s,angle:e},t.direction=this.direction,a)a[o]===this.direction[o]&&(l[o]=!0);if(l.x&&l.y&&l.angle)return t;l.x&&l.y||this.trigger("plain",t),l.x||this.trigger("plain:"+i,t),l.y||this.trigger("plain:"+s,t),l.angle||this.trigger("dir dir:"+e,t)}else this.resetDirection();return t};var C=A;function D(t,e){this.nipples=[],this.idles=[],this.actives=[],this.ids=[],this.pressureIntervals={},this.manager=t,this.id=D.id,D.id+=1,this.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},this.config(e),"static"!==this.options.mode&&"semi"!==this.options.mode||(this.options.multitouch=!1),this.options.multitouch||(this.options.maxNumberOfNipples=1);var i=getComputedStyle(this.options.zone.parentElement);return i&&"flex"===i.display&&(this.parentIsFlex=!0),this.updateBox(),this.prepareNipples(),this.bindings(),this.begin(),this.nipples}D.prototype=new I,D.constructor=D,D.id=0,D.prototype.prepareNipples=function(){var t=this.nipples;t.on=this.on.bind(this),t.off=this.off.bind(this),t.options=this.options,t.destroy=this.destroy.bind(this),t.ids=this.ids,t.id=this.id,t.processOnMove=this.processOnMove.bind(this),t.processOnEnd=this.processOnEnd.bind(this),t.get=function(e){if(void 0===e)return t[0];for(var i=0,s=t.length;i<s;i+=1)if(t[i].identifier===e)return t[i];return!1}},D.prototype.bindings=function(){this.bindEvt(this.options.zone,"start"),this.options.zone.style.touchAction="none",this.options.zone.style.msTouchAction="none"},D.prototype.begin=function(){var t=this.options;if("static"===t.mode){var e=this.createNipple(t.position,this.manager.getIdentifier());e.add(),this.idles.push(e)}},D.prototype.createNipple=function(t,e){var i=this.manager.scroll,s={},r=this.options,n=this.parentIsFlex?i.x:i.x+this.box.left,h=this.parentIsFlex?i.y:i.y+this.box.top;if(t.x&&t.y)s={x:t.x-n,y:t.y-h};else if(t.top||t.right||t.bottom||t.left){var o=document.createElement("DIV");o.style.display="hidden",o.style.top=t.top,o.style.right=t.right,o.style.bottom=t.bottom,o.style.left=t.left,o.style.position="absolute",r.zone.appendChild(o);var a=o.getBoundingClientRect();r.zone.removeChild(o),s=t,t={x:a.left+i.x,y:a.top+i.y}}var l=new C(this,{color:r.color,size:r.size,threshold:r.threshold,fadeTime:r.fadeTime,dataOnly:r.dataOnly,restJoystick:r.restJoystick,restOpacity:r.restOpacity,mode:r.mode,identifier:e,position:t,zone:r.zone,frontPosition:{x:0,y:0},shape:r.shape});return r.dataOnly||(p(l.ui.el,s),p(l.ui.front,l.frontPosition)),this.nipples.push(l),this.trigger("added "+l.identifier+":added",l),this.manager.trigger("added "+l.identifier+":added",l),this.bindNipple(l),l},D.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},D.prototype.bindNipple=function(t){var e,i=this,s=function(t,s){e=t.type+" "+s.id+":"+t.type,i.trigger(e,s)};t.on("destroyed",i.onDestroyed.bind(i)),t.on("shown hidden rested dir plain",s),t.on("dir:up dir:right dir:down dir:left",s),t.on("plain:up plain:right plain:down plain:left",s)},D.prototype.pressureFn=function(t,e,i){var s=this,r=0;clearInterval(s.pressureIntervals[i]),s.pressureIntervals[i]=setInterval(function(){var i=t.force||t.pressure||t.webkitForce||0;i!==r&&(e.trigger("pressure",i),s.trigger("pressure "+e.identifier+":pressure",i),r=i)}.bind(s),100)},D.prototype.onstart=function(t){var e=this,i=e.options,s=t;return t=u(t),e.updateBox(),_(t,(function(r){e.actives.length<i.maxNumberOfNipples?e.processOnStart(r):s.type.match(/^touch/)&&(Object.keys(e.manager.ids).forEach((function(i){if(Object.values(s.touches).findIndex((function(t){return t.identifier===i}))<0){var r=[t[0]];r.identifier=i,e.processOnEnd(r)}})),e.actives.length<i.maxNumberOfNipples&&e.processOnStart(r))})),e.manager.bindDocument(),!1},D.prototype.processOnStart=function(t){var e,i=this,s=i.options,n=i.manager.getIdentifier(t),h=t.force||t.pressure||t.webkitForce||0,o={x:t.pageX,y:t.pageY},a=i.getOrCreate(n,o);a.identifier!==n&&i.manager.removeIdentifier(a.identifier),a.identifier=n;var l=function(e){e.trigger("start",e),i.trigger("start "+e.id+":start",e),e.show(),h>0&&i.pressureFn(t,e,e.identifier),i.processOnMove(t)};if((e=i.idles.indexOf(a))>=0&&i.idles.splice(e,1),i.actives.push(a),i.ids.push(a.identifier),"semi"!==s.mode)l(a);else{if(!(r(o,a.position)<=s.catchDistance))return a.destroy(),void i.processOnStart(t);l(a)}return a},D.prototype.getOrCreate=function(t,e){var i,s=this.options;return/(semi|static)/.test(s.mode)?(i=this.idles[0])?(this.idles.splice(0,1),i):"semi"===s.mode?this.createNipple(e,t):(console.warn("Coudln't find the needed nipple."),!1):i=this.createNipple(e,t)},D.prototype.processOnMove=function(t){var e=this.options,i=this.manager.getIdentifier(t),s=this.nipples.get(i),h=this.manager.scroll;if(function(t){return isNaN(t.buttons)?0!==t.pressure:0!==t.buttons}(t)){if(!s)return console.error("Found zombie joystick with ID "+i),void this.manager.removeIdentifier(i);if(e.dynamicPage){var o=s.el.getBoundingClientRect();s.position={x:h.x+o.left,y:h.y+o.top}}s.identifier=i;var a=s.options.size/2,l={x:t.pageX,y:t.pageY};e.lockX&&(l.y=s.position.y),e.lockY&&(l.x=s.position.x);var u,c,p,d,m,f,_,R,g,S,b=r(l,s.position),v=(u=l,p=(c=s.position).x-u.x,d=c.y-u.y,function(t){return t*(180/Math.PI)}(Math.atan2(d,p))),y=n(v),I=b/a,A={distance:b,position:l};if("circle"===s.options.shape?(m=Math.min(b,a),_=s.position,R=m,S={x:0,y:0},g=n(g=v),S.x=_.x-R*Math.cos(g),S.y=_.y-R*Math.sin(g),f=S):(f=function(t,e,i){return{x:Math.min(Math.max(t.x,e.x-i),e.x+i),y:Math.min(Math.max(t.y,e.y-i),e.y+i)}}(l,s.position,a),m=r(f,s.position)),e.follow){if(b>a){var C=l.x-f.x,D=l.y-f.y;s.position.x+=C,s.position.y+=D,s.el.style.top=s.position.y-(this.box.top+h.y)+"px",s.el.style.left=s.position.x-(this.box.left+h.x)+"px",b=r(l,s.position)}}else l=f,b=m;var N=l.x-s.position.x,E=l.y-s.position.y;s.frontPosition={x:N,y:E},e.dataOnly||(s.ui.front.style.transform="translate("+N+"px,"+E+"px)");var O={identifier:s.identifier,position:l,force:I,pressure:t.force||t.pressure||t.webkitForce||0,distance:b,angle:{radian:y,degree:v},vector:{x:N/a,y:-E/a},raw:A,instance:s,lockX:e.lockX,lockY:e.lockY};(O=s.computeDirection(O)).angle={radian:n(180-v),degree:180-v},s.trigger("move",O),this.trigger("move "+s.id+":move",O)}else this.processOnEnd(t)},D.prototype.processOnEnd=function(t){var e=this,i=e.options,s=e.manager.getIdentifier(t),r=e.nipples.get(s),n=e.manager.removeIdentifier(r.identifier);r&&(i.dataOnly||r.hide((function(){"dynamic"===i.mode&&(r.trigger("removed",r),e.trigger("removed "+r.id+":removed",r),e.manager.trigger("removed "+r.id+":removed",r),r.destroy())})),clearInterval(e.pressureIntervals[r.identifier]),r.resetDirection(),r.trigger("end",r),e.trigger("end "+r.id+":end",r),e.ids.indexOf(r.identifier)>=0&&e.ids.splice(e.ids.indexOf(r.identifier),1),e.actives.indexOf(r)>=0&&e.actives.splice(e.actives.indexOf(r),1),/(semi|static)/.test(i.mode)?e.idles.push(r):e.nipples.indexOf(r)>=0&&e.nipples.splice(e.nipples.indexOf(r),1),e.manager.unbindDocument(),/(semi|static)/.test(i.mode)&&(e.manager.ids[n.id]=n.identifier))},D.prototype.onDestroyed=function(t,e){this.nipples.indexOf(e)>=0&&this.nipples.splice(this.nipples.indexOf(e),1),this.actives.indexOf(e)>=0&&this.actives.splice(this.actives.indexOf(e),1),this.idles.indexOf(e)>=0&&this.idles.splice(this.idles.indexOf(e),1),this.ids.indexOf(e.identifier)>=0&&this.ids.splice(this.ids.indexOf(e.identifier),1),this.manager.removeIdentifier(e.identifier),this.manager.unbindDocument()},D.prototype.destroy=function(){for(var t in this.unbindEvt(this.options.zone,"start"),this.nipples.forEach((function(t){t.destroy()})),this.pressureIntervals)this.pressureIntervals.hasOwnProperty(t)&&clearInterval(this.pressureIntervals[t]);this.trigger("destroyed",this.nipples),this.manager.unbindDocument(),this.off()};var N=D;function E(t){var e=this;e.ids={},e.index=0,e.collections=[],e.scroll=c(),e.config(t),e.prepareCollections();var i=function(){var t;e.collections.forEach((function(i){i.forEach((function(i){t=i.el.getBoundingClientRect(),i.position={x:e.scroll.x+t.left,y:e.scroll.y+t.top}}))}))};a(window,"resize",(function(){o(i)}));var s=function(){e.scroll=c()};return a(window,"scroll",(function(){o(s)})),e.collections}E.prototype=new I,E.constructor=E,E.prototype.prepareCollections=function(){var t=this;t.collections.create=t.create.bind(t),t.collections.on=t.on.bind(t),t.collections.off=t.off.bind(t),t.collections.destroy=t.destroy.bind(t),t.collections.get=function(e){var i;return t.collections.every((function(t){return!(i=t.get(e))})),i}},E.prototype.create=function(t){return this.createCollection(t)},E.prototype.createCollection=function(t){var e=new N(this,t);return this.bindCollection(e),this.collections.push(e),e},E.prototype.bindCollection=function(t){var e,i=this,s=function(t,s){e=t.type+" "+s.id+":"+t.type,i.trigger(e,s)};t.on("destroyed",i.onDestroyed.bind(i)),t.on("shown hidden rested dir plain",s),t.on("dir:up dir:right dir:down dir:left",s),t.on("plain:up plain:right plain:down plain:left",s)},E.prototype.bindDocument=function(){this.binded||(this.bindEvt(document,"move").bindEvt(document,"end"),this.binded=!0)},E.prototype.unbindDocument=function(t){Object.keys(this.ids).length&&!0!==t||(this.unbindEvt(document,"move").unbindEvt(document,"end"),this.binded=!1)},E.prototype.getIdentifier=function(t){var e;return t?void 0===(e=void 0===t.identifier?t.pointerId:t.identifier)&&(e=this.latest||0):e=this.index,void 0===this.ids[e]&&(this.ids[e]=this.index,this.index+=1),this.latest=e,this.ids[e]},E.prototype.removeIdentifier=function(t){var e={};for(var i in this.ids)if(this.ids[i]===t){e.id=i,e.identifier=this.ids[i],delete this.ids[i];break}return e},E.prototype.onmove=function(t){return this.onAny("move",t),!1},E.prototype.onend=function(t){return this.onAny("end",t),!1},E.prototype.oncancel=function(t){return this.onAny("end",t),!1},E.prototype.onAny=function(t,e){var i,s=this,r="processOn"+t.charAt(0).toUpperCase()+t.slice(1);e=u(e);var n=function(t,e,i){i.ids.indexOf(e)>=0&&(i[r](t),t._found_=!0)};return _(e,(function(t){i=s.getIdentifier(t),_(s.collections,n.bind(null,t,i)),t._found_||s.removeIdentifier(i)})),!1},E.prototype.destroy=function(){this.unbindDocument(!0),this.ids={},this.index=0,this.collections.forEach((function(t){t.destroy()})),this.off()},E.prototype.onDestroyed=function(t,e){if(this.collections.indexOf(e)<0)return!1;this.collections.splice(this.collections.indexOf(e),1)};var O=new E;e.default={create:function(t){return O.create(t)},factory:O}}]).default}},e={};function i(s){var r=e[s];if(void 0!==r)return r.exports;var n=e[s]={exports:{}};return t[s](n,n.exports,i),n.exports}i.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return i.d(e,{a:e}),e},i.d=(t,e)=>{for(var s in e)i.o(e,s)&&!i.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{"use strict";var t=i(520),e=i(694),s=i.n(e),r=i(483);const n=i.n(r)().createInstance({name:"myNES"});let h,o,a,l;const u=512,c=4095,p=new Float32Array(4096),d=new Float32Array(4096);let m,f,_=0,R=0;var g=new t.NES({onFrame:function(t){for(var e=0;e<61440;e++)l[e]=4278190080|t[e]},onAudioSample:function(t,e){p[_]=t,d[_]=e,_=_+1&c}});let S=0;function b(){window.requestAnimationFrame(b),o.data.set(a),h.putImageData(o,0,0)}function v(t){var e=t.outputBuffer,i=e.length;(_-R&c)<u&&g.frame();for(var s=e.getChannelData(0),r=e.getChannelData(1),n=0;n<i;n++){var h=R+n&c;s[n]=p[h],r[n]=d[h]}R=R+i&c}document.documentElement.addEventListener("touchend",(t=>{var e=Date.now();e-S<=300&&t.preventDefault(),S=e}),{passive:!1});const y=s().create({zone:document.getElementById("joy"),mode:"static",position:{left:"50%",top:"50%"},size:130,color:"blue"});let I;const A={left:{s:0,btn:"BUTTON_LEFT"},right:{s:0,btn:"BUTTON_RIGHT"},up:{s:0,btn:"BUTTON_UP"},down:{s:0,btn:"BUTTON_DOWN"}};function C(e,i){document.getElementById(e)?.addEventListener("touchstart",(e=>{g.buttonDown(1,t.Controller[i]),e.preventDefault(),e.target.style.boxShadow="1px 1px 3px #111 inset"}),!1),document.getElementById(e)?.addEventListener("touchend",(e=>{g.buttonUp(1,t.Controller[i]),e.preventDefault(),e.target.style.boxShadow="-1px -1px 3px #111 inset"}),!1)}y.on("move",((e,i)=>{if(I!==i.direction?.angle)switch(I&&A[I].s&&(g.buttonUp(1,t.Controller[A[I].btn]),A[I].s=0),i.direction?.angle){case"up":g.buttonDown(1,t.Controller.BUTTON_UP),I=i.direction.angle,A[I].s=1;break;case"down":g.buttonDown(1,t.Controller.BUTTON_DOWN),I=i.direction.angle,A[I].s=1;break;case"left":g.buttonDown(1,t.Controller.BUTTON_LEFT),I=i.direction.angle,A[I].s=1;break;case"right":g.buttonDown(1,t.Controller.BUTTON_RIGHT),I=i.direction.angle,A[I].s=1;break;default:for(let e in A)A[e].s&&(g.buttonUp(1,t.Controller[A[e].btn]),A[e].s=0);I=""}})).on("end",(()=>{for(let e in A)A[e].s&&(g.buttonUp(1,t.Controller[A[e].btn]),A[e].s=0);I=""})),C("a","BUTTON_A"),C("b","BUTTON_B"),C("select","BUTTON_SELECT"),C("start","BUTTON_START"),document.getElementById("fileLoad").addEventListener("change",(t=>{let e=new FileReader;e.readAsBinaryString(t.target.files[0]),f=t.target.files[0].name,e.onload=t=>{try{m=t.target.result,e=m,function(t){var e=document.getElementById("nes");h=e.getContext("2d"),o=h.getImageData(0,0,256,240);var i=new ArrayBuffer(o.data.length);a=new Uint8ClampedArray(i),l=new Uint32Array(i);var s=new window.AudioContext,r=s.createScriptProcessor(u,0,2);r.onaudioprocess=v,r.connect(s.destination)}(),function(t){g.loadROM(t),window.requestAnimationFrame(b)}(e),console.log(f,"开始运行")}catch(t){console.log("该游戏不被支持")}var e}}));const D=document.getElementById("save"),N=document.getElementById("load");function E(t){const e=[];let i=t[0],s=1;for(let r=1;r<t.length;r++)t[r]==i?s++:(s>1?(e.push(s),e.push(i)):e.push(-i-1),i=t[r],s=1);return e.push(s),e.push(i),e}function O(t){const e=[];for(let i=0;i<t.length;)if(t[i]<0)e.push(-t[i]-1),i++;else{const s=t[i],r=t[i+1];for(let t=0;t<s;t++)e.push(r);i+=2}return e}D.addEventListener("click",(()=>{g.cpu.irqRequested?(n.setItem(f,function(){const t=g.ppu.toJSON(),e=g.cpu.toJSON();delete t.attrib,delete t.bgbuffer,delete t.buffer,delete t.pixrendered,delete t.vramMirrorTable;const i=E(t.vramMem),s=function(t){const e=[],i=[];return t.reduce(((t,s)=>(e.push(...s.tile),i.push(...s.attrib),t)),e),[E(e),E(i)]}(t.nameTable),r=function(t){const e=[],i=[];for(let s=0;s<t.length;s++){for(let i=0;i<t[s].opaque.length;i++)!1===t[s].opaque[i]?e.push(0):e.push(1);i.push(...t[s].pix)}return[E(e),E(i)]}(t.ptTile),n=E(e.mem);return delete t.vramMem,delete t.nameTable,delete e.mem,delete t.ptTile,{cpu:e,mmap:g.mmap.toJSON(),ppu:t,vramMenZip:i,nameTableZip:s,cpuMemZip:n,ptTileZip:r}}()),D.innerText="已保存",setTimeout((()=>{D.innerText="保存"}),1e3)):console.log("游戏尚未运行，请开始游戏后再试。")})),N.addEventListener("click",(()=>{g.cpu.irqRequested?n.getItem(f).then((t=>{t?(function(t){try{g.ppu.reset();const e=t.ppu,i=t.cpu;e.attrib=new Array(32).fill(0),e.bgbuffer=new Array(61440).fill(0),e.buffer=new Array(61440).fill(0),e.pixrendered=new Array(61440).fill(0),e.vramMem=O(t.vramMenZip),e.nameTable=function(t){const e=[];let i=[],s=[];const r=O(t[0]),n=O(t[1]);for(let t=0;t<4096;t+=1)i.push(r[t]),s.push(n[t]),(t+1)%1024==0&&(e.push({tile:i,attrib:s}),i=[],s=[]);return e}(t.nameTableZip),e.vramMirrorTable=new Array(32768).fill(0).map(((t,e)=>e)),e.ptTile=function(t){const e=[];let i=Array(8),s=[];const r=O(t[0]),n=O(t[1]);for(let t=0;t<512;t+=1){for(let e=0;e<8;e+=1)0===r[8*t+e]&&(i[e]=!1);for(let e=0;e<64;e+=1)s[e]=n[64*t+e];e.push({opaque:i,pix:s}),i=Array(8),s=[]}return e}(t.ptTileZip),i.mem=O(t.cpuMemZip),g.ppu.reset(),g.romData=m,g.cpu.fromJSON(i),g.mmap.fromJSON(t.mmap),g.ppu.fromJSON(e)}catch(t){console.log(t),console.log("读取失败，数据丢失或无效。")}}(t),N.innerText="读取成功",setTimeout((()=>{N.innerText="读取"}),1e3)):alert("读取存档出错")})).catch((()=>{alert("读取存档出错")})):console.log("游戏尚未运行，请开始游戏后再试。")}))})()})();
	</script>

</body>

</html>